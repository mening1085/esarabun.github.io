import{C as N}from"./index-cb5a08aa.js";import{I as T}from"./index-8d30ace7.js";import{B as Y}from"./index-c2d6eb9c.js";import{E as H}from"./index-360221be.js";import{D as z}from"./index-976a2577.js";import{C as q,B as G,A as J,a as K,b as L,R as Q}from"./RouteDetail-d06baee9.js";import{M as U}from"./index-8e7d66d6.js";import{M as W}from"./index-3891a0e1.js";import{M as X}from"./Modal-b54f1b5f.js";import{T as Z}from"./index-78f015fc.js";import{M as $}from"./index-13931335.js";import{A as ee}from"./AttachedFileStamp-6d1dcfc6.js";import{_ as te,t as S,a as m}from"./index-f91482a0.js";import{d as oe}from"./dayjs.min-472eb357.js";import{o as d,x as s,bj as l,m as _,n as p,aF as i,as as a,p as n,aT as f,w as se}from"./preload-helper-f37a9bec.js";import"./iconify-2baafea4.js";import"./dom-b10fc197.js";import"./focus-management-94a631f4.js";import"./open-closed-75edfb8a.js";import"./use-resolve-button-type-d7bee841.js";import"./use-outside-click-156e41c1.js";import"./index-b704274e.js";import"./transition-be7c09bc.js";import"./hidden-800255f5.js";import"./micro-task-89dcd6af.js";import"./index-f32159fc.js";const ie={name:"ReceiveView",components:{Card:N,Icon:T,Button:Y,Expansion:H,Dropdown:z,CoverSheet:q,BookDetail:G,AttachedFile:J,BookReference:K,Activity:L,RouteDetail:Q,AttachedFileStamp:ee,ModalSuccess:U,ModalError:W,Modal:X,Textarea:Z,ModalPullback:$},data(){return{isOpen:!1,pdfPath:"",urlSarabun:S,item:null,isSuccess:!1,isError:!1,errorMessage:"",modalPullback:!1}},created(){this.fetchData()},methods:{async pdfHistory(){const{data:o,status:t}=await m("documentStore","PDFHistory",{payload:this.$route.params.id});t==200&&(console.log("data pdf",o.result),this.pdfPath=o.result,this.isOpen=!0)},async fetchData(){console.log("fetchData");const{data:o,status:t}=await m("documentStore","show",{payload:this.$route.params.id});t===200&&(this.item=o.result)},convertDate(o){return o?oe(o).locale("th").add(543,"year").format("DD/MM/YYYY"):"-"},async handleReceiveBook(){console.log("handleReceiveBook");const{data:o,status:t}=await m("documentStore","acceptDocument",{payload:this.$route.params.id});t===200&&(this.isSuccess=!0,this.fetchData())},async onCancel(){console.log("onCancel");const{data:o,status:t}=await m("documentStore","delete",{payload:[{id:this.$route.params.id}]});t===200?this.$router.push("/app/issue/pending"):(this.isError=!0,this.errorMessage=o.message)},onPrinter(){console.log("onPrinter")},downloadFileDocument(o){console.log(o)},downloadFile(o){const t=S+o;window.open(t,"_blank")},async pullBack(o){const{data:t,status:h}=await m("pullbackStore","store",{payload:{id:this.$route.params.id,returned_reason:o}});h===200?this.$router.push("/app/issue/pending"):(this.isError=!0,this.errorMessage=t.message)},async confirm(){const{data:o,status:t}=await m("pendingStore","confirmReceive",{payload:this.$route.params.id});t===200?this.$router.push("/app/issue/pending"):(this.isError=!0,this.errorMessage=o.message)}}},ne={class:"flex justify-between items-center"},re={class:"basis-1/2"},le={class:"flex items-center gap-3"},ae={class:"shrink w-[145px]"},ce=n("div",null,"กลับไปหน้ารายการ",-1),me={key:0,class:"flex items-center border-x gap-3 border-gray-300 px-4"},pe={key:0,class:"pt-4"},ue={key:1,class:"flex justify-center mt-4 py-4 bg-gray-100"},de={class:"text-2xl font-medium my-6"},fe=n("h4",{class:"text-lg text-slate-900"},[se(" รับหนังสือ "),n("span",{class:"text-green-500"},"สำเร็จ")],-1),_e={class:"text-lg text-slate-900"},he=["src"];function ve(o,t,h,xe,e,r){const v=i("Icon"),x=i("router-link"),u=i("Button"),k=i("Card"),B=i("CoverSheet"),D=i("BookDetail"),E=i("AttachedFileStamp"),P=i("AttachedFile"),R=i("BookReference"),A=i("Activity"),F=i("RouteDetail"),O=i("ModalSuccess"),j=i("ModalError"),V=i("ModalPullback"),I=i("Modal");return a(),d("div",null,[s(k,null,{default:l(()=>{var c,y,b,g,C,M,w;return[n("div",ne,[n("div",re,[n("div",le,[n("div",ae,[s(x,{to:"/app/issue/pending",class:"flex items-center text-primary-600"},{default:l(()=>[s(v,{icon:"mdi:chevron-left",class:"text-xl"}),ce]),_:1})]),e.item?(a(),d("div",me,[e.item&&((c=e.item)==null?void 0:c.status)=="รอดำเนินการ"?(a(),_(x,{key:0,to:"/app/issue/pending/wait-to-receive/edit/"+((y=e.item)==null?void 0:y.id)},{default:l(()=>[s(u,{text:"แก้ไข",btnClass:"btn-primary h-[40px] flex items-center"})]),_:1},8,["to"])):p("",!0),s(u,{onClick:t[0]||(t[0]=ke=>e.modalPullback=!0),text:"ดึงกลับ",btnClass:"btn-warning h-[40px] flex items-center"}),s(u,{onClick:r.onCancel,text:"ยกเลิกหนังสือ",btnClass:"btn-danger h-[40px] flex items-center"},null,8,["onClick"])])):p("",!0),e.item?(a(),_(v,{key:1,onClick:r.onPrinter,icon:"mdi:printer",class:"text-3xl cursor-pointer"},null,8,["onClick"])):p("",!0)])])]),e.item&&((b=e.item)==null?void 0:b.status)=="รอดำเนินการ"?(a(),d("div",pe,[s(k,{bodyClass:"bg-gray-100 h-[95px] flex items-center space-y-10 py-6"},{default:l(()=>[n("div",null,[s(u,{onClick:r.confirm,text:"ยืนยันดำเนินการต่อ"},null,8,["onClick"])])]),_:1})])):p("",!0),((g=e.item)==null?void 0:g.status)=="รอรับ"?(a(),d("div",ue,[s(u,{onClick:r.handleReceiveBook,text:"รับหนังสือ",btnClass:"btn-primary h-[40px] flex items-center"},null,8,["onClick"])])):p("",!0),n("div",de," วันที่ "+f(r.convertDate((C=e.item)==null?void 0:C.document_date))+" "+f((M=e.item)==null?void 0:M.subject)+" พ.ศ. "+f((w=e.item)==null?void 0:w.year),1),s(B,{item:e.item},null,8,["item"]),s(D,{item:e.item},null,8,["item"]),s(E,{item:e.item},null,8,["item"]),s(P,{item:e.item},null,8,["item"]),s(R,{item:e.item},null,8,["item"]),s(A,{item:e.item,"onEvent:onClick":r.pdfHistory},null,8,["item","onEvent:onClick"]),s(F,{item:e.item},null,8,["item"])]}),_:1}),s(O,{title:"รับหนังสือ",isOpen:e.isSuccess,"onEvent:closeModal":t[1]||(t[1]=c=>e.isSuccess=!1)},{default:l(()=>[fe]),_:1},8,["isOpen"]),s(j,{title:"",isOpen:e.isError,"onEvent:closeModal":t[2]||(t[2]=c=>e.isError=!1)},{default:l(()=>[n("h4",_e,f(e.errorMessage),1)]),_:1},8,["isOpen"]),s(V,{isOpen:e.modalPullback,"onEvent:close":t[3]||(t[3]=c=>e.modalPullback=!1),"onEvent:submit":r.pullBack},null,8,["isOpen","onEvent:submit"]),e.isOpen?(a(),_(I,{key:0,title:"ดูรายละเอียดเอกสาร",labelClass:"btn-outline-dark",sizeClass:"w-3/4",label:"",centered:"",activeModal:e.isOpen,"onEvent:closeModal":t[4]||(t[4]=c=>e.isOpen=!1)},{default:l(()=>[n("div",null,[n("iframe",{class:"w-full h-[1000px] mt-4",src:"data:application/pdf;base64, "+e.pdfPath,frameborder:"0"},null,8,he)])]),_:1},8,["activeModal"])):p("",!0)])}const Ke=te(ie,[["render",ve]]);export{Ke as default};
