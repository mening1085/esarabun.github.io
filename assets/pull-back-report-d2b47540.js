import{C as O}from"./index-cb5a08aa.js";import{I as L}from"./index-8d30ace7.js";import{B as V}from"./index-c2d6eb9c.js";import{V as U,C as Y}from"./VueSelect-403231fd.js";import{D as G}from"./index-976a2577.js";import{I as J}from"./index-2198f2cf.js";import{P as q}from"./index-5ddbaceb.js";import{_ as H,a as F,b as K,t as I}from"./index-f91482a0.js";import{A as Q}from"./AdvancedSearch-88f89aed.js";import{d as X,a as Z}from"./global-funcs-ef1510cf.js";import{d as $}from"./dayjs.min-472eb357.js";import{E as N}from"./exceljs.min-7d2227ea.js";import{A as ee}from"./AdvancedSearchStatus-6a253dc1.js";import{o as u,x as p,bj as b,aF as f,as as _,p as c,aT as m,w as T}from"./preload-helper-f37a9bec.js";import"./iconify-2baafea4.js";import"./dom-b10fc197.js";import"./focus-management-94a631f4.js";import"./open-closed-75edfb8a.js";import"./use-resolve-button-type-d7bee841.js";import"./use-outside-click-156e41c1.js";import"./vue-cleave.min-df5c8cc9.js";import"./index-a56f86b1.js";import"./index-325a54cb.js";import"./ck-white-3501111f.js";import"./index-3e8503e7.js";import"./select-option-b2a02578.js";import"./index-8ecfca6d.js";import"./index-43a31f90.js";import"./index-f2da45ff.js";const te={computed:{},components:{AdvancedSearchStatus:ee,Pagination:q,InputGroup:J,VueSelect:U,Dropdown:G,vSelect:Y,Button:V,Card:O,Icon:L,AdvancedSearch:Q},data(){return{isShowModalAS:!1,exportLists:[{id:1,label:"Microsoft Word",icon:"ant-design:file-word-filled"},{id:2,label:"Microsoft Excel",icon:"ant-design:file-excel-filled"},{id:3,label:"PDF",icon:"ant-design:file-pdf-filled"},{id:3,label:"PDF",icon:"ant-design:file-pdf-filled"}],filter:{keyword:""},activityList:[],columns:[{label:"เลขรับ/ส่ง",field:"id",width:"60px",tdClass:"text_left",thClass:"text_left"},{label:"เลขที่หนังสือ/เรื่อง",field:"document_number",width:"200px",tdClass:"text_left",thClass:"text_left"},{label:"จาก",field:"from_id",width:"150px",tdClass:"text_left",thClass:"text_left"},{label:"ถึง",field:"to_id",width:"150px",tdClass:"text_left",thClass:"text_left"},{label:"สถานะ",field:"status",width:"60px",tdClass:"text_left",thClass:"text_left"},{label:"สาเหตุการดึงกลับ",field:"pullback",width:"100px",tdClass:"text_left",thClass:"text_left"}],paginate:{total:50,current_page:1,perpage:10,pageRange:5},advancedTable:[],common:[],agencyItem:[]}},watch:{},async created(){await this.getData(1)},methods:{findUser:X,async onDelete(e){},async onFilter(e){e.document_type=e.document_type?JSON.parse(e.document_type):[],e.book_type=e.book_type?JSON.parse(e.book_type):[],this.getData(1,e)},displayInitialNumber(e){let o="";return e&&(e.doc_pickup_type==="หนังสือรับ"?(o+=this.convertThaiNo(e.initial_number_from??"-"),o+=" / "+(e.parent_document?this.convertThaiNo(e.parent_document.initial_number_from):"-")):o+="- / "+this.convertThaiNo(e.initial_number_from)),o},async getData(e=1,o=[]){var a,d,l,r,h,v,k,C,S,s,g,w,x,y;let i={page:e,...this.filter,filter:o};const n=await F("reportFixStore","pullBackReport",{payload:i}),t=await F("reportDashboardStore","getCommonData");(d=(a=n.data)==null?void 0:a.result)!=null&&d.data&&(this.advancedTable=Z(t.data.result.user_list,t.data.result.inside_organization,t.data.result.outside_organization,(r=(l=n.data)==null?void 0:l.result)==null?void 0:r.data),this.common={user_list:t.data.result.user_list,inside_organization:t.data.result.inside_organization,outside_organization:t.data.result.outside_organization},(h=t==null?void 0:t.data.result)!=null&&h.dropdown&&(this.agencyItem=(v=t==null?void 0:t.data.result)==null?void 0:v.dropdown),this.paginate.total=((C=(k=n.data)==null?void 0:k.result)==null?void 0:C.total_page)*((s=(S=n.data)==null?void 0:S.result)==null?void 0:s.per_page),this.paginate.current=(w=(g=n.data)==null?void 0:g.result)==null?void 0:w.current_page,this.paginate.perpage=(y=(x=n.data)==null?void 0:x.result)==null?void 0:y.per_page)},findOrganizationName(e){const o=this.agencyItem.find(i=>i.id===parseInt(e));return o?o.organization_name:"ไม่ทราบ"},async handleExport(e){this.filter;const o=this.advancedTable.map(n=>{var a,d,l,r,h;const t=this.findOrganizationName((a=n==null?void 0:n.pullback_history[0])==null?void 0:a.user_id);return{initial_number_from:this.convertThaiNo(n==null?void 0:n.initial_number_from)+"/"+this.convertThaiNo((d=n==null?void 0:n.parent_document)==null?void 0:d.initial_number_from),document_number:this.convertThaiNo(n.document_number)+" / "+n.subject,from_id:((l=n.from_user)==null?void 0:l.organization_name)??((r=n.from_user)==null?void 0:r.name)??"-",to_id:((h=n.to_user)==null?void 0:h.full_name)??"-",status:n.status,cancel:n.pullback_history[0].pullback_reason+" ดึงกลับโดย : "+(t==null?void 0:t.full_name)}});let i=["เลขรับ/ส่ง","เลขที่หนังสือ/เรื่อง","จาก","ถึง","สถานะ","วันเวลาปิดเรื่อง"];e.id==1?this.exportToWord(o,null,i):e.id==2?this.exportToExcel(o,null,i):e.id==3&&this.exportToPdf(o,null,i)},async saveToArchive(e){return await window.ApexCharts.getChartByID(e).dataURI()},async sendToServer(e,o,i){try{const n=new FormData;n.append("excelFile",e,"downloaded-file.xlsx"),o&&n.append("base64Image",o);const t=await K.post(I+"/fix/convert-to-"+i,n);i==="pdf"?window.open(`${I}/public/tempFile/${t.data.result.data.fileName}.${i}`,"_blank"):window.open(`${I}/public/tempFile/${t.data.result.data.fileName}.${i}`,"_parent","download")}catch(n){console.error("Error sending file to server:",n)}},async exportToExcel(e,o,i){const n=new N.Workbook,t=n.addWorksheet("Sheet1");if(o){const a=n.addImage({base64:o,extension:"png"});t.addImage(a,{tl:{col:0,row:0},ext:{width:1600,height:380}})}t.getRow(o?20:1).values=i;for(const a of e)t.addRow([a.initial_number_from,a.document_number,a.from_id,a.to_id,a.status,a.cancel]);this.adjustColumnWidth(t),this.setTextCenter(t),n.xlsx.writeBuffer().then(a=>{const d=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),l="exported_data.xlsx",r=document.createElement("a");r.href=URL.createObjectURL(d),r.download=l,document.body.appendChild(r),r.click(),document.body.removeChild(r)})},async exportToWord(e,o,i){const n=new N.Workbook,t=n.addWorksheet("Sheet1");if(o){const l=n.addImage({base64:o,extension:"png"});t.addImage(l,{tl:{col:0,row:0},ext:{width:1600,height:380}})}t.getRow(o?20:1).values=i;for(const l of e)t.addRow([l.initial_number_from,l.document_number,l.from_id,l.to_id,l.status,l.cancel]);this.adjustColumnWidth(t),this.setTextCenter(t);const a=await n.xlsx.writeBuffer(),d=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});await this.sendToServer(d,o,"docx")},async exportToPdf(e,o,i){const n=new N.Workbook,t=n.addWorksheet("Sheet1");if(t.pageSetup={orientation:"landscape"},o){const r=n.addImage({base64:o,extension:"png"});t.addImage(r,{tl:{col:0,row:0},ext:{width:600,height:300}})}t.getRow(o?18:1).values=i;for(const r of e)t.addRow([r.initial_number_from,r.document_number,r.from_id,r.to_id,r.status,r.cancel]);const a=this.adjustColumnWidth(t);this.setTextCenter(t,!0,a);const d=await n.xlsx.writeBuffer(),l=new Blob([d],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});await this.sendToServer(l,o,"pdf")},adjustColumnWidth(e){let o=[];return e.columns.forEach(i=>{const n=i.values.map(a=>a.toString().length),t=Math.max(...n.filter(a=>typeof a=="number"));o.push(t),i.width=t<20?t*.7:20}),Math.max(...o.filter(i=>typeof i=="number"))},setTextCenter(e,o=!1,i=20){const a=e.lastRow.number;for(let d=0;d<=a;d++){const l=e.getRow(d);l.height=i/20*12,l.eachCell({includeEmpty:!0},r=>{o&&(r.font={size:10}),r.alignment={wrapText:!0},r.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}})}},convertDate(e,o="DD/MM/YYYY"){return e==null?"-":$(e).locale("th").add(543,"year").format(o)},convertThaiNo(e){return e?(e=e.replace(/1/g,"๑"),e=e.replace(/2/g,"๒"),e=e.replace(/3/g,"๓"),e=e.replace(/4/g,"๔"),e=e.replace(/5/g,"๕"),e=e.replace(/6/g,"๖"),e=e.replace(/7/g,"๗"),e=e.replace(/8/g,"๘"),e=e.replace(/9/g,"๙"),e=e.replace(/0/g,"๐"),e):""}}},oe={class:"report-management"},ne={class:"p-6"},ae={class:"md:flex justify-between pb-6 md:space-y-0 space-y-3 items-center"},se={class:"flex flex-wrap sm:flex-nowrap gap-3 basis-full"},ie={class:"flex basis-2/5"},re={class:"flex gap-3"},le={class:"flex items-center"},de=c("span",{class:"px-2"},"Export",-1),ce={class:"flex gap-5 basis-3/5 justify-end"},pe=c("div",{class:"text-center"},[c("div",{class:"text-gray-400"},"ไม่พบข้อมูล")],-1),me={key:0},ue={key:1},fe=c("br",null,null,-1),_e={key:2},he={key:3},ge={key:4,class:"text-red-500"},be={key:5},we=c("br",null,null,-1),xe={key:6},ye={class:"py-4 px-3"};function ve(e,o,i,n,t,a){const d=f("Icon"),l=f("Button"),r=f("Dropdown"),h=f("InputGroup"),v=f("AdvancedSearchStatus"),k=f("Pagination"),C=f("vue-good-table"),S=f("Card");return _(),u("div",oe,[p(S,{noborder:"",bodyClass:"p-0"},{default:b(()=>[c("div",ne,[c("div",ae,[c("div",se,[c("div",ie,[c("div",re,[p(r,{classMenuItems:"left-0  w-[220px] top-[110%]",items:t.exportLists,onOnClickItem:a.handleExport},{default:b(()=>[p(l,{btnClass:"btn-primary text-slate-50",div:"",iconClass:"text-lg"},{default:b(()=>[c("div",le,[p(d,{icon:"ic:baseline-cloud-download",class:"handle text-[20px]"}),de])]),_:1})]),_:1},8,["items","onOnClickItem"])])]),c("div",ce,[p(h,{modelValue:t.filter.keyword,"onUpdate:modelValue":o[0]||(o[0]=s=>t.filter.keyword=s),placeholder:"Search",type:"text",prependIcon:"heroicons-outline:search",merged:"",inputEnter:!0,"onEvent:inputEnter":o[1]||(o[1]=s=>a.getData(1))},null,8,["modelValue"]),p(l,{icon:"mdi:filter",text:"ค้นหาขั้นสูง",btnClass:"btn-primary rounded-md",onClick:o[2]||(o[2]=s=>t.isShowModalAS=!t.isShowModalAS)})])])])]),p(v,{isOpen:t.isShowModalAS,"onEvent:close":o[3]||(o[3]=s=>t.isShowModalAS=!1),"onEvent:submit":a.onFilter},null,8,["isOpen","onEvent:submit"]),p(C,{columns:t.columns,styleClass:" vgt-table bordered lesspadding2",rows:t.advancedTable,"pagination-options":{enabled:!0,perPage:t.paginate.perpage},"sort-options":{enabled:!1}},{emptystate:b(()=>[pe]),"table-row":b(s=>{var g,w,x,y,R,D,E,B,A,P,z,W,M,j;return[s.column.field=="id"?(_(),u("span",me,m(a.displayInitialNumber(s.row)),1)):s.column.field=="document_number"?(_(),u("span",ue,[T(m((g=s.row)!=null&&g.document_number?a.convertThaiNo((w=s.row)==null?void 0:w.document_number):"-")+" ",1),fe,T(" "+m(((x=s.row)==null?void 0:x.subject)??"-"),1)])):s.column.field=="from_id"?(_(),u("span",_e,m(((R=(y=s.row)==null?void 0:y.from_user)==null?void 0:R.organization_name)??((E=(D=s.row)==null?void 0:D.from_user)==null?void 0:E.name)??"-"),1)):s.column.field=="to_id"?(_(),u("span",he,m(((A=(B=s.row)==null?void 0:B.to_user)==null?void 0:A.full_name)??"-"),1)):s.column.field=="status"?(_(),u("span",ge,m((P=s.row)==null?void 0:P.status),1)):s.column.field=="pullback"?(_(),u("span",be,[T(m(((W=(z=s.row)==null?void 0:z.pullback_history[0])==null?void 0:W.pullback_reason)??"-")+" ",1),we,T(" ดึงกลับโดย: "+m(((j=a.findUser(t.common.user_list,(M=s.row)==null?void 0:M.pullback_history[0].user_id))==null?void 0:j.full_name)??"-"),1)])):(_(),u("span",xe,m(s.row[s.column.field]),1))]}),"pagination-bottom":b(s=>[c("div",ye,[p(k,{total:t.paginate.total,current:t.paginate.current_page,"per-page":t.paginate.perpage,pageRange:t.paginate.pageRange,onPageChanged:o[4]||(o[4]=g=>e.changePage(g)),pageChanged:s.pageChanged,perPageChanged:s.perPageChanged,textAfterInput:"ไปที่หน้า",enableSearch:"",enableInput:""},null,8,["total","current","per-page","pageRange","pageChanged","perPageChanged"])])]),_:1},8,["columns","rows","pagination-options"])]),_:1})])}const Ze=H(te,[["render",ve]]);export{Ze as default};
