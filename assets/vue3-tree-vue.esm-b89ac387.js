import{A as j,aA as $,k as z,$ as F,al as H,be as S,au as w,ab as I,as as g,o as k,n as N,bl as M,bb as Y,p as m,aE as v,ac as D,ad as f,U as y,bo as p,aT as A,ba as Q,bm as V,aF as O,F as W,aD as P,x as U,bj as b,u as X,aa as Z}from"./preload-helper-9e0646ca.js";const B="VUE3_TREE_VUE_TREE_STATE",J=(e,n)=>{e.children&&e.children.forEach(l=>{l.checked=e.checked,n.getNode(l.id).indeterminate=!1,J(l,n)})},G=(e,n)=>{if(!e)return;const l=n.getParent(e.id);if(!l)return;const s=n.getNode(l.id);if(l.children){const c=l.children.every(i=>i.checked),r=l.children.some(i=>!i.checked),a=l.children.some(i=>i.checked||n.getNode(i.id).indeterminate)&&r;c?(s.checked=!0,s.indeterminate=!1):a?(s.checked=!1,s.indeterminate=!0):(s.checked=!1,s.indeterminate=!1)}G(l,n)};var K=j({inheritAttrs:!0,props:{item:{type:Object,required:!0},isCheckable:{type:Boolean},canRename:{type:Boolean},checkboxStyle:{type:String},lazyLoad:{type:Boolean},hideGuideLines:{type:Boolean}},emits:["on-rename","onContextMenu"],setup(e,{emit:n,attrs:l}){const s=$(),c=z(()=>l.parent),r=F(B),t=()=>s.value.checked=e.item.checked;H(()=>{if(r.trackNode(e.item,c.value),e.item.checked)t(),G(e.item,r);else{var d;e.item.checked=(d=c.value)===null||d===void 0?void 0:d.checked}});const a=()=>{var d;e.item.checked=(d=s.value)===null||d===void 0?void 0:d.checked,e.item.indeterminate=!1,G(e.item,r),J(e.item,r),r.emitItemCheckedChange()};S(()=>e.item.indeterminate,()=>s.value.indeterminate=e.item.indeterminate),S(()=>e.item.checked,()=>t()),S(()=>e.item.expanded,()=>E(!1)),S(()=>{var d;return(d=e.item.children)===null||d===void 0?void 0:d.length},()=>{var d;return(d=e.item.children)===null||d===void 0?void 0:d.forEach(o=>r==null?void 0:r.trackNode(o,e.item))});const i=$(!1),u=$(),h=()=>{e.canRename&&(i.value=!0,I().then(()=>{var d;return(d=u.value)===null||d===void 0?void 0:d.focus()}))},L=()=>{i&&n("on-rename",e.item)},E=(d=!0)=>{d&&(e.item.expanded=!e.item.expanded,e.item.expanded?r.emitItemExpanded(e.item):r.emitItemCollapsed(e.item))};return{toggleExpand:E,treeState:r,updateCheckState:a,isRenaming:i,beginRenaming:h,finishRenaming:L,parent:c,checkbox:s}}});const x={key:0,class:"guide-line"},_={key:0,class:"tree-item__checkbox-area"},ee=["disabled"],ne={class:"d-flex"},te={class:"tiny_horizontal_margin"},ie={class:"tiny_horizontal_margin"},ae={key:0,for:"checkbox",class:"pointer"},oe={class:"tiny_horizontal_margin"},re={class:"tiny_horizontal_margin"};function se(e,n,l,s,c,r){return g(),k("div",{class:"d-flex align-items-center",onContextmenu:n[8]||(n[8]=p(t=>e.$emit("onContextMenu",{item:e.item,event:t}),["prevent"]))},[e.parent!=null&&!e.hideGuideLines?(g(),k("div",x)):N("",!0),M(m("div",{onClick:n[0]||(n[0]=t=>e.toggleExpand())},[v(e.$slots,"expander",f(y(e.item)),()=>[m("span",{class:D(["chevron-right",{"rotate-90":e.item.expanded}])},null,2)])],512),[[Y,e.lazyLoad||e.item.children&&e.item.children.length>0]]),m("div",{class:D(["pointer tree-item",{"selected-tree-item":!e.isCheckable&&e.item.selected}]),style:{width:"100%"}},[e.isRenaming?M((g(),k("input",{key:1,ref:"rename-box","onUpdate:modelValue":n[5]||(n[5]=t=>e.item.name=t),onKeyup:n[6]||(n[6]=V((...t)=>e.finishRenaming&&e.finishRenaming(...t),["enter"])),onBlur:n[7]||(n[7]=(...t)=>e.finishRenaming&&e.finishRenaming(...t))},null,544)),[[Q,e.item.name]]):(g(),k("div",{key:0,onDblclick:n[4]||(n[4]=(...t)=>e.beginRenaming&&e.beginRenaming(...t))},[e.isCheckable?(g(),k("div",_,[m("input",{onContextmenu:n[1]||(n[1]=p(()=>{},["prevent"])),onChange:n[2]||(n[2]=(...t)=>e.updateCheckState&&e.updateCheckState(...t)),type:"checkbox",ref:"checkbox",disabled:e.item.disabled,class:D(e.checkboxStyle)},null,42,ee),m("div",ne,[m("div",te,[v(e.$slots,"icon")]),m("div",ie,[v(e.$slots,"prepend")])]),e.isRenaming?N("",!0):(g(),k("label",ae,A(e.item.name),1)),m("div",null,[v(e.$slots,"append")])])):(g(),k("div",{key:1,class:"d-flex",onClick:n[3]||(n[3]=t=>{var a;return(a=e.treeState)===null||a===void 0?void 0:a.emitItemSelected(e.item)})},[m("div",oe,[v(e.$slots,"icon")]),m("div",re,[v(e.$slots,"prepend")]),m("span",null,A(e.item.name),1),m("div",null,[v(e.$slots,"append")])]))],32))],2)],32)}K.render=se;function de(){const e=t=>{const a=t.currentTarget;a&&a.classList.add("tree-item__drag-over")},n=(t,a)=>{if(!a)return;const i=t.currentTarget;i&&i.classList.add("root__drag-over")},l=(t,a)=>{if(!a)return;const i=t.currentTarget;i&&i.classList.remove("root__drag-over")},s=t=>{const a=t.currentTarget;a&&a.classList.remove("tree-item__drag-over")};return{addHoverClass:e,removeHoverClass:s,onDragNode:(t,a)=>{a.dataTransfer&&a.dataTransfer.setData("text/plain",JSON.stringify(t))},onDropNode:(t,a,i,u)=>{if(a.dataTransfer){s(a);const h=JSON.parse(a.dataTransfer.getData("text/plain"));if(!i||!i(h,t)||t&&h.id===t.id)return;u.detach(h.id),t&&!t.children&&(t.children=[]),t?t.children.push(h):u.attach(h)}},addRootHoverClass:n,removeRootHoverClass:l}}function le(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(Number.parseFloat(e)^crypto.getRandomValues(new Uint8Array(1))[0]&15>>Number.parseFloat(e)/4).toString(16))}function ue(e,n,l,s,c){const r={},t={},a=o=>r[o],i=(o,C)=>{o.id||(o.id=le()),t[o.id]=o,r[o.id]=C};return{getNode:o=>t[o],getParent:a,trackNode:i,detach:o=>{const C=r[o];if(C==null)e.value=e.value.filter(T=>T.id!=o);else{var R;C.children=(R=C.children)===null||R===void 0?void 0:R.filter(T=>T.id!=o)}delete r[o]},emitItemCheckedChange:()=>l(Object.values(t).filter(o=>o.checked&&!o.disabled)),emitItemSelected:o=>{o.disabled!==!0&&(n(o),Object.values(t).forEach(C=>C.selected=!1),o.selected=!0)},emitItemExpanded:s,emitItemCollapsed:c,attach:o=>{e.value.push(o),i(o,void 0)}}}var q=j({name:"tree-view",props:{items:{type:Array,required:!0,default:()=>[]},isCheckable:{type:Boolean},hideGuideLines:{type:Boolean,default:!1},onDropValidator:{type:Function},treeState:{type:Object},checkboxStyle:{type:String},lazyLoad:{type:Boolean}},components:{"treeview-item":K},emits:["onContextMenu","onSelect","onCheck","onExpand","onCollapse"],setup(e,{emit:n,attrs:l}){const s=$([]);S(()=>e.items,()=>s.value=e.items,{immediate:!0});const c=z(()=>l.parent),r=z(()=>s.value.map(a=>a)),t=$();return t.value=F(B,void 0),t.value||(t.value=ue(s,a=>n("onSelect",a),a=>n("onCheck",a),a=>n("onExpand",a),a=>n("onCollapse",a)),w(B,t.value)),{...de(),parent:c,internalItems:r,treeState:t}}});const me=["id"],pe={style:{"list-style":"none"}};function ve(e,n,l,s,c,r){const t=O("treeview-item"),a=O("tree-view");return g(),k("div",null,[m("ul",{id:"explorer",class:D(["explorer tree-item-node-parent",{"no-guide":e.hideGuideLines}]),onDragover:[n[3]||(n[3]=p(()=>{},["stop","prevent"])),n[5]||(n[5]=p(i=>e.addRootHoverClass(i,e.parent==null),["stop"]))],onDragenter:n[4]||(n[4]=p(()=>{},["stop","prevent"])),onDragleave:n[6]||(n[6]=p(i=>e.removeRootHoverClass(i,e.parent==null),["stop"])),onDrop:n[7]||(n[7]=p(i=>{e.onDropNode(void 0,i,e.onDropValidator,e.treeState),e.removeRootHoverClass(i,e.parent==null)},["prevent","stop"]))},[(g(!0),k(W,null,P(e.internalItems,i=>(g(),k("li",{key:i.id,id:i.id,class:"tree-item-node"},[U(t,{class:"pointer tree-view-item",item:i,parent:e.parent,hideGuideLines:e.hideGuideLines,onDragover:[n[0]||(n[0]=p(()=>{},["stop","prevent"])),p(e.addHoverClass,["stop"])],onDragenter:n[1]||(n[1]=p(()=>{},["stop","prevent"])),draggable:e.onDropValidator!=null,onDragstart:p(u=>e.onDragNode(i,u),["stop"]),onDragleave:p(e.removeHoverClass,["stop"]),onDrop:p(u=>e.onDropNode(i,u,e.onDropValidator,e.treeState),["prevent","stop"]),checkboxStyle:e.checkboxStyle,isCheckable:e.isCheckable,treeState:e.treeState,lazyLoad:e.lazyLoad,onContextmenu:p(u=>e.$emit("onContextMenu",{item:i,event:u}),["prevent"])},{icon:b(()=>[v(e.$slots,"item-prepend-icon",f(y(i)))]),prepend:b(()=>[v(e.$slots,"item-prepend",f(y(i)))]),expander:b(()=>[v(e.$slots,"item-expander",f(y(i)))]),name:b(()=>[v(e.$slots,"item-name",f(y(i)))]),append:b(()=>[v(e.$slots,"item-append",f(y(i)))]),_:2},1032,["item","parent","hideGuideLines","draggable","onDragstart","onDragleave","onDrop","onDragover","checkboxStyle","isCheckable","treeState","lazyLoad","onContextmenu"]),i.children&&i.children.length>0?(g(),k("div",{key:0,class:D(["node-child",{nested:e.parent!=null,root:e.parent==null,hide:!i.expanded,"hide-guidelines":e.hideGuideLines}])},[U(a,{items:i.children,hideGuideLines:e.hideGuideLines,isNested:!0,onDropValidator:e.onDropValidator,lazyLoad:e.lazyLoad,checkboxStyle:e.checkboxStyle,parent:i,isCheckable:e.isCheckable,onOnContextMenu:n[2]||(n[2]=u=>e.$emit("onContextMenu",u))},X({_:2},[P(e.$slots,(u,h)=>({name:h,fn:b(L=>[v(e.$slots,h,f(y(L)))])}))]),1032,["items","hideGuideLines","onDropValidator","lazyLoad","checkboxStyle","parent","isCheckable"])],2)):N("",!0)],8,me))),128))],34),m("li",pe,[e.parent?v(e.$slots,"child-append",f(Z({key:0},e.parent))):N("",!0)])])}q.render=ve;var he=(()=>{const e=q;return e.install=n=>{n.component("vue3-tree-vue",e)},e})();export{he as e};
