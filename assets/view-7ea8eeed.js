import{C as W}from"./index-263882d1.js";import{I as q}from"./index-72ee420c.js";import{B as G}from"./index-441935dc.js";import{E as X}from"./index-1c6333b5.js";import{D as Z}from"./index-090a8953.js";import{C as $,B as ee,A as te,a as se,b as oe,R as ne}from"./RouteDetail-b3469ae3.js";import{M as ie}from"./index-7dc8252b.js";import{M as ae}from"./index-2a7f4259.js";import{aA as V,al as le,k as Y,be as j,aF as n,as as _,o as D,m as y,bj as p,p as e,x as o,F as re,aD as ce,ac as ue,aT as B,n as S,bo as H,w as de}from"./preload-helper-9e0646ca.js";import{M as J}from"./Modal-19eb68c4.js";import{T as me}from"./index-31d1a8ca.js";import{T as K}from"./index-ce9a51c5.js";import{P as pe}from"./index-3e810d59.js";import{u as _e,a as F}from"./vee-validate.esm-0c282d04.js";import{T as fe}from"./TextValid-100be459.js";import{c as ge,a as O}from"./array-e684e252.js";import{B as ve,D as I,_ as Q,c as P,t as A,a as R}from"./index-e058a960.js";import{l as xe,a as be,n as he,r as ye,u as Se}from"./tabs-aa384b53.js";import{A as ke}from"./AttachedFileStamp-b7cdd757.js";import{B as Me}from"./BookDraftRef-746d0155.js";import{d as Ce}from"./dayjs.min-72c81edc.js";import"./iconify-4e42c13d.js";import"./dom-891ac6c3.js";import"./focus-management-e6c5d1fd.js";import"./open-closed-486d85f0.js";import"./use-resolve-button-type-38f1f99a.js";import"./use-outside-click-a758fdce.js";import"./index-1b218db3.js";import"./transition-39b574f4.js";import"./hidden-11a9ab9d.js";import"./micro-task-89dcd6af.js";import"./index-cc7a2b4b.js";import"./vue-cleave.min-9e1201c2.js";const we={name:"Success",props:{title:{type:String,default:""},isOpen:{type:Boolean,default:!1},item:{type:Object,default:{}},pinError:{type:String,default:""}},components:{Modal:J,Button:G,Textinput:me,Icon:q,PinInput:pe,Textarea:K,TextValid:fe,VueSignaturePad:ve,TabGroup:xe,TabList:be,Tab:he,TabPanels:ye,TabPanel:Se},data:()=>({options:{penColor:"#c0f"}}),methods:{undo(){this.$refs.signaturePad.undoSignature()},undo(){this.$refs.signaturePad.undoSignature()},remove(){I().clearSignature(),this.$refs.signaturePad.clearSignature()},save(){const{isEmpty:i,data:t}=this.$refs.signaturePad.saveSignature();I().handleSignature(t)},closeModal(){this.$emit("event:closeModal")}},emits:["event:submit","event:closeModal","event:pincode"],setup(i,t){const u=V(0),l=V(!1),s=V([{title:"ใบรับรองอิเล็กทรอนิกส์"},{title:"วาดลายมือชื่อ"}]);le(()=>{h.value||(u.value=1)});const r=ge({suggesstion:O().required("กรุณากรอกข้อเสนอแนะ"),signature:O().required("กรุณาใส่ลายเซ็น").nullable(),pincode:O().required("กรุณากรอกรหัส PIN Code ของใบอนุญาติอิเล็กทรอนิกส์")}),{handleSubmit:g,resetForm:x}=_e({validationSchema:r}),{value:k,errorMessage:M}=F("suggesstion"),{value:d,errorMessage:C}=F("signature"),{value:v,errorMessage:w}=F("pincode"),b=a=>{console.log("updatePin",a),v.value=a},E=Y(()=>I().signature),h=Y(()=>{var a,f;return(a=P().userInfo)!=null&&a.signature_path?A+((f=P().userInfo)==null?void 0:f.signature_path):""});j(()=>v.value,a=>{t.emit("event:pincode",a)}),j(()=>E.value,a=>{d.value=a,a&&(l.value=!0)}),j(()=>u.value,a=>{var f;a==0&&(d.value=(f=P().userInfo)==null?void 0:f.signature_path)},{immediate:!0});const T=a=>{var f;u.value=a,d.value="",a==0&&(d.value=(f=P().userInfo)==null?void 0:f.signature_path),console.log("tabtab",a)},m=g(async()=>{t.emit("event:submit",{id:i.item.id,suggesstion:k.value,signature:d.value,pincode:v.value})});return{selected:u,pincode:v,pincodeError:w,tabMenu:s,suggesstion:k,suggesstionError:M,signature:d,signatureError:C,isSaveSignature:l,updatePin:b,submit:m,changeTab:T,signatureImage:h}}},Ee={class:"px-20 space-y-4 mb-12"},Te={class:"list flex"},Be=e("div",{class:"text-gray-500 text-[16px] basis-1/4"},"เสนอแนะ",-1),Pe={class:"basis-3/4"},Re={class:"list space-x-4"},De=e("div",{class:"text-gray-500 text-[20px] mb-2"},"ลงนามเสนอแนะ",-1),Ie={class:"text-slate-600 text-sm font-normal flex space-x-3 items-center"},Ve=["src"],je=e("div",{class:"text-gray-500 text-[16px] basis-1/4"}," วาดลายมือชื่อ (ภาษาไทย) ",-1),Fe={class:"text-slate-600 text-sm font-normal"},Oe={class:"border-2"},Ae={class:"container p-2 space-y-2"},ze={class:"flex justify-between items-center gap-3"},Ne=e("div",{class:"md:text-[12px] text-[10px]"}," วาดลายมือชื่อ ",-1),Le={class:"flex gap-2"},Ue={class:"p-2 border-t"},Ye={key:0,class:"flex justify-end"},qe={class:"text-[16px] basis-1/4"},Ge={class:"mt-3 flex"},He=e("div",{class:"text-gray-500 text-[16px] basis-1/4"},"รหัส PIN Code",-1),Je={class:"basis-3/4 justify-start space-y-1"},Ke={class:"text-[16px] basis-1/4"},Qe=e("hr",{class:"my-2"},null,-1),We={class:"flex justify-center w-full"};function Xe(i,t,u,l,s,r){const g=n("Textarea"),x=n("Tab"),k=n("TabList"),M=n("TabPanel"),d=n("Icon"),C=n("VueSignaturePad"),v=n("TabPanels"),w=n("TabGroup"),b=n("TextValid"),E=n("PinInput"),h=n("Button"),T=n("Modal");return _(),D("div",null,[u.isOpen?(_(),y(T,{key:0,title:u.title,label:"",labelClass:"btn-outline-dark",sizeClass:"w-3/5 z-[99]",ref:"modalDialog",centered:"",activeModal:u.isOpen,"onEvent:closeModal":t[3]||(t[3]=m=>r.closeModal())},{default:p(()=>[e("form",{onSubmit:t[2]||(t[2]=H((...m)=>l.submit&&l.submit(...m),["prevent"]))},[e("div",Ee,[e("div",Te,[Be,e("div",Pe,[o(g,{placeholder:"",classInput:"border border-gray-400 text_area_bg p-3",rows:4,modelValue:l.suggesstion,"onUpdate:modelValue":t[0]||(t[0]=m=>l.suggesstion=m),error:l.suggesstionError},null,8,["modelValue","error"])])]),e("div",Re,[De,o(w,{selectedIndex:l.selected,onChange:l.changeTab},{default:p(()=>[o(k,{class:"flex"},{default:p(()=>[(_(!0),D(re,null,ce(l.tabMenu,(m,a)=>(_(),y(x,{as:"template",disabled:!l.signatureImage&&a==0,key:a,class:"basis-1/2"},{default:p(()=>[e("button",{class:ue([[l.selected==a?"text-primary-500 before:w-full border-b-2 border-primary-500":"text-slate-500 before:w-0 dark:text-slate-300 border-b-2 border-gray-200"],"text-sm font-medium mb-2 capitalize bg-gray-200 py-2"])},B(m.title),3)]),_:2},1032,["disabled"]))),128))]),_:1}),o(v,null,{default:p(()=>[o(M,null,{default:p(()=>[e("div",Ie,[e("img",{src:l.signatureImage,class:"h-[80px] w-[150px] object-cover border"},null,8,Ve),je])]),_:1}),o(M,null,{default:p(()=>[e("div",Fe,[e("div",Oe,[e("div",Ae,[e("div",ze,[Ne,e("div",Le,[o(d,{icon:"material-symbols:save",class:"text-green-500 text-2xl pr-2 border-r",onClick:r.save},null,8,["onClick"]),o(d,{icon:"dashicons:undo",class:"text-gray-500 text-2xl",onClick:r.undo},null,8,["onClick"]),o(d,{icon:"material-symbols:delete",class:"text-red-500 text-2xl",onClick:r.remove},null,8,["onClick"])])]),e("div",Ue,[o(C,{id:"signature",ref:"signaturePad"},null,512)]),l.isSaveSignature&&l.signature?(_(),D("div",Ye,[o(d,{icon:"gg:check-o",class:"text-2xl text-green-500"})])):S("",!0)])])])]),_:1})]),_:1})]),_:1},8,["selectedIndex","onChange"]),e("div",qe,[o(b,{valid:l.signatureError},null,8,["valid"])])]),e("div",Ge,[He,e("div",Je,[o(E,{"onUpdate:modelValue":l.updatePin,classInput:"border border-gray-400",placeholder:"กรอกรหัส Pin Code"},null,8,["onUpdate:modelValue"]),e("div",Ke,[o(b,{valid:l.pincodeError},null,8,["valid"]),o(b,{valid:u.pinError},null,8,["valid"])])])])]),Qe,e("div",We,[o(h,{text:"ยืนยัน",type:"submit",btnClass:"btn-primary w-32 mx-2"}),o(h,{text:"ยกเลิก",btnClass:"btn-outline-dark w-32 mx-2",onClick:t[1]||(t[1]=m=>r.closeModal())})])],32)]),_:1},8,["title","activeModal"])):S("",!0)])}const Ze=Q(we,[["render",Xe]]);const $e={name:"ReceiveView",components:{Card:W,Icon:q,Button:G,Expansion:X,Dropdown:Z,Textarea:K,Modal:J,CoverSheet:$,BookDetail:ee,AttachedFile:te,BookReference:se,Activity:oe,RouteDetail:ne,AttachedFileStamp:ke,BookDraftRef:Me,ModalSuccess:ie,ModalSuggesstion:Ze,ModalError:ae},data(){return{isOpen:!1,pdfPath:"",urlSarabun:A,item:null,isSuccess:!1,isSuggesstion:!1,isShowModalReturn:!1,returnBookReason:"",isError:!1,errorMessage:"",pinError:""}},created(){this.fetchData()},methods:{async pdfHistory(){const{data:i,status:t}=await R("documentStore","PDFHistory",{payload:this.$route.params.id});t==200&&(console.log("data pdf",i.result),this.pdfPath=i.result,this.isOpen=!0)},async fetchData(){const{data:i,status:t}=await R("suggestionStore","show",{payload:this.$route.params.id});t===200&&(this.item=i.result)},convertDate(i){return i?Ce(i).locale("th").add(543,"year").format("DD/MM/YYYY"):"-"},async handleSuggesstion(){this.isSuggesstion=!0},onReturn(){this.isShowModalReturn=!0},async acceptReturn(){const{data:i,status:t}=await R("suggestionStore","return",{payload:{id:this.$route.params.id,returned_reason:this.returnBookReason}});this.isShowModalReturn=!1,t===200?this.$router.push("/app/issue/suggestion"):(this.isError=!0,this.errorMessage=i==null?void 0:i.message)},closeModal(){this.isSuccess=!1,this.isSuggesstion=!1,this.isShowModalReturn=!1},downloadFileDocument(i){console.log(i)},downloadFile(i){const t=A+i;window.open(t,"_blank")},async suggesstionSubmit(i){var u;const t=await R("suggestionStore","store",{payload:i});console.log("data",t),t.status===200?(this.isSuccess=!0,this.isSuggesstion=!1,I().clearSignature):t.status===403&&(this.pinError=(u=t.data)==null?void 0:u.message)}}},et={class:"flex justify-center mb-4 py-4 bg-gray-100"},tt={class:"flex justify-between items-center"},st={class:"basis-1/2"},ot={class:"flex items-center gap-3"},nt={class:"shrink w-[145px]"},it=e("div",null,"กลับไปหน้ารายการ",-1),at={class:"flex items-center border-l-2 gap-3 border-gray-300 px-4"},lt={class:"basis-1/2 flex justify-end items-center"},rt={class:"text-2xl font-medium my-6"},ct={class:"h-[250px] flex items-center justify-center"},ut={class:"text-center flex flex-row flex-wrap justify-center"},dt={class:"basis-full flex justify-center mb-5"},mt=e("div",null,[e("h4",{class:"text-lg text-slate-900"},[de(" ส่งหนังสือเพื่อเสนอแนะ "),e("span",{class:"text-green-500"},"สำเร็จ")])],-1),pt=e("hr",null,null,-1),_t={class:"flex justify-center mt-4"},ft={class:"list space-y-1 px-10"},gt=e("div",{class:"text-base text-slate-600"}," เหตุผลในการคืนเรื่องแก้ไข ",-1),vt={class:"flex justify-center mt-4"},xt={class:"text-lg text-slate-900"},bt=["src"];function ht(i,t,u,l,s,r){const g=n("Button"),x=n("Icon"),k=n("CoverSheet"),M=n("BookDetail"),d=n("AttachedFileStamp"),C=n("BookDraftRef"),v=n("AttachedFile"),w=n("BookReference"),b=n("Activity"),E=n("RouteDetail"),h=n("Card"),T=n("ModalSuggesstion"),m=n("Modal"),a=n("Textarea"),f=n("ModalError");return _(),D("div",null,[o(h,null,{default:p(()=>{var c,z,N,L,U;return[e("div",et,[o(g,{onClick:r.handleSuggesstion,text:"เสนอแนะ",btnClass:"btn-primary h-[40px] flex items-center"},null,8,["onClick"])]),e("div",tt,[e("div",st,[e("div",ot,[e("div",nt,[e("div",{onClick:t[0]||(t[0]=yt=>i.$router.back()),class:"flex items-center text-primary-600 cursor-pointer"},[o(x,{icon:"mdi:chevron-left",class:"text-xl"}),it])]),e("div",at,[o(g,{onClick:r.onReturn,text:"คืนเรื่อง",btnClass:"btn-danger h-[40px] flex items-center"},null,8,["onClick"])])])]),e("div",lt,[o(x,{icon:"mdi:chevron-left",class:"text-xl cursor-pointer"}),o(x,{icon:"mdi:chevron-right",class:"text-xl cursor-pointer"})])]),e("div",rt," วันที่ "+B(r.convertDate((c=s.item)==null?void 0:c.document_date))+" "+B((z=s.item)==null?void 0:z.subject)+" พ.ศ. "+B((N=s.item)==null?void 0:N.year),1),o(k,{item:s.item},null,8,["item"]),o(M,{item:s.item},null,8,["item"]),((L=s.item)==null?void 0:L.doc_pickup_type)=="หนังสือรับ"?(_(),y(d,{key:0,item:s.item},null,8,["item"])):S("",!0),((U=s.item)==null?void 0:U.doc_pickup_type)=="หนังสือส่ง"?(_(),y(C,{key:1,item:s.item},null,8,["item"])):S("",!0),o(v,{item:s.item},null,8,["item"]),o(w,{item:s.item},null,8,["item"]),o(b,{item:s.item,"onEvent:onClick":r.pdfHistory},null,8,["item","onEvent:onClick"]),o(E,{item:s.item},null,8,["item"])]}),_:1}),o(T,{item:s.item,title:"เสนอแนะ",isOpen:s.isSuggesstion,pinError:s.pinError,"onEvent:closeModal":t[1]||(t[1]=c=>s.isSuggesstion=!1),"onEvent:submit":r.suggesstionSubmit,"onEvent:pincode":t[2]||(t[2]=c=>s.pinError="")},null,8,["item","isOpen","pinError","onEvent:submit"]),s.isSuccess?(_(),y(m,{key:0,title:"",activeModal:s.isSuccess,"onEvent:closeModal":t[4]||(t[4]=c=>s.isSuccess=!1),label:"",labelClass:"btn-outline-dark",sizeClass:"w-full max-w-[700px]",centered:""},{default:p(()=>[e("div",ct,[e("div",ut,[e("div",dt,[o(x,{icon:"icon-park-solid:protect",class:"text-6xl text-green-500"})]),mt])]),pt,e("div",_t,[o(g,{text:"ไปหน้ารายการ",btnClass:"btn-outline-dark w-32 mx-2",onClick:t[3]||(t[3]=c=>i.$router.push("/app/issue/suggestion"))})])]),_:1},8,["activeModal"])):S("",!0),s.isShowModalReturn?(_(),y(m,{key:1,title:"คืนเรื่องแก้ไข",activeModal:s.isShowModalReturn,"onEvent:closeModal":t[8]||(t[8]=c=>s.isShowModalReturn=!1),label:"",labelClass:"btn-outline-dark",sizeClass:"w-2/4",centered:""},{default:p(()=>[e("form",{onSubmit:t[7]||(t[7]=H((...c)=>r.acceptReturn&&r.acceptReturn(...c),["prevent"])),class:"overflow-y-auto"},[e("div",null,[e("div",ft,[gt,o(a,{modelValue:s.returnBookReason,"onUpdate:modelValue":t[5]||(t[5]=c=>s.returnBookReason=c),placeholder:"",name:"detail",classInput:"border border-gray-400 text_area_bg p-3",rows:6},null,8,["modelValue"])]),e("div",vt,[o(g,{type:"submit",text:"ยืนยัน",btnClass:"btn-primary w-32 mx-2"}),o(g,{text:"ยกเลิก",btnClass:"btn-outline-dark w-32 mx-2",onOnClick:t[6]||(t[6]=c=>r.closeModal())})])])],32)]),_:1},8,["activeModal"])):S("",!0),o(f,{title:"",isOpen:s.isError,"onEvent:closeModal":t[9]||(t[9]=c=>s.isError=!1)},{default:p(()=>[e("div",xt,B(s.errorMessage),1)]),_:1},8,["isOpen"]),s.isOpen?(_(),y(m,{key:2,title:"ดูรายละเอียดเอกสาร",labelClass:"btn-outline-dark",sizeClass:"w-3/4",label:"",centered:"",activeModal:s.isOpen,"onEvent:closeModal":t[10]||(t[10]=c=>s.isOpen=!1)},{default:p(()=>[e("div",null,[e("iframe",{class:"w-full h-[1000px] mt-4",src:"data:application/pdf;base64, "+s.pdfPath,frameborder:"0"},null,8,bt)])]),_:1},8,["activeModal"])):S("",!0)])}const ts=Q($e,[["render",ht]]);export{ts as default};
