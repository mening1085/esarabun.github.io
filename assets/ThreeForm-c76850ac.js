import{E as N}from"./index-1c6333b5.js";import{B as P}from"./index-441935dc.js";import{I as R}from"./index-72ee420c.js";import{T as G}from"./TextValid-100be459.js";import{C as q,V as A}from"./VueSelect-4c8519b3.js";import{T as H}from"./index-31d1a8ca.js";import{aA as c,al as J,k as K,aF as u,as as m,o as _,x as l,bj as M,p as e,m as Q,n as E,F as S,aD as U,aT as W,bo as X,w as F}from"./preload-helper-9e0646ca.js";import{M as Y}from"./index-86a58ede.js";import{M as Z}from"./index-96a9bfa7.js";import{_ as $,g as ee,u as te,a as B}from"./index-e058a960.js";import{C as ae}from"./index-8994827d.js";import{C as le}from"./index-2d8ae848.js";const se={name:"SendToOrg",props:{item:{type:Object,default:()=>{}},userList:{type:Array,default:()=>[]},organizeList:{type:Array,default:()=>[]},customList:{type:Array,default:()=>[]},activeTab:{type:Boolean,default:!1}},components:{CFlatPickr:le,Checkbox:ae,ModalDrive:Z,ModalOrganizeAll:Y,Expansion:N,Button:P,Icon:R,vSelect:q,VueSelect:A,TextValid:G,Textinput:H},computed:{isMobile(){return ee().isMobile}},emits:["event:submit"],setup(p,s){const d=c(!1),a=te(),T=c(""),w=c(""),f=c([]),v=c(null),b=c(!1),x=c(!1),y=c([]),L=c([{label:"ประเภท",field:"type",width:"100px"},{label:"ชื่อหน่วยงาน/บุคคล",field:"officer",width:"500px"},{label:"อีเมล",field:"email",width:"330px"},{label:"จัดการ",field:"action",width:"80px",class:"text-center"}]),C=c([]),g=c(""),I=c([{label:"นาที"},{label:"ชั่วโมง"},{label:"วัน"},{label:"ปี"}]),O=c([{label:"การแจ้งเตือน"},{label:"อีเมล"}]),o=t=>{t=="org"?b.value=!0:t=="drive"&&(x.value=!0)},h=()=>{x.value=!1,b.value=!1},r=async(t,n)=>{if(t=="org")y.value=n,b.value=!1;else if(t=="drive"){x.value=!1,w.value=n,console.log("drive selected: ",n),console.log("check item",p.item);let k={srb_document_id:p.item.id?p.item.id:null,document_type:"หนังสืออื่นๆ",name:p.item.subject,description:p.item.detail,file_path:p.item.book_pdf_path,visibility:"published",folder_level:n.document_level=="document_folder"?"folder":"subfolder",document_folder_id:n.document_level==="document_folder"?n.item_id:null,document_subfolder_id:n.document_level==="document_sub_folder"?n.item_id:null};console.log("payload",k);const{data:z,status:j}=await B("driveStore","store",{payload:k});j==200&&console.log("ส่ง drive ได้แล้ว")}},i=t=>{console.log("delete",t),v.value.removeItemGroupArray(t)};J(async()=>{const{data:t,status:n}=await B("driveStore","get");n==200&&(console.log("DriveData",t.result),f.value=t.result,setTimeout(()=>{d.value=!0},2e3))});const D=async()=>{g.value&&C.value.length!=0?s.emit("event:submit",{id:a.currentRoute.value.params.id,is_send_mail:!!T.value,send_to:y.value.length!=0?y.value.map(t=>({type:t.data_type,email:t.email,send_to_id:t.data_id})):V.value.map(t=>({type:t.data_type,email:t.email?t.email:"",send_to_id:t.data_id})),deadline_export:g.value,notify:C.value.map(t=>({notify_type:t.noti,notify_time:t.amount}))}):alert("ตั้งค่ากำหนดการส่ง")},V=K(()=>{var t;return(t=p.item)==null?void 0:t.document_attn_inside.map(n=>{var k,z;return{name:n.attn_data.organization_name?n.attn_data.organization_name:n.attn_data.full_name,data_type:n.attn_type,email:n.attn_type=="users"?(k=n.attn_data)==null?void 0:k.email:(z=n.attn_data)==null?void 0:z.emailData,data_id:n.attn_data.id}})});return{autoItemsTable:V,isMinDate:d,submit:D,driveID:w,notiList:C,deadlineDate:g,dateType:I,notiType:O,advancedTable:y,columns:L,isOpen:b,isOpenDrive:x,openModal:o,closeModal:h,accept:r,ModalOrganizeAll:v,deleteOfficer:i,driveList:f,notiEmail:T}}},oe={class:"px-4"},ne={class:"pt-5"},ie={class:"overflow-scroll pb-6 mt-4 table_organize"},de={class:"w-full min-w-[600px]"},ce=e("th",{class:"w-[50px] text-start"},"ประเภท",-1),re=e("th",{class:"w-[150px] text-start"},"ชื่อหน่วยงาน/บุคคล",-1),ue=e("th",{class:"w-[150px] text-start px-2"},"อีเมล",-1),me={key:0,class:"w-[50px] text-center"},_e={class:"w-[50px]"},pe={class:"w-[150px]"},fe={class:"w-[150px] px-2"},ve={key:0},be={key:1},xe={key:0,class:"w-[50px]"},ye={class:"flex justify-center"},ge={class:"px-5 py-4"},he={class:"space-y-2 p-4 md:p-10"},we={class:"flex py-2 md:flex-nowrap flex-wrap"},Ce=e("div",{class:"basis-full md:basis-1/4 text-start pt-3 text-[16px] text-gray-400"},[F(" กำหนดวันที่ส่งหนังสือ "),e("span",{class:"text-red-600"},"*")],-1),Ve={class:"basis-full md:basis-1/4"},ke={class:"flex items-center border bg-gray-50 rounded-md pr-2 border-gray-400"},Me={class:"basis-full"},Te={class:"shrink w-[20px]"},Le={class:"flex py-2 md:flex-nowrap flex-wrap"},Ie=e("div",{class:"basis-full md:basis-1/4 text-start pt-3 text-[16px] text-gray-400"},[F(" การแจ้งเตือน "),e("span",{class:"text-red-600"},"*")],-1),Oe={class:"basis-full md:basis-3/4"},De={class:"gap-2 flex items-center"},ze={class:"basis-3/5 md:basis-2/6"},Ee={class:"basis-1/5 md:basis-2/6"},Se={class:"basis-1/5 md:basis-1/6 flex"},Ue=e("div",{class:"px-2 text-[12px] md:text-[16px]"},"วัน",-1),Be={class:""},Fe={class:"flex justify-center"},je={class:""},Ne={class:"space-y-2 p-10"},Pe={class:"text-center mt-20 mb-10 flex justify-center"};function Re(p,s,d,a,T,w){const f=u("Button"),v=u("Icon"),b=u("vSelect"),x=u("VueSelect"),y=u("Textinput"),L=u("Checkbox"),C=u("ModalOrganizeAll"),g=u("Expansion"),I=u("CFlatPickr"),O=u("ModalDrive");return m(),_("div",null,[l(g,{parentClass:"space-y-5 mb-6 "+(w.isMobile?"-mx-6":""),title:"ส่งหนังสือต่อให้หน่วยงาน",activeItem:d.activeTab},{default:M(()=>{var o,h,r;return[e("div",oe,[e("div",ne,[(o=d.item)!=null&&o.is_circular?E("",!0):(m(),Q(f,{key:0,onClick:s[0]||(s[0]=i=>a.openModal("org")),icon:"grommet-icons:tree",text:"เลือกหน่วยงาน",btnClass:"btn-primary rounded-md"}))]),e("div",ie,[e("table",de,[e("tr",null,[ce,re,ue,(h=d.item)!=null&&h.is_circular?E("",!0):(m(),_("th",me," จัดการ "))]),(m(!0),_(S,null,U((r=d.item)!=null&&r.is_circular?a.autoItemsTable:a.advancedTable,(i,D)=>{var V;return m(),_("tr",{key:D},[e("td",_e,[l(v,{class:"text-2xl text-blue-500",icon:i.icon?i.icon:i.data_type=="organizations"?"grommet-icons:tree":"mingcute:user-4-fill"},null,8,["icon"])]),e("td",pe,W(i.name),1),e("td",fe,[i.data_type=="organizations"?(m(),_("div",ve,[l(x,{classInput:"input_color"},{default:M(()=>[l(b,{label:"email",class:"input_color bg-gray-100 rounded w-full",reduce:t=>t.email,options:i.emails,modelValue:i.email,"onUpdate:modelValue":t=>i.email=t},null,8,["reduce","options","modelValue","onUpdate:modelValue"])]),_:2},1024)])):(m(),_("div",be,[l(y,{classInput:"bg-gray-100 border-gray-200 w-full",modelValue:i.email,"onUpdate:modelValue":t=>i.email=t,isReadonly:""},null,8,["modelValue","onUpdate:modelValue"])]))]),(V=d.item)!=null&&V.is_circular?E("",!0):(m(),_("td",xe,[e("div",ye,[l(v,{icon:"fa6-solid:trash-can",class:"text-gray-500 cursor-pointer",onClick:t=>a.deleteOfficer(i)},null,8,["onClick"])])]))])}),128))]),e("div",ge,[l(L,{label:"แจ้งเตือนผู้รับทางอีเมล",activeClass:"bg-primary-500",modelValue:a.notiEmail,"onUpdate:modelValue":s[1]||(s[1]=i=>a.notiEmail=i)},null,8,["modelValue"])])])]),l(C,{ref:"ModalOrganizeAll",title:"เลือกหน่วยงาน",isOpen:a.isOpen,organizeList:d.organizeList,userList:d.userList,customList:d.customList,"onEvent:close":a.closeModal,"onEvent:accept":s[2]||(s[2]=i=>a.accept("org",i))},null,8,["isOpen","organizeList","userList","customList","onEvent:close"])]}),_:1},8,["parentClass","activeItem"]),l(g,{parentClass:"space-y-5 mb-6 "+(w.isMobile?"-mx-6":""),title:"ตั้งค่ากำหนดการส่ง",activeItem:d.activeTab},{default:M(()=>[e("div",he,[e("div",we,[Ce,e("div",Ve,[e("div",ke,[e("div",Me,[l(I,{modelValue:a.deadlineDate,"onUpdate:modelValue":s[3]||(s[3]=o=>a.deadlineDate=o),onOnChange:s[4]||(s[4]=o=>a.deadlineDate=o),class:"form-control border-0 focus:ring-0"},null,8,["modelValue"])]),e("div",Te,[l(v,{class:"text-2xl",icon:"ant-design:calendar-outlined"})])])])]),e("div",Le,[Ie,e("div",Oe,[(m(!0),_(S,null,U(a.notiList,(o,h)=>(m(),_("div",{key:h,class:"mb-3"},[e("div",De,[e("div",ze,[l(x,{classInput:"input_color"},{default:M(()=>[l(b,{label:"label",class:"input_color bg-gray-100 rounded w-full",reduce:r=>r.label,options:a.notiType,modelValue:o.noti,"onUpdate:modelValue":r=>o.noti=r},null,8,["reduce","options","modelValue","onUpdate:modelValue"])]),_:2},1024)]),e("div",Ee,[l(y,{classInput:"bg-gray-100 border-gray-200 w-full",placeholder:"",modelValue:o.amount,"onUpdate:modelValue":r=>o.amount=r},null,8,["modelValue","onUpdate:modelValue"])]),e("div",Se,[Ue,e("div",Be,[l(v,{onClick:r=>a.notiList.splice(h,1),class:"text-red-500 text-xl",icon:"icomoon-free:bin"},null,8,["onClick"])])])])]))),128))])]),e("div",Fe,[e("div",je,[l(f,{onClick:s[5]||(s[5]=o=>a.notiList.push({})),icon:"ic:outline-plus",text:"เพิ่มการแจ้งเตือน",btnClass:"btn-primary rounded-md text-white  items-center"})])])])]),_:1},8,["parentClass","activeItem"]),l(g,{parentClass:"space-y-5 mb-6 "+(w.isMobile?"-mx-6":""),title:"ตั้งค่าบันทึกข้อมูลลงไดร์ฟ",activeItem:d.activeTab},{default:M(()=>[e("div",Ne,[l(f,{onClick:s[6]||(s[6]=o=>a.openModal("drive")),icon:"material-symbols:folder",text:"จัดเก็บเข้าแฟ้ม",btnClass:"btn-primary w-40 rounded-md font-medium mx-2"})]),l(O,{ref:"ModalDrive",title:"จัดเก็บเข้าแฟ้ม",isOpen:a.isOpenDrive,driveList:a.driveList,"onEvent:close":a.closeModal,"onEvent:accept":s[7]||(s[7]=o=>a.accept("drive",o))},null,8,["isOpen","driveList","onEvent:close"])]),_:1},8,["parentClass","activeItem"]),e("form",{onSubmit:s[8]||(s[8]=X((...o)=>a.submit&&a.submit(...o),["prevent"])),class:"px-0 sm:px-12"},[e("div",Pe,[l(f,{type:"submit",text:"ส่งหนังสือ",btnClass:"btn-primary w-32 font-medium mx-2"}),l(f,{text:"ยกเลิก",btnClass:"btn-outline-dark w-32 mx-2",link:"/app/issue/order"})])],32)])}const et=$(se,[["render",Re]]);export{et as T};
