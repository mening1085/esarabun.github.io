import{I as O}from"./index-8d30ace7.js";import{B as V}from"./index-c2d6eb9c.js";import{V as T,C as j}from"./VueSelect-403231fd.js";import{C as B}from"./index-cb5a08aa.js";import{I as U}from"./index-2198f2cf.js";import{D as F,S as N}from"./index-976a2577.js";import{S as R}from"./index-ca598517.js";import{M as L}from"./Modal-b54f1b5f.js";import{T as G}from"./index-3e8503e7.js";import{c as q,a as H,_ as A}from"./index-f91482a0.js";import{C as J}from"./index-4d060206.js";import{M as P}from"./index-8e7d66d6.js";import{aF as r,as as l,o as d,p as t,ae as K,m as p,ac as C,aT as m,x as c,bj as u,w as g,F as f,aD as I,n as w}from"./preload-helper-f37a9bec.js";import{C as Q}from"./index-1653d012.js";import{M as W}from"./index-3891a0e1.js";import"./iconify-2baafea4.js";import"./vue-cleave.min-df5c8cc9.js";import"./dom-b10fc197.js";import"./focus-management-94a631f4.js";import"./open-closed-75edfb8a.js";import"./use-resolve-button-type-d7bee841.js";import"./use-outside-click-156e41c1.js";import"./transition-be7c09bc.js";import"./hidden-800255f5.js";import"./micro-task-89dcd6af.js";import"./index-b704274e.js";const X={name:"TableTreeRow",props:{item:Object},emits:["event:delete"],components:{Icon:O,Button:V,VueSelect:T,vSelect:j,Card:B,InputGroup:U,Dropdown:F,Switch:R,Modal:L,MenuItem:N,Textinput:G,ChangeStatus:J,ModalSuccess:P},data(){return{isOpen:!1,is_active:this.item.enabled,enabled:!1,isShowDialogSwitch:!1,isShowDialog:!1,itemDialog:null,passwordError:"",userInfo:q().userInfo,isSuccess:!1}},methods:{toggle(){this.isOpen=!this.isOpen},onUpdateSwitch(o,e){console.log("item",o),console.log("event",e),this.enabled=e,this.itemDialog=o,this.isShowDialogSwitch=!0},async onAcceptSwitch(o){console.log("onAcceptSwitch",o),this.is_active=o.status;const e=await H("organizetionStore","changeStatus",{payload:{id:o.id,status:o.status}});e.status==200?(this.clearModal(),setTimeout(()=>{this.isSuccess=!0},10)):(console.log("error: ",e),this.passwordError=e.data.message)},onCloseSwitch(){this.is_active=!this.enabled,this.clearModal()},showDetail(o){console.log("showDetail",o),this.isShowDialog=!0,this.itemDialog=o},clearModal(){console.log("clearModal"),this.isShowDialogSwitch=!1,this.isShowDialog=!1,this.itemDialog=null,this.passwordError=""},getParentName(){var o,e;return(e=(o=this.itemDialog)==null?void 0:o.parent_organization)==null?void 0:e.organization_name},clearErrorMessage(){this.passwordError="",console.log("clearErrorMessage",this.passwordError)},onDelete(o){this.$emit("event:delete",o)}}},Y={class:"pl-4"},Z={key:1,class:"flex items-center"},$={width:"15%"},ee={width:"5%",class:"text-center"},te={class:"flex items-center justify-center"},se={class:"w-full"},oe=t("h4",{class:"text-lg text-slate-900"},[g(" เปิด/ปิดใช้งานโครงสร้างหน่วยงาน "),t("span",{class:"text-green-500"},"สำเร็จ")],-1),ie={class:"flex flex-wrap items-center bg-gray-100 py-2"},le=t("div",{class:"sm:basis-1/3 basis-full pr-5 flex sm:justify-end justify-start mb-1 sm:mb-0"}," อยู่ภายใต้หน่วยงาน ",-1),ne={class:"sm:basis-1/3 basis-full"},ae={class:"flex flex-wrap items-center py-2"},re=t("div",{class:"sm:basis-1/3 basis-full pr-5 flex sm:justify-end justify-start mb-1 sm:mb-0"}," ชื่อหน่วยงาน ",-1),ce={class:"sm:basis-1/3 basis-full"},de={class:"flex flex-wrap items-center bg-gray-100 py-2"},me=t("div",{class:"sm:basis-1/3 basis-full pr-5 flex sm:justify-end justify-start mb-1 sm:mb-0"}," อักษรย่อหน่วยงาน ",-1),ue={class:"sm:basis-1/3 basis-full"},he={class:"flex flex-wrap items-center py-2"},_e=t("div",{class:"sm:basis-1/3 basis-full pr-5 flex sm:justify-end justify-start mb-1 sm:mb-0"}," รหัสหน่วยงาน ",-1),pe={class:"sm:basis-1/3 basis-full"},ge={class:"flex flex-wrap items-center bg-gray-100 py-2"},fe=t("div",{class:"sm:basis-1/3 basis-full pr-5 flex sm:justify-end justify-start mb-1 sm:mb-0"}," มีหน่วยงานย่อย ",-1),ve={class:"sm:basis-1/3 basis-full"},xe={class:"flex flex-wrap items-center py-2"},be=t("div",{class:"sm:basis-1/3 basis-full pr-5 flex sm:justify-end justify-start mb-1 sm:mb-0"}," ลำดับที่แสดงผลหน่วยงาน (ตัวเลข) ",-1),we={class:"sm:basis-1/3 basis-full"},ye={class:"text-center mt-4 flex justify-center w-full"};function Se(o,e,n,_,s,a){var b;const h=r("Icon"),v=r("Switch"),x=r("router-link"),y=r("Dropdown"),S=r("TableTreeRow"),D=r("ChangeStatus"),M=r("ModalSuccess"),E=r("Button"),z=r("Modal");return l(),d(f,null,[t("tr",null,[t("td",{style:K({paddingLeft:(n.item.level+1)*25+"px"}),width:"80%"},[n.item.children.length>0?(l(),d("div",{key:0,class:"flex items-center",onClick:e[0]||(e[0]=i=>a.toggle())},[t("div",null,[s.isOpen?(l(),p(h,{key:1,icon:"teenyicons:down-solid",class:C(["text-xs",{"rotate-90":s.isOpen}])},null,8,["class"])):(l(),p(h,{key:0,icon:"teenyicons:right-solid",class:C(["text-xs",{"rotate-90":s.isOpen}])},null,8,["class"]))]),t("span",Y,m(n.item.organization_name),1)])):(l(),d("div",Z,[c(h,{icon:"bi:dot",class:"text-gray-400 text-4xl -ml-2"}),t("span",null,m(n.item.organization_name),1)]))],4),t("td",$,[s.is_active?(l(),p(v,{key:0,label:"เปิดใช้งาน",activeClass:"bg-primary-500",active:!0,modelValue:s.is_active,"onUpdate:modelValue":e[1]||(e[1]=i=>s.is_active=i),onChange:e[2]||(e[2]=i=>a.onUpdateSwitch(n.item,!1))},null,8,["modelValue"])):(l(),p(v,{key:1,label:"ปิดใช้งาน",activeClass:"bg-primary-500",active:!1,modelValue:s.is_active,"onUpdate:modelValue":e[3]||(e[3]=i=>s.is_active=i),onChange:e[4]||(e[4]=i=>a.onUpdateSwitch(n.item,!0))},null,8,["modelValue"]))]),t("td",ee,[t("div",te,[c(y,{classMenuItems:"right-full  w-[220px] top-[110%] "},{menus:u(()=>[t("ul",se,[t("li",null,[c(x,{class:"p-2 flex items-center hover:bg-gray-50",to:`organize-structure/edit/${n.item.id}`},{default:u(()=>[c(h,{icon:"bx:edit",class:"text-xl mr-2"}),g(" แก้ไข ")]),_:1},8,["to"])]),t("li",null,[t("div",{class:"p-2 flex items-center hover:bg-gray-50 cursor-pointer",onClick:e[5]||(e[5]=i=>a.showDetail(n.item))},[c(h,{icon:"grommet-icons:document-text",class:"text-xl mr-2"}),g(" ดูรายละเอียด ")])]),t("li",null,[t("div",{class:"p-2 flex items-center hover:bg-gray-50 cursor-pointer border-t text-red-500",onClick:e[6]||(e[6]=i=>a.onDelete(n.item))},[c(h,{icon:"material-symbols:delete",class:"text-xl mr-2"}),g(" ลบ ")])])])]),default:u(()=>[c(h,{icon:"pepicons-pencil:dots-x",class:"text-gray-400 text-4xl"})]),_:1})])])]),(l(!0),d(f,null,I(n.item.children,(i,k)=>(l(),d(f,{key:k},[s.isOpen?(l(),p(S,{key:0,item:i,"onEvent:delete":a.onDelete},null,8,["item","onEvent:delete"])):w("",!0)],64))),128)),c(D,{title:"ยืนยันการเปิด/ปิดใช้งานโครงสร้างหน่วยงาน",isOpen:s.isShowDialogSwitch,modalId:(b=s.itemDialog)==null?void 0:b.id,status:s.enabled,errorMessage:s.passwordError,"onEvent:clearErrorMessage":a.clearErrorMessage,"onEvent:close":a.onCloseSwitch,"onEvent:success":a.onAcceptSwitch},null,8,["isOpen","modalId","status","errorMessage","onEvent:clearErrorMessage","onEvent:close","onEvent:success"]),s.isSuccess?(l(),p(M,{key:0,title:"เปิด/ปิดใช้งานโครงสร้างหน่วยงาน",isOpen:s.isSuccess,"onEvent:closeModal":e[7]||(e[7]=i=>s.isSuccess=!1)},{default:u(()=>[oe]),_:1},8,["isOpen"])):w("",!0),s.isShowDialog?(l(),p(z,{key:1,title:"รายละเอียดหน่วยงาน",label:"",labelClass:"btn-outline-dark",sizeClass:"max-w-[900px]",ref:"modalDialog",centered:"",activeModal:s.isShowDialog,"onEvent:closeModal":e[9]||(e[9]=i=>a.clearModal())},{footer:u(()=>[t("div",ye,[c(x,{class:"btn btn-primary w-32 font-medium mx-2",to:`/app/user-role/organize-structure/edit/${n.item.id}`},{default:u(()=>[g(" แก้ไขหน่วยงาน ")]),_:1},8,["to"]),c(E,{text:"ยกเลิก",btnClass:"btn-outline-dark w-32 mx-2",onOnClick:e[8]||(e[8]=i=>a.clearModal())})])]),default:u(()=>[t("div",ie,[le,t("div",ne,m(a.getParentName()),1)]),t("div",ae,[re,t("div",ce,m(s.itemDialog.organization_name),1)]),t("div",de,[me,t("div",ue,m(s.itemDialog.abbreviation),1)]),t("div",he,[_e,t("div",pe,m(s.itemDialog.organization_code),1)]),t("div",ge,[fe,t("div",ve,m(s.itemDialog.have_sub_organization?"ได้":"ไม่ได้"),1)]),t("div",xe,[be,t("div",we,m(s.itemDialog.display_order),1)])]),_:1},8,["activeModal"])):w("",!0)],64)}const De=A(X,[["render",Se]]);const Me={components:{Icon:O,Button:V,VueSelect:T,Card:B,vSelect:j,InputGroup:U,Dropdown:F,Switch:R,Modal:L,MenuItem:N,Textinput:G,TableTreeRow:De,ConfirmDelete:Q,ModalSuccess:P,ModalError:W},data(){return{isShowModalDelete:!1,isModalDeleteSuccess:!1,isModalDeleteError:!1,errorMessage:"",modalId:"",organizeList:[],organization_id:"",keyword:"",expandIds:[],header:[{name:"หน่วยงาน",class:"text-left",width:"80%",key:"name"},{name:"สถานะใช้งาน",class:"text-left",width:"15%",key:"status"},{name:"จัดการ",class:"text-center",width:"5%",key:"action"}],organizetions:[],defaultOrganizetions:[],fullPage:!0,formContainer:null}},watch:{organization_id:{handler(){this.organization_id||this.getData()}}},created(){this.getData()},methods:{async getData(){console.log("getData",this.filter);let{data:o,status:e}=await this.$apiFire("organizetionStore","get",{payload:{organization_id:this.organization_id,keyword:this.keyword}});this.organizetions=[],e===200&&(this.organizetions=o.result.organizations,this.defaultOrganizetions=o.result.organizations,this.organizeList=o.result.organization_list.map(n=>({id:n.id,title:n.organization_name})))},toggle(o){this.expandIds.includes(o)?this.expandIds=this.expandIds.filter(e=>e!==o):this.expandIds.push(o)},filterTree(o,e){let n=[];return o.forEach(_=>{if(_.organization_name.includes(e)&&n.push(_),_.children.length>0){let s=this.filterTree(_.children,e);s.length>0&&(_.children=s,n.push(_))}}),n},showModalDelete(o){this.isShowModalDelete=!0,this.modalId=o.id},async onDelete(o){let e=await this.$apiFire("organizetionStore","delete",{payload:o});console.log("onDelete",e),this.isShowModalDelete=!1,e.status===200?(this.isModalDeleteSuccess=!0,this.filter={organize:"",search:""},this.getData()):(this.isModalDeleteError=!0,this.errorMessage=e.data.message)},clearModal(){this.isShowModalDelete=!1,this.isModalDeleteSuccess=!1,this.isModalDeleteError=!1,this.errorMessage="",this.modalId=""}}},Ee={class:"table_tree"},ze={class:"border-2 pb-4 bg-white"},ke={class:"flex gap-5 pt-4 px-4 pb-8"},Ce={class:"basis-1/2"},Ie={class:"basis-1/2 flex gap-3"},Oe={class:"basis-1/2"},Ve={class:"basis-1/2"},Te={class:"w-full"},je=["width"],Be={key:0},Ue={colspan:"3"},Fe={class:"flex items-center p-2"},Ne={class:"font-medium"},Re={key:0},Le=t("td",{colspan:"3",class:"text-center"},"ไม่พบข้อมูล",-1),Ge=[Le],Ae={key:1},Pe=t("tr",null,[t("td",{colspan:"3",class:"text-center"},"ไม่พบข้อมูล")],-1),qe=[Pe],He=t("h4",{class:"text-lg text-slate-900"},[g(" ลบข้อมูลหน่วยงาน "),t("span",{class:"text-green-500"},"สำเร็จ")],-1),Je={class:"text-lg text-slate-900"};function Ke(o,e,n,_,s,a){const h=r("Button"),v=r("router-link"),x=r("vSelect"),y=r("VueSelect"),S=r("InputGroup"),D=r("Icon"),M=r("TableTreeRow"),E=r("ConfirmDelete"),z=r("ModalSuccess"),b=r("ModalError");return l(),d("div",Ee,[t("div",ze,[t("div",ke,[t("div",Ce,[c(v,{to:"organize-structure/create"},{default:u(()=>[c(h,{icon:"ic:baseline-plus",text:"เพิ่มหน่วยงาน",btnClass:"btn-primary "})]),_:1})]),t("div",Ie,[t("div",Oe,[c(y,null,{default:u(()=>[c(x,{placeholder:"เลือกหน่วยงาน",modelValue:s.organization_id,"onUpdate:modelValue":e[0]||(e[0]=i=>s.organization_id=i),label:"title",class:"border rounded",reduce:i=>i.id,options:s.organizeList,"onOption:selected":e[1]||(e[1]=i=>a.getData())},null,8,["modelValue","reduce","options"])]),_:1})]),t("div",Ve,[c(S,{modelValue:s.keyword,"onUpdate:modelValue":e[2]||(e[2]=i=>s.keyword=i),placeholder:"Search",classInputGroup:"border-gray-200",type:"text",prependIcon:"heroicons-outline:search",merged:"",inputEnter:"","onEvent:inputEnter":e[3]||(e[3]=i=>a.getData())},null,8,["modelValue"])])])]),t("table",Te,[t("thead",null,[t("tr",null,[(l(!0),d(f,null,I(s.header,i=>(l(),d("th",{key:i.key,class:C(["px-6 py-3 font-medium",i.class]),width:i.width},m(i.name),11,je))),128))])]),s.organizetions.length>0?(l(),d("tbody",Be,[t("tr",null,[t("td",Ue,[t("div",Fe,[c(D,{icon:"clarity:tree-view-solid",class:"text-2xl mr-2"}),t("div",Ne,m(s.organizetions[0].organization_name),1)])])]),(l(!0),d(f,null,I(s.organizetions[0].children,(i,k)=>(l(),p(M,{key:k,item:i,"onEvent:delete":a.showModalDelete},null,8,["item","onEvent:delete"]))),128)),s.organizetions[0].children.length==0?(l(),d("tr",Re,Ge)):w("",!0)])):(l(),d("tbody",Ae,qe))])]),c(E,{title:"ยืนยันการลบข้อมูล",isOpen:s.isShowModalDelete,modalId:s.modalId,errorMessage:s.errorMessage,"onEvent:delete":a.onDelete,"onEvent:close":a.clearModal,"onEvent:success":a.clearModal},null,8,["isOpen","modalId","errorMessage","onEvent:delete","onEvent:close","onEvent:success"]),c(z,{title:"ยืนยันการลบข้อมูล",isOpen:s.isModalDeleteSuccess,"onEvent:closeModal":e[4]||(e[4]=i=>s.isModalDeleteSuccess=!1)},{default:u(()=>[He]),_:1},8,["isOpen"]),c(b,{title:"ลบข้อมูล",isOpen:s.isModalDeleteError,"onEvent:closeModal":e[5]||(e[5]=i=>s.isModalDeleteError=!1)},{default:u(()=>[t("h4",Je,m(s.errorMessage),1)]),_:1},8,["isOpen"])])}const bt=A(Me,[["render",Ke]]);export{bt as default};
