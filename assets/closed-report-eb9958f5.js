import{C as L}from"./index-263882d1.js";import{I as U}from"./index-72ee420c.js";import{B as Y}from"./index-441935dc.js";import{V as G,C as J}from"./VueSelect-4c8519b3.js";import{D as q}from"./index-090a8953.js";import{I as H}from"./index-a60d9262.js";import{P as K}from"./index-bb139ada.js";import{_ as Q,a as k,b as X,t as T}from"./index-e058a960.js";import{A as Z}from"./AdvancedSearch-891403e6.js";import{a as O,b as V}from"./global-funcs-ef1510cf.js";import{d as $}from"./dayjs.min-72c81edc.js";import{E as I}from"./exceljs.min-46343030.js";import{A as ee}from"./AdvancedSearchStatus-9cb2c24d.js";import{o as u,x as m,bj as v,aF as f,as as _,p as c,aT as p,w as S}from"./preload-helper-9e0646ca.js";import"./iconify-4e42c13d.js";import"./dom-891ac6c3.js";import"./focus-management-e6c5d1fd.js";import"./open-closed-486d85f0.js";import"./use-resolve-button-type-38f1f99a.js";import"./use-outside-click-a758fdce.js";import"./vue-cleave.min-9e1201c2.js";import"./index-7e9b1d19.js";import"./index-8994827d.js";import"./ck-white-7280cd79.js";import"./index-31d1a8ca.js";import"./select-option-b2a02578.js";import"./index-2d8ae848.js";import"./index-e3f12ad9.js";import"./index-6c8c0d73.js";const te={computed:{},components:{AdvancdSearchStatus:ee,Pagination:K,InputGroup:H,VueSelect:G,Dropdown:q,vSelect:J,Button:Y,Card:L,Icon:U,AdvancedSearch:Z},data(){return{isShowModalAS:!1,exportLists:[{id:1,label:"Microsoft Word",icon:"ant-design:file-word-filled"},{id:2,label:"Microsoft Excel",icon:"ant-design:file-excel-filled"},{id:3,label:"PDF",icon:"ant-design:file-pdf-filled"}],filter:{keyword:""},activityList:[],columns:[{label:"เลขรับ/ส่ง",field:"id",width:"60px",tdClass:"text_left",thClass:"text_left"},{label:"เลขที่หนังสือ/เรื่อง",field:"document_number",width:"200px",tdClass:"text_left",thClass:"text_left"},{label:"จาก",field:"from_id",width:"150px",tdClass:"text_left",thClass:"text_left"},{label:"ถึง",field:"to_id",width:"150px",tdClass:"text_left",thClass:"text_left"},{label:"สถานะ",field:"status",width:"60px",tdClass:"text_left",thClass:"text_left"},{label:"วันเวลาปิดเรื่อง",field:"closed",width:"100px",tdClass:"text_left",thClass:"text_left"}],paginate:{total:0,current_page:1,perpage:10,pageRange:5},advancedTable:[],userList:[],common:[]}},watch:{},async created(){await this.getData(1)},methods:{async onDelete(e){},async onFilter(e){e.document_type=e.document_type?JSON.parse(e.document_type):[],e.book_type=e.book_type?JSON.parse(e.book_type):[],this.getData(1,e)},displayInitialNumber(e){let o="";return e&&(e.doc_pickup_type==="หนังสือรับ"?(o+=this.convertThaiNo(e.initial_number_from??"-"),o+=" / "+(e.parent_document?this.convertThaiNo(e.parent_document.initial_number_from):"-")):o+="- / "+this.convertThaiNo(e.initial_number_from)),o},async getData(e,o=[]){var a,d,s,r,h,g,b,w,x,i,y,C;let l={page:e??1,...this.filter,filter:o};const n=await k("reportFixStore","closedReport",{payload:l}),t=await k("reportDashboardStore","getCommonData");(d=(a=n.data)==null?void 0:a.result)!=null&&d.data&&(this.advancedTable=O(t.data.result.user_list,t.data.result.inside_organization,t.data.result.outside_organization,(r=(s=n.data)==null?void 0:s.result)==null?void 0:r.data),this.common={user_list:t.data.result.user_list,inside_organization:t.data.result.inside_organization,outside_organization:t.data.result.outside_organization},V(t.data.result.user_list,this.advancedTable,"deleted_by"),this.paginate.total=((g=(h=n==null?void 0:n.data)==null?void 0:h.result)==null?void 0:g.total_page)*((w=(b=n==null?void 0:n.data)==null?void 0:b.result)==null?void 0:w.per_page),this.paginate.current_page=(i=(x=n==null?void 0:n.data)==null?void 0:x.result)==null?void 0:i.current_page,this.paginate.perpage=(C=(y=n==null?void 0:n.data)==null?void 0:y.result)==null?void 0:C.per_page)},async handleExport(e){var d,s;let o={page:1,filter:this.filter,pageSize:this.paginate.total};const l=await k("reportFixStore","closedReport",{payload:o}),n=O(this.common.user_list,this.common.inside_organization,this.common.outside_organization,(s=(d=l.data)==null?void 0:d.result)==null?void 0:s.data),t=n.map(r=>{var h,g,b,w,x;return{id:this.convertThaiNo(r==null?void 0:r.initial_number_from)+"/"+this.convertThaiNo((h=r==null?void 0:r.parent_document)==null?void 0:h.initial_number_from),document_number:this.convertThaiNo(r.document_number)+" / "+r.subject,from_id:((g=r.from_user)==null?void 0:g.organization_name)??((b=r.from_user)==null?void 0:b.name)??"-",to_id:((w=r.to_user)==null?void 0:w.full_name)??"-",status:r.status,signed:this.convertThaiNo(this.convertDate(r==null?void 0:r.deleted_at))+" /ปิดเรื่องโดย "+(((x=r.user)==null?void 0:x.full_name)??"")}});let a=["เลขรับ/ส่ง","เลขที่หนังสือ/เรื่อง","จาก","ถึง","สถานะ","วันเวลาปิดเรื่อง"];V(this.common.user_list,n,"deleted_by"),e.id==1?this.exportToWord(t,null,a):e.id==2?this.exportToExcel(t,null,a):e.id==3&&this.exportToPdf(t,null,a)},async saveToArchive(e){return await window.ApexCharts.getChartByID(e).dataURI()},async sendToServer(e,o,l){try{const n=new FormData;n.append("excelFile",e,"downloaded-file.xlsx"),o&&n.append("base64Image",o);const t=await X.post(T+"/fix/convert-to-"+l,n);l==="pdf"?window.open(`${T}/public/tempFile/${t.data.result.data.fileName}.${l}`,"_blank"):window.open(`${T}/public/tempFile/${t.data.result.data.fileName}.${l}`,"_parent","download")}catch(n){console.error("Error sending file to server:",n)}},async exportToExcel(e,o,l){const n=new I.Workbook,t=n.addWorksheet("Sheet1");if(o){const a=n.addImage({base64:o,extension:"png"});t.addImage(a,{tl:{col:0,row:0},ext:{width:1600,height:380}})}t.getRow(o?20:1).values=l;for(const a of e)t.addRow([a.id,a.document_number,a.from_id,a.to_id,a.status,a.signed]);this.adjustColumnWidth(t),this.setTextCenter(t),n.xlsx.writeBuffer().then(a=>{const d=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),s="exported_data.xlsx",r=document.createElement("a");r.href=URL.createObjectURL(d),r.download=s,document.body.appendChild(r),r.click(),document.body.removeChild(r)})},async exportToWord(e,o,l){const n=new I.Workbook,t=n.addWorksheet("Sheet1");if(o){const s=n.addImage({base64:o,extension:"png"});t.addImage(s,{tl:{col:0,row:0},ext:{width:1600,height:380}})}t.getRow(o?20:1).values=l;for(const s of e)t.addRow([s.id,s.document_number,s.from_id,s.to_id,s.status,s.signed]);this.adjustColumnWidth(t),this.setTextCenter(t,!0);const a=await n.xlsx.writeBuffer(),d=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});await this.sendToServer(d,o,"docx")},async exportToPdf(e,o,l){const n=new I.Workbook,t=n.addWorksheet("Sheet1");if(t.pageSetup={orientation:"landscape"},o){const s=n.addImage({base64:o,extension:"png"});t.addImage(s,{tl:{col:0,row:0},ext:{width:600,height:300}})}t.getRow(o?18:1).values=l;for(const s of e)t.addRow([s.id,s.document_number,s.from_id,s.to_id,s.status,s.signed]);this.adjustColumnWidth(t),this.setTextCenter(t,!0);const a=await n.xlsx.writeBuffer(),d=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});await this.sendToServer(d,null,"pdf")},adjustColumnWidth(e){e.columns.forEach(o=>{const l=o.values.map(t=>t.toString().length),n=Math.max(...l.filter(t=>typeof t=="number"));o.width=n*.7})},setTextCenter(e,o=!1){const t=e.lastRow.number;for(let a=0;a<=t;a++){const d=e.getRow(a);d.height=30,d.eachCell({includeEmpty:!0},s=>{o&&(s.font={size:10}),s.alignment={wrapText:!0},s.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}})}},convertDate(e,o="DD/MM/YYYY"){return e==null?"-":$(e).locale("th").add(543,"year").format(o)},convertThaiNo(e){return e?(e=e.replace(/1/g,"๑"),e=e.replace(/2/g,"๒"),e=e.replace(/3/g,"๓"),e=e.replace(/4/g,"๔"),e=e.replace(/5/g,"๕"),e=e.replace(/6/g,"๖"),e=e.replace(/7/g,"๗"),e=e.replace(/8/g,"๘"),e=e.replace(/9/g,"๙"),e=e.replace(/0/g,"๐"),e):""}}},oe={class:"report-management"},ne={class:"p-6"},ae={class:"md:flex justify-between pb-6 md:space-y-0 space-y-3 items-center"},se={class:"flex flex-wrap sm:flex-nowrap gap-3 basis-full"},ie={class:"flex basis-2/5"},re={class:"flex gap-3"},le={class:"flex items-center"},de=c("span",{class:"px-2"},"Export",-1),ce={class:"flex gap-5 basis-3/5 justify-end"},me=c("div",{class:"text-center"},[c("div",{class:"text-gray-400"},"ไม่พบข้อมูล")],-1),pe={key:0},ue={key:1},fe=c("br",null,null,-1),_e={key:2,class:"text-red-500"},he={key:3},ge=c("br",null,null,-1),be={key:4},we={key:5},xe={key:6},ye={class:"py-4 px-3"};function ve(e,o,l,n,t,a){const d=f("Icon"),s=f("Button"),r=f("Dropdown"),h=f("InputGroup"),g=f("AdvancdSearchStatus"),b=f("Pagination"),w=f("vue-good-table"),x=f("Card");return _(),u("div",oe,[m(x,{noborder:"",bodyClass:"p-0"},{default:v(()=>[c("div",ne,[c("div",ae,[c("div",se,[c("div",ie,[c("div",re,[m(r,{classMenuItems:"left-0  w-[220px] top-[110%]",items:t.exportLists,onOnClickItem:a.handleExport},{default:v(()=>[m(s,{btnClass:"btn-primary text-slate-50",div:"",iconClass:"text-lg"},{default:v(()=>[c("div",le,[m(d,{icon:"ic:baseline-cloud-download",class:"handle text-[20px]"}),de])]),_:1})]),_:1},8,["items","onOnClickItem"])])]),c("div",ce,[m(h,{modelValue:t.filter.keyword,"onUpdate:modelValue":o[0]||(o[0]=i=>t.filter.keyword=i),placeholder:"Search",type:"text",prependIcon:"heroicons-outline:search",merged:"",inputEnter:!0,"onEvent:inputEnter":o[1]||(o[1]=i=>a.getData(1))},null,8,["modelValue"]),m(s,{icon:"mdi:filter",text:"ค้นหาขั้นสูง",btnClass:"btn-primary rounded-md",onClick:o[2]||(o[2]=i=>t.isShowModalAS=!t.isShowModalAS)})])])])]),m(g,{isOpen:t.isShowModalAS,"dis-status":!0,"onEvent:close":o[3]||(o[3]=i=>t.isShowModalAS=!1),"onEvent:submit":a.onFilter},null,8,["isOpen","onEvent:submit"]),m(w,{columns:t.columns,styleClass:" vgt-table bordered lesspadding2",rows:t.advancedTable,"pagination-options":{enabled:!0,perPage:t.paginate.perpage},"sort-options":{enabled:!1}},{emptystate:v(()=>[me]),"table-row":v(i=>{var y,C,N,D,R,E,A,B,z,W,P,j,F,M;return[i.column.field=="id"?(_(),u("span",pe,p(a.displayInitialNumber(i.row)),1)):i.column.field=="document_number"?(_(),u("span",ue,[S(p((y=i.row)!=null&&y.document_number?a.convertThaiNo((C=i.row)==null?void 0:C.document_number):"-")+" ",1),fe,S(" "+p(((N=i.row)==null?void 0:N.subject)??"-"),1)])):i.column.field=="status"?(_(),u("span",_e,p((D=i.row)==null?void 0:D.status),1)):i.column.field=="closed"?(_(),u("span",he,[S(p((R=i.row)!=null&&R.deleted_at?a.convertThaiNo(a.convertDate((E=i.row)==null?void 0:E.deleted_at)):"-")+" ",1),ge,S(" ปิดเรื่องโดย: "+p(((B=(A=i.row)==null?void 0:A.user)==null?void 0:B.full_name)??"-"),1)])):i.column.field=="from_id"?(_(),u("span",be,p(((W=(z=i.row)==null?void 0:z.from_user)==null?void 0:W.organization_name)??((j=(P=i.row)==null?void 0:P.from_user)==null?void 0:j.name)??"-"),1)):i.column.field=="to_id"?(_(),u("span",we,p(((M=(F=i.row)==null?void 0:F.to_user)==null?void 0:M.full_name)??"-"),1)):(_(),u("span",xe,p(i.row[i.column.field]),1))]}),"pagination-bottom":v(i=>[c("div",ye,[m(b,{total:t.paginate.total,current:t.paginate.current_page,"per-page":t.paginate.perpage,pageRange:t.paginate.pageRange,onPageChanged:o[4]||(o[4]=y=>a.getData(y)),pageChanged:i.pageChanged,perPageChanged:i.perPageChanged,textAfterInput:"ไปที่หน้า",enableSearch:"",enableInput:""},null,8,["total","current","per-page","pageRange","pageChanged","perPageChanged"])])]),_:1},8,["columns","rows","pagination-options"])]),_:1})])}const Ze=Q(te,[["render",ve]]);export{Ze as default};
