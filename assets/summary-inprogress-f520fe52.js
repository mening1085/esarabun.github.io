import{C}from"./index-263882d1.js";import{I as L}from"./index-72ee420c.js";import{B}from"./index-441935dc.js";import{V as D,C as W}from"./VueSelect-4c8519b3.js";import{M}from"./Modal-19eb68c4.js";import{M as F}from"./index-7dc8252b.js";import{R as V}from"./index-3069c0b6.js";import{D as U}from"./index-e3f12ad9.js";import{D as E}from"./index-090a8953.js";import{M as X}from"./index-ffc068ae.js";import{_ as A,a as k,b as j,t as y}from"./index-e058a960.js";import{c as N}from"./appex-chart-e4d84b07.js";import O from"./colors-b45e2c1c.js";import{I as G}from"./index-a60d9262.js";import{T as Y}from"./index-31d1a8ca.js";import{C as H}from"./index-8994827d.js";import{E as b}from"./exceljs.min-46343030.js";import{r as v,w as T}from"./xlsx-92a51129.js";import{o as x,x as m,bj as u,aF as f,as as w,p,F as z,aD as P,m as J,aT as I}from"./preload-helper-9e0646ca.js";import"./iconify-4e42c13d.js";import"./transition-39b574f4.js";import"./dom-891ac6c3.js";import"./hidden-11a9ab9d.js";import"./focus-management-e6c5d1fd.js";import"./micro-task-89dcd6af.js";import"./open-closed-486d85f0.js";import"./use-outside-click-a758fdce.js";import"./index-1b218db3.js";import"./index-6c8c0d73.js";import"./use-resolve-button-type-38f1f99a.js";import"./vue-cleave.min-9e1201c2.js";import"./ck-white-7280cd79.js";const q={computed:{columnChart(){return N}},components:{Checkbox:H,Textinput:Y,InputGroup:G,ModalGraph:X,Dropdown:E,DatePickerRange:U,Radio:V,Icon:L,Button:B,Card:C,VueSelect:D,vSelect:W,Modal:M,ModalSuccess:F},data(){return{exportLists:[{id:1,label:"Microsoft Word",icon:"ant-design:file-word-filled"},{id:2,label:"Microsoft Excel",icon:"ant-design:file-excel-filled"},{id:3,label:"PDF",icon:"ant-design:file-pdf-filled"},{id:4,label:"RTF",icon:"grommet-icons:document-rtf"},{id:5,label:"HTML",icon:"bxs:file-html"}],filter:{bookType:1,month:new Date().getMonth()+1,year:"",agency:null},bookTypeList:[{id:1,title:"ทั้งหมด"},{id:2,title:"หนังสือภายนอก"},{id:3,title:"หนังสือภายใน"}],MonthList:[{id:0,title:"ทั้งหมด"},{id:1,title:"เดือน มกราคม"},{id:2,title:"เดือน กุมภาพันธ์"},{id:3,title:"เดือน มีนาคม"},{id:4,title:"เดือน เมษายน"},{id:5,title:"เดือน พฤษภาคม"},{id:6,title:"เดือน มิถุนายน"},{id:7,title:"เดือน กรกฎาคม"},{id:8,title:"เดือน สิงหาคม"},{id:9,title:"เดือน กันยายน"},{id:10,title:"เดือน ตุลาคม"},{id:11,title:"เดือน พฤศจิกายน"},{id:12,title:"เดือน ธันวาคม"}],yearItems:[],agencyItem:[],item:{},dataTable:[],dataGraph:[],viewColumnName:[],columns:[{label:"เดือน",field:"name",width:"20%",tdClass:"text_left",thClass:"text_left"},{label:"จำนวนหนังสือรับ",field:"book_rev",width:"20%",tdClass:"text_left",thClass:"text_left"},{label:"จำนวนหนังสือส่ง",field:"book_send",width:"20%",tdClass:"text_left",thClass:"text_left"}]}},watch:{},async created(){await this.getData(),this.filter.year=new Date().getFullYear()},methods:{async getData(){var a,s,e,r,c,n,i;const o=await k("reportFixStore","summaryInprogress",{payload:this.filter}),t=await k("reportDashboardStore","getCommonData");this.generateYearItems(),this.dataGraph=[],(a=t==null?void 0:t.data.result)!=null&&a.dropdown&&(this.agencyItem=(s=t==null?void 0:t.data.result)==null?void 0:s.dropdown),(e=o.data)!=null&&e.result&&(this.dataTable=(c=(r=o.data)==null?void 0:r.result)==null?void 0:c.dataTable,this.dataGraph.push(this.generateGraph((i=(n=o.data)==null?void 0:n.result)==null?void 0:i.dataGraph,null)))},generateYearItems(){const o=new Date().getFullYear(),t=[];for(let a=0;a<10;a++){const s={title:o-a+543,value:o-a};t.push(s)}this.yearItems=t},generateGraph(o,t){const a=o.id,s=o.name,e=o.chartType;let r;r=o.data;const c={chart:{id:"custom_chart_0",type:o.chartType,toolbar:{show:!1}},dataLabels:{enabled:o.showLabel},stroke:{curve:"straight"},markers:{size:o.markers?4:0,colors:"#fff",strokeColors:O.primary,strokeWidth:2,shape:"circle",radius:2,hover:{sizeOffset:1}},labels:o.dataLabel,legend:{itemMargin:{vertical:5},width:200,offsetX:10,offsetY:60,formatter:function(n,i){let d=parseFloat(i.w.globals.series[i.seriesIndex]/i.w.globals.series.reduce((h,_)=>h+_,0)*100).toFixed(2)+"%";return n+" "+d}},yaxis:[{min:0,tickAmount:10}],xaxis:{labels:{rotate:300}},plotOptions:{pie:{donut:{labels:{show:!0,name:{show:!1},value:{show:!0,fontSize:"40px",offsetY:15,formatter:function(n){return n}},total:{show:!0,label:"",color:"#373d3f",formatter:function(n){return n.globals.series.reduce((i,d)=>i+d,0)}}}}}},noData:{text:"No data",align:"center",verticalAlign:"middle",offsetX:0,offsetY:0,style:{fontSize:"40px"}}};return{id:a,name:s,series:r,options:c,chartType:e}},async handleExport(o){const t=this.dataTable.map(e=>({name:e.name,book_rev:e.book_rev,book_send:e.book_send})),a=await this.saveToArchive("custom_chart_0");let s=["เดือน","จำนวนหนังสือรับ","จำนวนหนังสือส่ง"];o.id==1?this.exportToWord(t,a.imgURI,s):o.id==2?this.exportToExcel(t,a.imgURI,s):o.id==3?this.exportToPdf(t,a.imgURI,s):o.id==4?this.exportToRtf(t,"",s):o.id==5&&this.exportToHtml(t,"",s)},async saveToArchive(o){return await window.ApexCharts.getChartByID(o).dataURI()},async sendToServer(o,t,a){try{const s=new FormData;s.append("excelFile",o,"downloaded-file.xlsx"),t&&s.append("base64Image",t);const e=await j.post(y+"/fix/convert-to-"+a,s);a==="pdf"?window.open(`${y}/public/tempFile/${e.data.result.data.fileName}.${a}`,"_blank"):window.open(`${y}/public/tempFile/${e.data.result.data.fileName}.${a}`,"_parent","download")}catch(s){console.error("Error sending file to server:",s)}},async exportToExcel(o,t,a){const s=new b.Workbook,e=s.addWorksheet("Sheet1");if(t){const r=s.addImage({base64:t,extension:"png"});e.addImage(r,{tl:{col:0,row:0},ext:{width:1600,height:380}})}e.getRow(t?12:1).values=a;for(const r of o)e.addRow([r.name,r.book_rev,r.book_send]);this.adjustColumnWidth(e),this.setTextCenter(e),s.xlsx.writeBuffer().then(r=>{const c=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),n="exported_data.xlsx",i=document.createElement("a");i.href=URL.createObjectURL(c),i.download=n,document.body.appendChild(i),i.click(),document.body.removeChild(i)})},async exportToWord(o,t,a){const s=new b.Workbook,e=s.addWorksheet("Sheet1");if(t){const n=s.addImage({base64:t,extension:"png"});e.addImage(n,{tl:{col:0,row:0},ext:{width:1600,height:380}})}e.getRow(t?12:1).values=a;for(const n of o)e.addRow([n.name,n.book_rev,n.book_send]);this.adjustColumnWidth(e),this.setTextCenter(e);const r=await s.xlsx.writeBuffer(),c=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});await this.sendToServer(c,t,"docx")},async exportToPdf(o,t,a){const s=new b.Workbook,e=s.addWorksheet("Sheet1");if(e.pageSetup={orientation:"landscape"},t){const n=s.addImage({base64:t,extension:"png"});e.addImage(n,{tl:{col:0,row:0},ext:{width:600,height:300}})}e.getRow(t?12:1).values=a;for(const n of o)e.addRow([n.name,n.book_rev,n.book_send]);this.adjustColumnWidth(e),this.setTextCenter(e,!0);const r=await s.xlsx.writeBuffer(),c=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});await this.sendToServer(c,null,"pdf")},async convertXLSXToRTF(o){const t=new ArrayBuffer(o.length);new Uint8Array(t).set(o);const s=v(t);return T(s,{sheet:0,bookType:"rtf",type:"buffer"})},async convertXLSXToHTML(o){console.log("convertXLSXToHTML");const t=new ArrayBuffer(o.length);new Uint8Array(t).set(o);const s=v(t),e={sheet:0,bookType:"html",type:"buffer"};return console.log("convertXLSXToHTML end"),T(s,e)},async exportToRtf(o,t,a){const s=new b.Workbook,e=s.addWorksheet("Sheet1");if(e.pageSetup={orientation:"landscape"},t){const d=s.addImage({base64:t,extension:"png"});e.addImage(d,{tl:{col:0,row:0},ext:{width:600,height:300}})}e.getRow(t?12:1).values=a;for(const d of o)e.addRow([d.name,d.book_rev,d.book_send]);this.adjustColumnWidth(e),this.setTextCenter(e,!0);const r=await s.xlsx.writeBuffer();let c=await this.convertXLSXToRTF(r);const n=new Blob([c],{type:"application/rtf"}),i=document.createElement("a");i.href=window.URL.createObjectURL(n),i.download="rtf_report.rtf",i.click()},async exportToHtml(o,t,a){const s=new b.Workbook,e=s.addWorksheet("Sheet1");if(e.pageSetup={orientation:"landscape"},t){const d=s.addImage({base64:t,extension:"png"});e.addImage(d,{tl:{col:0,row:0},ext:{width:600,height:300}})}e.getRow(t?12:1).values=a;for(const d of o)e.addRow([d.name,d.book_rev,d.book_send]);this.adjustColumnWidth(e),this.setTextCenter(e,!0);const r=await s.xlsx.writeBuffer();let c=await this.convertXLSXToHTML(r);const n=new Blob([c],{type:"application/html"}),i=document.createElement("a");i.href=window.URL.createObjectURL(n),i.download="html_report.html",i.click()},adjustColumnWidth(o){o.columns.forEach(t=>{const a=t.values.map(e=>e.toString().length),s=Math.max(...a.filter(e=>typeof e=="number"));t.width=s*.7})},setTextCenter(o,t=!1){const e=o.lastRow.number;for(let r=0;r<=e;r++){const c=o.getRow(r);c.height=30,c.eachCell({includeEmpty:!0},n=>{t&&(n.font={size:10}),n.alignment={wrapText:!0},n.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}})}}}},K={class:"report-management"},Q=p("div",{class:"md:flex justify-between p-6 md:space-y-0 space-y-3 items-center border-b-2"},[p("div",null,[p("span",null,"รายงานสรุปจํานวนหนังสือที่อยู่ในระหว่างดําเนินการ")])],-1),Z={class:"flex flex-row-between p-6"},$={class:"flex basis-1/5"},ee={class:"flex gap-3"},te={class:"flex items-center"},oe=p("span",{class:"px-2"},"Export",-1),se={class:"flex basis-4/5 gap-3"},ae={class:"basis-full"},ne={class:"basis-full"},re={class:"basis-full"},le={class:"basis-full"},ie={class:"my-5 px-6"},de=p("div",{class:"text-center"},[p("div",{class:"text-gray-400"},"ไม่พบข้อมูล")],-1),ce={key:0},pe={key:1};function me(o,t,a,s,e,r){const c=f("Icon"),n=f("Button"),i=f("Dropdown"),d=f("vSelect"),h=f("VueSelect"),_=f("apexchart"),g=f("Card"),R=f("vue-good-table");return w(),x("div",K,[m(g,{noborder:"",bodyClass:"two-side-card"},{default:u(()=>[Q,p("div",Z,[p("div",$,[p("div",ee,[m(i,{classMenuItems:"left-0  w-[220px] top-[110%]",items:e.exportLists,onOnClickItem:r.handleExport},{default:u(()=>[m(n,{btnClass:"btn-primary text-slate-50",div:"",iconClass:"text-lg"},{default:u(()=>[p("div",te,[m(c,{icon:"ic:baseline-cloud-download",class:"handle text-[20px]"}),oe])]),_:1})]),_:1},8,["items","onOnClickItem"])])]),p("div",se,[p("div",ae,[m(h,{classInput:"input_color"},{default:u(()=>[m(d,{modelValue:e.filter.bookType,"onUpdate:modelValue":t[0]||(t[0]=l=>e.filter.bookType=l),label:"title",class:"input_color border rounded",reduce:l=>l.id,options:e.bookTypeList,"onOption:selected":t[1]||(t[1]=l=>r.getData())},null,8,["modelValue","reduce","options"])]),_:1})]),p("div",ne,[m(h,{classInput:"input_color"},{default:u(()=>[m(d,{modelValue:e.filter.month,"onUpdate:modelValue":t[2]||(t[2]=l=>e.filter.month=l),label:"title",class:"input_color border rounded",reduce:l=>l.id,options:e.MonthList,"onOption:selected":t[3]||(t[3]=l=>r.getData())},null,8,["modelValue","reduce","options"])]),_:1})]),p("div",re,[m(h,{classInput:"input_color"},{default:u(()=>[m(d,{modelValue:e.filter.year,"onUpdate:modelValue":t[4]||(t[4]=l=>e.filter.year=l),label:"title",class:"input_color border rounded",reduce:l=>l.value,options:e.yearItems,"onOption:selected":t[5]||(t[5]=l=>r.getData())},null,8,["modelValue","reduce","options"])]),_:1})]),p("div",le,[m(h,{classInput:"input_color"},{default:u(()=>[m(d,{modelValue:e.filter.agency,"onUpdate:modelValue":t[6]||(t[6]=l=>e.filter.agency=l),placeholder:"หน่วยงานทั้งหมด",label:"organization_name",class:"input_color border rounded",reduce:l=>l.id,options:e.agencyItem,"onOption:selected":t[7]||(t[7]=l=>r.getData())},null,8,["modelValue","reduce","options"])]),_:1})])])]),p("div",ie,[m(g,null,{default:u(()=>[(w(!0),x(z,null,P(e.dataGraph,(l,S)=>(w(),J(_,{key:S,type:l.chartType,height:"360",width:"100%",options:l.options,series:l.series},null,8,["type","options","series"]))),128))]),_:1})]),m(R,{columns:e.columns,styleClass:" vgt-table bordered mb-6",rows:e.dataTable,"pagination-options":{enabled:!1},"sort-options":{enabled:!1}},{emptystate:u(()=>[de]),"table-row":u(l=>[l.column.field=="month"?(w(),x("div",ce,I(l.row.name),1)):(w(),x("div",pe,I(l.row[l.column.field]),1))]),_:1},8,["columns","rows"])]),_:1})])}const He=A(q,[["render",me]]);export{He as default};
