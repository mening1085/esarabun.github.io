import{C as O}from"./index-cb5a08aa.js";import{I as j}from"./index-8d30ace7.js";import{B as A}from"./index-c2d6eb9c.js";import{E as V}from"./index-360221be.js";import{D as I}from"./index-976a2577.js";import{C as N,B as Y,A as H,a as q,b as G,R as J}from"./RouteDetail-d06baee9.js";import{B as K}from"./BookDraftRef-086a5656.js";import{M as Q}from"./index-8e7d66d6.js";import{M as U}from"./index-41156f18.js";import{M as W}from"./index-b704274e.js";import{_ as X,t as w,g as Z,a as f,F as $}from"./index-f91482a0.js";import{d as ee}from"./dayjs.min-472eb357.js";import{M as te}from"./index-3891a0e1.js";import{T as se}from"./ThreeForm-c5dff615.js";import{o as _,m,bj as v,n as l,x as a,aF as n,as as r,p as o,aT as y,w as ie}from"./preload-helper-f37a9bec.js";import"./iconify-2baafea4.js";import"./dom-b10fc197.js";import"./focus-management-94a631f4.js";import"./open-closed-75edfb8a.js";import"./use-resolve-button-type-d7bee841.js";import"./use-outside-click-156e41c1.js";import"./index-f32159fc.js";import"./Modal-b54f1b5f.js";import"./transition-be7c09bc.js";import"./hidden-800255f5.js";import"./micro-task-89dcd6af.js";import"./index-e163c14d.js";import"./vee-validate.esm-bf91438b.js";import"./array-6ac4c54d.js";import"./TextValid-d1c607fc.js";import"./index-78f015fc.js";import"./index-3e8503e7.js";import"./vue-cleave.min-df5c8cc9.js";import"./index-e68945de.js";import"./tabs-cf3e0d3b.js";import"./VueSelect-403231fd.js";import"./index-fdd62298.js";import"./index-325a54cb.js";import"./ck-white-3501111f.js";import"./index-60fb4808.js";import"./vue3-tree-vue.esm-0dbd4492.js";import"./index-8ecfca6d.js";const oe={name:"ReceiveView",components:{Card:O,Icon:j,Button:A,Expansion:V,Dropdown:I,CoverSheet:N,BookDetail:Y,AttachedFile:H,BookReference:q,Activity:G,RouteDetail:J,BookDraftRef:K,ModalSuccess:Q,ModalError:te,ModalSigned:U,Modal:W,ThreeForm:se},data(){return{isOpen:!1,pdfPath:"",checkPermission:!1,userList:[],organizeList:[],customList:[],urlSarabun:w,item:null,isSuccess:!1,isError:!1,isSigned:!1,pinError:""}},created(){this.fetchData()},computed:{isMobile(){return Z().isMobile}},methods:{async pdfHistory(){const{data:s,status:t}=await f("documentStore","PDFHistory",{payload:this.$route.params.id});t==200&&(console.log("data pdf",s.result),this.pdfPath=s.result,this.isOpen=!0)},async handleSigned(){this.isSigned=!0},async signedSubmit(s){var u;s.id=this.$route.params.id;const t=await f("signedStore","store",{payload:s});console.log("data",t),t.status===200?(this.isOrder=!1,setTimeout(()=>{this.isSuccess=!0,$().clearSignature},10)):t.status===403&&(this.pinError=(u=t.data)==null?void 0:u.message)},closeModal(){this.isSuccess=!1,this.isSigned=!1,this.isShowModalReturn=!1},refresh(){this.isSuccess=!1,location.reload()},async fetchData(){var u,g,e,i,h,d;console.log("fetchData");const{data:s,status:t}=await f("signedStore","showSend",{payload:this.$route.params.id});if(t===200){this.item=await s.result,this.checkPermission=s.result.permission.sign;const c=await f("signedStore","getMaster");c.status==200&&(console.log("res",c),this.organizeList=(g=(u=c.data)==null?void 0:u.message)==null?void 0:g.organization_list,this.userList=(i=(e=c.data)==null?void 0:e.message)==null?void 0:i.user_list,this.customList=(d=(h=c.data)==null?void 0:h.message)==null?void 0:d.custom_groups)}},convertDate(s){return s?ee(s).locale("th").add(543,"year").format("DD/MM/YYYY"):"-"},async handleReceiveBook(){console.log("handleReceiveBook");const{data:s,status:t}=await f("documentStore","acceptDocument",{payload:this.$route.params.id});t===200&&(this.isSuccess=!0,this.fetchData())},async submit(s){console.log("payload",s);const{data:t,status:u}=await f("signedStore","senTo",{payload:s});u==200&&this.$router.push("/app/issue/sent-book")},onReturn(){console.log("onReturn")},onPrinter(){console.log("onPrinter")},downloadFileDocument(s){console.log(s)},downloadFile(s){const t=w+s;window.open(t,"_blank")}}},ne={key:0,class:"flex items-center gap-3"},re=o("div",null,"กลับไปหน้ารายการ",-1),le={key:1,class:"pt-4"},ae={class:"md:text-2xl text-[16px] font-medium my-6"},ce={key:8},me={class:"h-[250px] flex items-center justify-center"},ue={class:"text-center flex flex-row flex-wrap justify-center"},pe={class:"basis-full flex justify-center mb-5"},de=o("div",null,[o("h4",{class:"text-lg text-slate-900"},[ie(" ลงนามเอกสารอิเล็กทรอนิกส์ "),o("span",{class:"text-green-500"},"สำเร็จ")])],-1),fe=o("hr",null,null,-1),he={class:"flex justify-center mt-4"},ve=["src"];function _e(s,t,u,g,e,i){const h=n("Icon"),d=n("Button"),c=n("Card"),D=n("CoverSheet"),B=n("BookDetail"),E=n("BookDraftRef"),R=n("AttachedFile"),L=n("BookReference"),T=n("Activity"),P=n("RouteDetail"),F=n("ThreeForm"),z=n("ModalSigned"),k=n("Modal");return r(),_("div",null,[e.item?(r(),m(c,{key:0},{default:v(()=>{var p,b,x,S,M,C;return[i.isMobile?l("",!0):(r(),_("div",ne,[o("div",{onClick:t[0]||(t[0]=ge=>s.$router.back()),class:"flex items-center text-primary-600 cursor-pointer"},[a(h,{icon:"mdi:chevron-left",class:"text-xl"}),re])])),((p=e.item)==null?void 0:p.status)=="รอลงนาม"&&e.checkPermission?(r(),_("div",le,[a(c,{bodyClass:"bg-gray-100 h-[95px] flex items-center space-y-10 py-6"},{default:v(()=>[o("div",null,[a(d,{onClick:i.handleSigned,icon:"mdi:certificate",text:"ลงนามเอกสารอิเล็กทรอนิกส์"},null,8,["onClick"])])]),_:1})])):l("",!0),o("div",ae," วันที่ "+y(i.convertDate((b=e.item)==null?void 0:b.document_date))+" "+y((x=e.item)==null?void 0:x.subject)+" พ.ศ. "+y((S=e.item)==null?void 0:S.year),1),i.isMobile?l("",!0):(r(),m(D,{key:2,activeTab:e.checkPermission,item:e.item},null,8,["activeTab","item"])),a(B,{activeTab:e.checkPermission&&i.isMobile,item:e.item},null,8,["activeTab","item"]),a(E,{item:e.item},null,8,["item"]),i.isMobile?l("",!0):(r(),m(R,{key:3,item:e.item},null,8,["item"])),i.isMobile?l("",!0):(r(),m(L,{key:4,item:e.item},null,8,["item"])),i.isMobile?l("",!0):(r(),m(T,{key:5,item:e.item,"onEvent:onClick":i.pdfHistory},null,8,["item","onEvent:onClick"])),i.isMobile?l("",!0):(r(),m(P,{key:6,item:e.item},null,8,["item"])),e.checkPermission?l("",!0):(r(),m(F,{key:7,activeTab:((M=s.$route.query)==null?void 0:M.type)=="signed",organizeList:e.organizeList,userList:e.userList,customList:e.customList,item:e.item,"onEvent:submit":i.submit},null,8,["activeTab","organizeList","userList","customList","item","onEvent:submit"])),((C=e.item)==null?void 0:C.status)=="รอลงนาม"&&e.checkPermission?(r(),_("div",ce,[a(c,{bodyClass:"bg-gray-100 h-[95px] flex items-center space-y-10 py-6"},{default:v(()=>[o("div",null,[a(d,{onClick:i.handleSigned,icon:"mdi:certificate",text:"ลงนามเอกสารอิเล็กทรอนิกส์"},null,8,["onClick"])])]),_:1})])):l("",!0)]}),_:1})):l("",!0),a(z,{item:e.item,title:"ลงนามเอกสารอิเล็กทรอนิกส์",isOpen:e.isSigned,pinError:e.pinError,"onEvent:closeModal":t[1]||(t[1]=p=>e.isSigned=!1),"onEvent:submit":i.signedSubmit,"onEvent:pincode":t[2]||(t[2]=p=>e.pinError="")},null,8,["item","isOpen","pinError","onEvent:submit"]),e.isSuccess?(r(),m(k,{key:1,title:"",activeModal:e.isSuccess,"onEvent:closeModal":t[5]||(t[5]=p=>e.isSuccess=!1),label:"",labelClass:"btn-outline-dark",sizeClass:"w-full max-w-[700px]",centered:""},{default:v(()=>[o("div",null,[o("div",me,[o("div",ue,[o("div",pe,[a(h,{icon:"icon-park-solid:protect",class:"text-6xl text-green-500"})]),de])]),fe,o("div",he,[a(d,{text:"ปิด",btnClass:"btn-primary w-32 mx-2",onClick:t[3]||(t[3]=p=>i.refresh())}),a(d,{text:"ไปหน้ารายการ",btnClass:"btn-outline-dark w-32 mx-2",onClick:t[4]||(t[4]=p=>s.$router.push("/app/issue/signed"))})])])]),_:1},8,["activeModal"])):l("",!0),e.isOpen?(r(),m(k,{key:2,title:"ดูรายละเอียดเอกสาร",labelClass:"btn-outline-dark",sizeClass:"w-3/4",label:"",centered:"",activeModal:e.isOpen,"onEvent:closeModal":t[6]||(t[6]=p=>e.isOpen=!1)},{default:v(()=>[o("div",null,[o("iframe",{class:"w-full h-[1000px] mt-4",src:"data:application/pdf;base64, "+e.pdfPath,frameborder:"0"},null,8,ve)])]),_:1},8,["activeModal"])):l("",!0)])}const lt=X(oe,[["render",_e]]);export{lt as default};
