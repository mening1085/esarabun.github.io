import{be as S,A as Q,aY as $,aA as P,al as ee,ah as te,af as ne,aj as se,W as J,ab as K,k as oe,aF as v,as as f,o as I,m as O,bj as y,p as a,x as d,F as V,aD as B,ac as U,aT as k,n as q,w as N,aw as ae,at as ie}from"./preload-helper-f37a9bec.js";import{M as F}from"./index-b704274e.js";import{B as L}from"./index-c2d6eb9c.js";import{T as W}from"./index-3e8503e7.js";import{I as z}from"./index-8d30ace7.js";import{R as j}from"./index-e163c14d.js";import{_ as G,x as le,y as re,z as ce}from"./index-f91482a0.js";import{l as de,a as ue,n as ge,r as me,u as he}from"./tabs-cf3e0d3b.js";import{C as fe}from"./index-325a54cb.js";import{I as ve}from"./index-2198f2cf.js";import{P as _e}from"./index-5ddbaceb.js";import{V as pe,C as Ie}from"./VueSelect-403231fd.js";var be=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],xe=function(e){return be.map(function(t){return t.toLowerCase()}).indexOf(e.toLowerCase())!==-1},ye=function(e,t,s){Object.keys(t).filter(xe).forEach(function(o){var n=t[o];typeof n=="function"&&(o==="onInit"?n(e,s):s.on(o.substring(2),function(i){return n(i,s)}))})},we=function(e,t,s,o){var n=e.modelEvents?e.modelEvents:null,i=Array.isArray(n)?n.join(" "):n;S(o,function(r,u){s&&typeof r=="string"&&r!==u&&r!==s.getContent({format:e.outputFormat})&&s.setContent(r)}),s.on(i||"change input undo redo",function(){t.emit("update:modelValue",s.getContent({format:e.outputFormat}))})},Ce=function(e,t,s,o,n,i){o.setContent(i()),s.attrs["onUpdate:modelValue"]&&we(t,s,o,n),ye(e,s.attrs,o)},H=0,X=function(e){var t=Date.now(),s=Math.floor(Math.random()*1e9);return H++,e+"_"+s+H+String(t)},Pe=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},Z=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},Se=function(e,t){return Z(e).concat(Z(t))},ke=function(e){return e==null},Y=function(){return{listeners:[],scriptId:X("tiny-script"),scriptLoaded:!1}},Me=function(){var e=Y(),t=function(n,i,r,u){var l=i.createElement("script");l.referrerPolicy="origin",l.type="application/javascript",l.id=n,l.src=r;var g=function(){l.removeEventListener("load",g),u()};l.addEventListener("load",g),i.head&&i.head.appendChild(l)},s=function(n,i,r){e.scriptLoaded?r():(e.listeners.push(r),n.getElementById(e.scriptId)||t(e.scriptId,n,i,function(){e.listeners.forEach(function(u){return u()}),e.scriptLoaded=!0}))},o=function(){e=Y()};return{load:s,reinitialize:o}},Te=Me(),De=function(){return typeof window<"u"?window:global},A=function(){var e=De();return e&&e.tinymce?e.tinymce:null},Ve={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},R=globalThis&&globalThis.__assign||function(){return R=Object.assign||function(e){for(var t,s=1,o=arguments.length;s<o;s++){t=arguments[s];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},R.apply(this,arguments)},Be=function(e,t,s,o){return e(o||"div",{id:t,ref:s})},qe=function(e,t,s){return e("textarea",{id:t,visibility:"hidden",ref:s})},hn=Q({props:Ve,setup:function(e,t){var s=e.init?R({},e.init):{},o=$(e),n=o.disabled,i=o.modelValue,r=o.tagName,u=P(null),l=null,g=e.id||X("tiny-vue"),x=e.init&&e.init.inline||e.inline,w=!!t.attrs["onUpdate:modelValue"],C=!0,m=e.initialValue?e.initialValue:"",_="",h=function(b){return w?function(){return i!=null&&i.value?i.value:""}:function(){return b?m:_}},c=function(){var b=h(C),p=R(R({},s),{readonly:e.disabled,selector:"#"+g,plugins:Se(s.plugins,e.plugins),toolbar:e.toolbar||s.toolbar,inline:x,setup:function(D){l=D,D.on("init",function(E){return Ce(E,e,t,D,i,b)}),typeof s.setup=="function"&&s.setup(D)}});Pe(u.value)&&(u.value.style.visibility=""),A().init(p),C=!1};S(n,function(b){var p;l!==null&&(typeof((p=l.mode)===null||p===void 0?void 0:p.set)=="function"?l.mode.set(b?"readonly":"design"):l.setMode(b?"readonly":"design"))}),S(r,function(b){var p;w||(_=l.getContent()),(p=A())===null||p===void 0||p.remove(l),K(function(){return c()})}),ee(function(){if(A()!==null)c();else if(u.value&&u.value.ownerDocument){var b=e.cloudChannel?e.cloudChannel:"5",p=e.apiKey?e.apiKey:"no-api-key",D=ke(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/"+p+"/tinymce/"+b+"/tinymce.min.js":e.tinymceScriptSrc;Te.load(u.value.ownerDocument,D,c)}}),te(function(){A()!==null&&A().remove(l)}),x||(ne(function(){C||c()}),se(function(){var b;w||(_=l.getContent()),(b=A())===null||b===void 0||b.remove(l)}));var M=function(b){var p;_=l.getContent(),(p=A())===null||p===void 0||p.remove(l),s=R(R({},s),b),K(function(){return c()})};return t.expose({rerender:M}),function(){return x?Be(J,g,u,e.tagName):qe(J,g,u)}}});const Ae={name:"ModalOrganizeIn",components:{Modal:F,Button:L,Icon:z,TabGroup:de,TabList:ue,Tab:ge,TabPanels:me,TabPanel:he,Radio:j,TextInput:W},props:["tabIndex","title","isOpen","items","modalId"],setup(e,{emit:t}){console.log("props",e.tabIndex);const s=P(""),o=P([]),n=P(e.title||""),i=P(e.isOpen||!1),r=P([{title:"บุคคล"}]),u=P(0),l=P(e.tabIndex),g=P([]),x=oe(()=>e.items.find(c=>c.id==u.value));S(()=>e.modalId,c=>{u.value=c||""}),S(()=>e.tabIndex,c=>{l.value=c||""}),S(()=>e.title,c=>{n.value=c||""}),S(()=>e.isOpen,c=>{i.value=c||!1}),S(()=>e.items,c=>{g.value=c,o.value=c}),S(()=>x.value,c=>{w.value=!1}),S(()=>s.value,c=>{c==""&&(g.value=o.value)});const w=P(!1);return{title:n,isOpen:i,defaultItemUser:o,search:s,buttons:r,selectedItem:u,user_list:g,selectedTab:l,userItem:x,valid:w,onSearch:()=>{g.value=o.value;const c=g.value.filter(M=>M.full_name.includes(s.value));g.value=c},changeTab:c=>{l.value=c},onSubmitModal:async()=>{console.log("userItem.value",x.value),x.value?t("event:submit",x.value):w.value=!0},closeModal:()=>{console.log("closeModal"),t("event:close")}}}},Re={class:"min-h-[200px]"},Ee={class:"flex"},Oe={class:"basis-2/3 border-r"},Ue=a("div",{class:"basis-1/3"},[a("div",{class:"text-center border-b",style:{"margin-top":"6px"}}," บุคคล ที่เลือก ")],-1),Ne={class:"flex"},Fe={class:"basis-2/3 border-r py-3 pr-4"},Le={class:"border rounded-lg p-2 mt-4"},We={class:"gap-5 h-[400px] px-3 overflow-y-auto"},ze={class:"flex items-center gap-2 mb-1"},je={class:"shirnk"},Ge={class:"shirnk"},Je={class:"font-bold"},Ke={class:"text-sm text-gray-500"},He={key:0,class:"basis-1/3 py-3"},Ze={class:"pl-3"},Ye={class:"flex items-center gap-2 border bg-gray-50 p-2 my-3 rounded"},Xe={class:"shrink"},Qe={class:"shrink"},$e={class:"text-md ell-1"},et={class:"text-sm ell-1 text-gray-500"},tt={key:0,class:"text-sm text-red-500"},nt={class:"text-center my-4 flex justify-center w-full"};function st(e,t,s,o,n,i){const r=v("Tab"),u=v("TabList"),l=v("TextInput"),g=v("Icon"),x=v("Radio"),w=v("TabPanel"),C=v("TabPanels"),m=v("TabGroup"),_=v("Button"),h=v("Modal");return f(),I("div",null,[o.isOpen?(f(),O(h,{key:0,title:o.title,label:"",labelClass:"btn-outline-dark",sizeClass:"w-full max-w-[700px]",centered:"",ref:"modalDialog",activeModal:o.isOpen,"onEvent:closeModal":t[5]||(t[5]=c=>o.closeModal())},{footer:y(()=>[a("div",nt,[d(_,{text:"ยืนยัน",btnClass:"btn-primary w-32 mx-2",onOnClick:t[3]||(t[3]=c=>o.onSubmitModal())}),d(_,{text:"ยกเลิก",btnClass:"btn-outline-dark w-32 mx-2",onOnClick:t[4]||(t[4]=c=>o.closeModal())})])]),default:y(()=>[a("div",Re,[d(m,{selectedIndex:o.selectedTab,onChange:o.changeTab},{default:y(()=>[a("div",Ee,[a("div",Oe,[d(u,{class:"flex border-b"},{default:y(()=>[(f(!0),I(V,null,B(o.buttons,(c,M)=>(f(),O(r,{as:"template",key:M,class:"px-3"},{default:y(({selected:b})=>[a("button",{class:U([[b?"text-primary-500 before:w-full border-b-2 pb-1 border-primary-500":"text-slate-500 before:w-0 dark:text-slate-300"],"w-[150px]"])},k(c.title),3)]),_:2},1024))),128))]),_:1})]),Ue]),d(C,null,{default:y(()=>[d(w,null,{default:y(()=>{var c,M,b;return[a("div",Ne,[a("div",Fe,[d(l,{type:"text",classInput:"border border-gray-300 w-full mt-3",keyupEnter:"",modelValue:o.search,"onUpdate:modelValue":t[0]||(t[0]=p=>o.search=p),placeholder:"พิมพ์ชื่อพนักงานแล้วกดปุ่ม Enter","onEvent:enter":t[1]||(t[1]=p=>o.onSearch())},null,8,["modelValue"]),a("div",Le,[a("div",We,[(f(!0),I(V,null,B(o.user_list,(p,D)=>(f(),I("div",{key:D},[d(x,{modelValue:o.selectedItem,"onUpdate:modelValue":t[2]||(t[2]=E=>o.selectedItem=E),value:p.id},{default:y(()=>{var E;return[a("div",ze,[a("div",je,[d(g,{icon:"mdi:user-circle",class:"text-2xl text-gray-500"})]),a("div",Ge,[a("div",Je,k(p.full_name),1),a("div",Ke,k((E=p.organization)==null?void 0:E.organization_name),1)])])]}),_:2},1032,["modelValue","value"])]))),128))])])]),o.userItem?(f(),I("div",He,[a("div",Ze,[a("div",Ye,[a("div",Xe,[d(g,{icon:"mdi:user-circle",class:"text-3xl text-gray-500"})]),a("div",Qe,[a("div",$e,k((c=o.userItem)==null?void 0:c.full_name),1),a("div",et,k((b=(M=o.userItem)==null?void 0:M.organization)==null?void 0:b.organization_name),1)])])])])):q("",!0)]),o.valid?(f(),I("div",tt," กรุณาเลือกบุคคล ")):q("",!0)]}),_:1})]),_:1})]),_:1},8,["selectedIndex","onChange"])])]),_:1},8,["title","activeModal"])):q("",!0)])}const fn=G(Ae,[["render",st]]);const ot={name:"ModalBookRef",props:{title:{type:String,default:""},isOpen:{type:Boolean,default:!1},items:{type:Array,default:()=>[]},multiple:{type:Boolean,default:!0}},components:{Modal:F,Button:L,Icon:z,TextInput:W,Checkbox:fe,Pagination:_e,InputGroup:ve,Radio:j},computed:{columns(){return[{label:"",field:"selected",width:"5%",tdClass:"text_left",thClass:"text_left",hidden:!!this.multiple},{label:"เลขที่หนังสือ",field:"document_number",width:"15%",tdClass:"text_left",thClass:"text_left"},{label:"เรื่อง/จาก",field:"subject",width:"35%",tdClass:"text_left",thClass:"text_left"},{label:"เลขรับ/ส่ง",field:"initial_number_from",width:"15%",tdClass:"text_left",thClass:"text_left"},{label:"ถึง",field:"toData.full_name",width:"25%",tdClass:"text_left",thClass:"text_left"}]}},data(){return{radioSelected:"",form:{keyword:"",checkbox:[],year:""},book_list:[],book_list_default:[],checkbox_list:["เลขที่หนังสือ","จาก","ถึง","เรียน","เรื่อง","รายละเอียด","ไฟล์แนบ","ผู้ลงนาม/สั่งการ"],current:1,total:null,perpage:10,pageRange:5,searchTerm:"",options:[{value:"1",label:"1"},{value:"3",label:"3"},{value:"5",label:"5"}],selectedItem:[]}},watch:{items:function(){this.book_list=this.items,this.book_list_default=this.items,this.total=this.book_list.length}},methods:{closeModal(){console.log("closeModal"),this.$emit("event:close")},selectedItems(e){this.form.checkbox.find(s=>s===e)?this.removeItem(e):this.addItem(e)},addItem(e){this.form.checkbox.push(e),this.form.checkbox.sort((t,s)=>t-s)},removeItem(e){const t=this.form.checkbox.findIndex(s=>s===e);this.form.checkbox.splice(t,1)},onSearch(){console.log("onSearch"),this.book_list=this.book_list_default;const e=this.book_list.filter(t=>{const s=this.form.keyword.trim(),o=this.form.year.trim(),n=this.form.checkbox;return!(s&&!t.subject.includes(s)||n.length>0&&n.find(r=>r==="เลขที่หนังสือ")&&!t.subject.includes("เลขที่หนังสือ")||o&&!t.year.includes(o))});console.log(e),this.book_list=e},onCancel(){console.log("onCancel"),this.$emit("event:close")},addBook(){if(this.multiple)this.selectedItem.length>0&&this.$emit("event:submit",this.selectedItem);else if(this.radioSelected){const e=this.book_list.find(t=>t.id===this.radioSelected);console.log("result",e),this.$emit("event:submit",e)}},handleSelectedItems({selectedRows:e}){this.selectedItem=[],this.selectedItem=e},onSelectedRadioItem(e){console.log("item",e),this.radioSelected=e.id}}},at={class:"flex h-[750px] gap-5"},it={class:"basis-1/3 border-r"},lt={class:"pr-5"},rt=a("div",{class:"text-sm"},"คำค้นจากแหล่งข้อมูล",-1),ct={class:"flex flex-wrap mt-5"},dt=a("div",{class:"text-sm mt-3"},"ปี",-1),ut=a("div",{class:"text-sm text-blue-500 mt-8 cursor-pointer"}," แสดงเงื่อนไขเพิ่มเติม ",-1),gt={class:"text-center mt-4 flex justify-center w-full"},mt={class:"basis-2/3"},ht={class:"flex justify-between pb-6 items-center"},ft={class:"text-gray-500"},vt={class:"flex items-center"},_t=a("span",null,"หนังสืออ้างถึงที่เลือก",-1),pt={key:0},It={key:0},bt=a("div",{class:"text-center"},[a("div",{class:"text-gray-400"},"ไม่พบข้อมูล")],-1),xt={class:"py-4 px-3"};function yt(e,t,s,o,n,i){const r=v("InputGroup"),u=v("Checkbox"),l=v("TextInput"),g=v("Button"),x=v("Icon"),w=v("Radio"),C=v("Pagination"),m=v("vue-good-table"),_=v("Modal");return f(),I("div",null,[s.isOpen?(f(),O(_,{key:0,title:s.title,label:"",labelClass:"btn-outline-dark",sizeClass:"w-4/5 ",centered:"",activeModal:s.isOpen,"onEvent:closeModal":t[7]||(t[7]=h=>i.closeModal())},{default:y(()=>[a("div",at,[a("div",it,[a("div",lt,[rt,d(r,{type:"text",prependIcon:"heroicons-outline:search",merged:"",class:"w-full",modelValue:n.form.keyword,"onUpdate:modelValue":t[0]||(t[0]=h=>n.form.keyword=h)},null,8,["modelValue"]),a("div",ct,[(f(!0),I(V,null,B(n.checkbox_list,(h,c)=>(f(),I("div",{class:"basis-1/2 pb-2",key:c},[d(u,{label:h,activeClass:"bg-primary-500",onClick:M=>i.selectedItems(h)},null,8,["label","onClick"])]))),128))]),dt,d(l,{type:"text",class:"w-full",classInput:"rounded",modelValue:n.form.year,"onUpdate:modelValue":t[1]||(t[1]=h=>n.form.year=h)},null,8,["modelValue"]),ut,a("div",gt,[d(g,{text:"ค้นหา",btnClass:"btn-primary w-32 mx-2",onOnClick:t[2]||(t[2]=h=>i.onSearch())}),d(g,{text:"ยกเลิก",btnClass:"btn-outline-dark w-32 mx-2",onOnClick:t[3]||(t[3]=h=>i.onCancel())})])])]),a("div",mt,[a("div",null,[a("div",ht,[a("div",ft," ผลการค้นหา "+k(n.book_list.length)+" รายการ ",1),d(g,{btnClass:"bg-primary-500 rounded-lg text-white mx-2",onOnClick:t[4]||(t[4]=h=>i.addBook())},{default:y(()=>[a("div",vt,[d(x,{icon:"heroicons-outline:plus",class:"mr-2"}),_t,n.selectedItem.length>0?(f(),I("span",pt," ("+k(n.selectedItem.length)+") ",1)):q("",!0)])]),_:1})]),d(m,{columns:i.columns,styleClass:" vgt-table bordered centered",rows:n.book_list,"pagination-options":{enabled:!0,perPage:n.perpage},"search-options":{enabled:!1},"select-options":{enabled:!!s.multiple},"sort-options":{enabled:!1},"filter-options":{enabled:!1},onSelectedRowsChange:i.handleSelectedItems},{"table-row":y(h=>[h.column.field=="selected"?(f(),I("div",It,[d(w,{svg:"",inputClass:"bg-red-500",value:h.row.id,modelValue:n.radioSelected,"onUpdate:modelValue":t[5]||(t[5]=c=>n.radioSelected=c),onClick:c=>i.onSelectedRadioItem(h.row)},null,8,["value","modelValue","onClick"])])):q("",!0)]),emptystate:y(()=>[bt]),"pagination-bottom":y(h=>[a("div",xt,[d(C,{total:n.total,current:n.current,"per-page":n.perpage,pageRange:n.pageRange,onPageChanged:t[6]||(t[6]=c=>n.current=c),pageChanged:h.pageChanged,perPageChanged:h.perPageChanged,enableSearch:"",enableInput:""},{default:y(()=>[N(" > ")]),_:2},1032,["total","current","per-page","pageRange","pageChanged","perPageChanged"])])]),_:1},8,["columns","rows","pagination-options","select-options","onSelectedRowsChange"])])])])]),_:1},8,["title","activeModal"])):q("",!0)])}const vn=G(ot,[["render",yt]]);const wt={name:"ScannerModal",components:{Modal:F,Icon:z,VueSelect:pe,vSelect:Ie,Button:L,Textinput:W,Radio:j},props:{activeModal:{default:!1}},data(){return{deviceManager:{},acquiredImages:{},scannerDevices:[],pages:[],allDPI:[100,150,200,300],allPaperTypes:["A4 (210 x 297 mm)"],selectedDPI:200,selectedPaperType:"A4 (210 x 297 mm)",isImageProcessing:!1,docInfo:{name:"File-1"},thumbnails:[],scanner:void 0,selectedScanner:void 0,selectedPdfMode:"PDF",currentPage:!this.pages||this.pages.length===0?0:1,selectedDisplayMode:"BW",displayMode:[{name:"B&W",value:"BW"},{name:"Gray",value:"Gray"},{name:"Color",value:"RGB"}],pdfModes:[{name:"PDF",value:"PDF"},{name:"Multi-Page PDF",value:"Multi-Page PDF"}],scannerActionList:[{title:"Print",icon:"material-symbols:print",fnName:"printPage"},{title:"Zoom in",icon:"ic:baseline-zoom-in",fnName:"zoomIn"},{title:"Zoom out",icon:"ic:baseline-zoom-out",fnName:"zoomOut"},{title:"Invert color",icon:"ion:invert-mode-outline",fnName:"invertPage"},{title:"Increase Brightness",icon:"bi:brightness-high",fnName:"increaseBrightness"},{title:"Decrease Brightness",icon:"bi:brightness-high-fill",fnName:"decreaseBrightness"},{title:"Increase Contrast",icon:"ion:contrast-outline",fnName:"increaseContrast"},{title:"Decrease Contrast",icon:"ion:contrast",fnName:"decreaseContrast"},{title:"Rotate",icon:"ic:baseline-rotate-90-degrees-ccw",fnName:"rotatePage"}]}},computed:{activeModalComputed(){return this.activeModal},_focusedImageIndex(){return this.currentPage-1}},watch:{activeModalComputed(){this.activeModal&&this.$nextTick(()=>{this.initialLib()})}},methods:{initialLib(){console.log("initial");let e=window.Vintasoft;e.Twain.WebTwainGlobalSettingsJS.register(le,re,ce);let t;window.location.protocol=="http:"?t="http://localhost:25319/api/VintasoftTwainApi":t="https://localhost:25329/api/VintasoftTwainApi";let s=new e.Shared.WebServiceControllerJS(t);this.deviceManager=new e.Twain.WebTwainDeviceManagerJS(s),this.acquiredImages=new e.Twain.WebAcquiredImageCollectionJS(this.deviceManager);try{console.log("1.1");let o=new e.Twain.WebTwainDeviceManagerInitSettingsJS;console.log("1.2"),this.deviceManager.open(o),console.log("1.3")}catch(o){if(console.log("1.4"),o.toString().startsWith("NetworkError")){console.log("1.5");let n=window.location.origin+"/VSWebTwainService14_1.zip";console.log("Download TWAIN service: ",n),window.open(n),alert(`VintaSoft Web TWAIN service is not found.

Please close this dialog, download VintaSoft Web TWAIN Service, manually install the service on your computer, reload this web page in web browser (Firefox must be restarted) and try to scan images once again.`)}else alert(o);return}console.log("2"),this.isImageProcessing=!0;try{let o=this.deviceManager.get_Devices();console.log("Device: ",o),console.log("Device count: ",o.length);for(let n=0;n<o.length;n++)this.scannerDevices[n]={},this.scannerDevices[n].label=o[n].get_DeviceName();console.log("Devices: ",this.scannerDevices),this.scannerDevices.length===0?alert("System does not have TWAIN devices."):(this.scanner=this.deviceManager.get_DefaultDevice(),this.selectedScanner={label:this.scanner.get_DeviceName()})}catch(o){alert(o)}finally{this.isImageProcessing=!1}},changeScannerDevice(e){console.log("before change",this.scanner),this.scanner=this.deviceManager.get_Devices().find(t=>t.get_DeviceName()===e.label),this.selectedScanner=e,console.log("after change",this.scanner)},eventClose(){this.docInfo={name:"File-1"};for(let e=0;e<this.acquiredImages.length;e++)this.acquiredImages.removeAt(e);this.pages=[],this.selectedDisplayMode="BW",this.selectedPdfMode="PDF",this.selectedPaperType="A4 (210 x 297 mm)",this.selectedDPI=200,this.scanner!=null&&this.scanner.get_IsOpened()&&this.scanner.close(),this.deviceManager.get_IsOpened()&&this.deviceManager.close(),this.isImageProcessing=!1,this.$emit("onClose")},async eventScan(e=!1){if(console.log("scan"),this.scanner==null)alert("TWAIN device is not found.");else{this.isImageProcessing=!0,console.log(this.scanner),console.log(this.selectedScanner),this.scanner.get_IsOpened()&&this.scanner.close(),this.scanner.open(!1,!0);let t=window.Vintasoft,s=new t.Twain.WebPixelTypeEnumJS(this.selectedDisplayMode);this.scanner.set_PixelType(s),console.log("set_PixelType",s),this.scanner.set_XResolution(this.selectedDPI),this.scanner.set_YResolution(this.selectedDPI),console.log("set_XResolution set_YResolution",this.selectedDPI);let o;do{let n=this.scanner.acquireModalSync();switch(o=n.get_AcquireModalState().valueOf(),o){case 2:let i=n.get_AcquiredImage(),r=i.getAsBase64String();if(!e)this.acquiredImages.add(i),this.pages.push(r);else{this.isImageProcessing=!0,console.log("before acquiredImages ",this.acquiredImages);let u=new t.Twain.WebAcquiredImageCollectionJS(this.deviceManager);console.log("new collection",u);for(let l=0;l<this.acquiredImages.get_Count();l++)console.log("add page ",l+1),u.add(this.acquiredImages.getItem(l)),l===this._focusedImageIndex&&(console.log("insert scan"),u.add(i));for(;u.get_Count()-1!==this.acquiredImages.get_Count();)await new Promise((l,g)=>setTimeout(l,100));this.acquiredImages=u,console.log("after acquiredImages ",this.acquiredImages),this.pages.splice(this.currentPage,0,r),this.isImageProcessing=!1}break;case 4:alert(n.get_ErrorMessage());break}}while(o!==0);this.currentPage=1,this.isImageProcessing=!1}},deletePage(){return this.acquiredImages.length===0||this._focusedImageIndex===-1||(this.acquiredImages.removeAt(this._focusedImageIndex),this.pages.splice(this._focusedImageIndex,1),this.acquiredImages.get_Count()===0?this.currentPage=0:this._focusedImageIndex>=this.acquiredImages.get_Count()&&(this._focusedImageIndex=this.acquiredImages.get_Count()-1),this.__updateImagePreview()),!1},eventInsert(){this.eventScan(!0)},eventSave(){if(!this.docInfo.name||this.pages.length===0)return;let e="pdf",t=this.docInfo.name+"."+e,s=this.extPrefix(e),o=this.getSaveImageIds(),n=this.acquiredImages.getAsBase64String(t,o);console.log(n);let i=s+n,r=this.dataURLtoFile(i,t);this.eventClose(),this.$emit("onFinish",r)},getSaveImageIds(){let e=[];if(console.log(this.selectedPdfMode),this.selectedPdfMode==="PDF")e.push(this.acquiredImages.getItem(this._focusedImageIndex).get_Id());else for(let t=0;t<this.acquiredImages.get_Count();t++)e.push(this.acquiredImages.getItem(t).get_Id());return e},printPage(){let e="pdf",t=this.getSaveImageIds(),s=this.extPrefix(e),o=this.docInfo.name+"."+e,n=this.acquiredImages.getAsBase64String(o,t),i=s+n;window.open("").document.write('<embed type="application/pdf" width="100%" height="100%" src="'+i+'">')},downloadFile(){let e=this.getSaveImageIds(),t="pdf",s=this.docInfo.name+"."+t,o=this.acquiredImages.getAsBase64String(s,e),i=this.extPrefix(t)+o,r=this.dataURLtoFile(i,s);const u=new Blob([r]),l=URL.createObjectURL(u),g=document.createElement("a");g.href=l,g.download=s,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(l)},extPrefix(e){switch(e){case"pdf":return"data:application/pdf;base64,";case"png":return"data:image/png;base64,";default:return"data:application/pdf;base64,"}},dataURLtoFile(e,t){let s=e.split(","),o=s[0].match(/:(.*?);/)[1],n=atob(s[s.length-1]),i=n.length,r=new Uint8Array(i);for(;i--;)r[i]=n.charCodeAt(i);return new File([r],t,{type:o})},handleFunction(e){this[e]()},invertPage(){if(this.isImageProcessing||this._focusedImageIndex<0||this._focusedImageIndex>=this.acquiredImages.length)return!1;this.isImageProcessing=!0;try{this.acquiredImages.getItem(this._focusedImageIndex).invert(),this.__updateImagePreview()}catch(e){alert(e)}finally{this.isImageProcessing=!1}return!1},rotatePage(){if(this.isImageProcessing||this._focusedImageIndex<0||this._focusedImageIndex>=this.acquiredImages.length)return!1;this.isImageProcessing=!0;try{this.acquiredImages.getItem(this._focusedImageIndex).rotate(90),this.__updateImagePreview()}catch(e){alert(e)}finally{this.isImageProcessing=!1}return!1},increaseBrightness(){this.__changeImageBrightness(5)},decreaseBrightness(){this.__changeImageBrightness(-5)},increaseContrast(){this.__changeImageContrast(5)},decreaseContrast(){this.__changeImageContrast(-5)},__changeImageBrightness(e){if(this.isImageProcessing||this._focusedImageIndex<0||this._focusedImageIndex>=this.acquiredImages.length)return!1;console.log("brightness started..."),this.isImageProcessing=!0;try{this.acquiredImages.getItem(this._focusedImageIndex).changeBrightness(e),this.__updateImagePreview()}catch(t){alert(t)}finally{console.log("brightness finished."),this.isImageProcessing=!1}return!1},__changeImageContrast(e){if(this.isImageProcessing||this._focusedImageIndex<0||this._focusedImageIndex>=this.acquiredImages.length)return!1;this.isImageProcessing=!0,console.log("contrast started...");try{console.log("contrast 2 acq",this.acquiredImages),console.log("contrast 3 index",this.acquiredImages.get_Count());let t=this.acquiredImages.getItem(this._focusedImageIndex);console.log("contrast 4 focusimage",t),t.changeContrast(e),this.__updateImagePreview()}catch(t){alert(t)}finally{console.log("contrast finished."),this.isImageProcessing=!1}return!1},__updateImagePreview(){if(this._focusedImageIndex!==-1){let t=this.acquiredImages.getItem(this._focusedImageIndex).getAsBase64String(),s=document.getElementById("scanned-page-"+this.currentPage.toString()),o=document.getElementById("scanned-thumbnail-"+this.currentPage.toString());s.src=t,o.src=t}},zoomIn(){this.__changePreviewImageZoom(10)},zoomOut(){this.__changePreviewImageZoom(-10)},__changePreviewImageZoom(e){if(this.acquiredImages.get_Count()===0||this._focusedImageIndex===-1)return!1;let t=document.getElementById("scanned-page-"+this.currentPage.toString()),s=this.acquiredImages.getItem(this._focusedImageIndex),o=s.get_Width(),n=s.get_Height();console.log("before width",o),console.log("before height",n);let i=520,r=743;t.width+=i*e/100,t.height+=r*e/100,console.log("after width",t.width),console.log("after height",t.height)},renderPages(){this.$nextTick(()=>{let e=document.querySelectorAll(".scanmodal-page-list img"),t=document.querySelectorAll(".scanmodal-page-preview > img"),s=1;for(const o of this.pages)e[s-1].src=o,t[s-1].id="scanned-page-"+s.toString(),t[s-1].src=o,s++;this.pages.length>0&&(this.currentPage=1),console.log("rendered.")})},prevPage(){if(this.currentPage>1){let e=this.currentPage-1;this.setCurrentPage(e)}},nextPage(){if(this.currentPage<this.pages.length){let e=this.currentPage+1;this.setCurrentPage(e)}},setCurrentPage(e){this.currentPage=e;let t=document.querySelector(".scanmodal-page-preview"),o=t.querySelectorAll("img")[e-1].offsetTop;t.scrollTop=o}}},T=e=>(ae("data-v-e483df41"),e=e(),ie(),e),Ct={key:0,class:"scanner-loading"},Pt=T(()=>a("div",{class:"effect-1 effects"},null,-1)),St=T(()=>a("div",{class:"effect-2 effects"},null,-1)),kt=T(()=>a("div",{class:"effect-3 effects"},null,-1)),Mt=[Pt,St,kt],Tt={class:"scanmodal-layout flex overflow-x-auto"},Dt={class:"scanmodal-side-menu"},Vt=["title","onClick"],Bt={class:"scanmodal-page-list"},qt={class:"page-thumbnail"},At=["id","src","onClick"],Rt={class:"text-center text-white text-[12px]"},Et={class:"scanmodal-page-preview"},Ot=["id","src"],Ut={class:"scanmodal-page-footer"},Nt={class:"flex justify-center"},Ft={class:"p-current"},Lt={class:"scanmodal-page-setting"},Wt={class:"title-part"},zt={class:"setting-part"},jt=T(()=>a("div",null,"เลือกเครื่องสแกน",-1)),Gt=T(()=>a("div",null,"แสดงเอกสารโหมด",-1)),Jt=T(()=>a("div",null,"ความละเอียด",-1)),Kt=T(()=>a("div",null,"ขนาดไฟล์เอกสาร",-1)),Ht={class:"action-btn"},Zt={class:"title-part"},Yt={class:"setting-part"},Xt=T(()=>a("div",null,"ชื่อเอกสาร",-1)),Qt=T(()=>a("div",null,"ประเภทเอกสาร",-1)),$t={class:"action-btn"};function en(e,t,s,o,n,i){const r=v("Icon"),u=v("vSelect"),l=v("VueSelect"),g=v("Radio"),x=v("Button"),w=v("Textinput"),C=v("Modal");return s.activeModal?(f(),O(C,{key:0,"active-modal":s.activeModal,title:"สแกนเอกสาร","content-class":"pt-0 pb-0 pl-0 pr-0","size-class":"max-w-[1200px]","onEvent:closeModal":i.eventClose},{default:y(()=>[n.isImageProcessing?(f(),I("div",Ct,Mt)):q("",!0),a("div",Tt,[a("div",Dt,[(f(!0),I(V,null,B(n.scannerActionList,(m,_)=>(f(),I("div",{key:_,title:m.title,class:U(["action-menu",{disabled:!n.currentPage}]),onClick:h=>i.handleFunction(m.fnName)},[d(r,{icon:m.icon,class:"text-2xl"},null,8,["icon"])],10,Vt))),128))]),a("div",Bt,[(f(!0),I(V,null,B(n.pages||[],(m,_)=>(f(),I("div",{key:_,class:"flex flex-col gap-1"},[a("div",qt,[a("div",{class:"delete-icon-btn",onClick:t[0]||(t[0]=h=>i.deletePage())},[d(r,{icon:"mdi:remove-bold"})]),a("img",{class:U({"selected-page":n.currentPage===_+1}),id:"scanned-thumbnail-"+(_+1).toString(),src:m,onClick:h=>i.setCurrentPage(_+1)},null,10,At)]),a("div",Rt,k(_+1),1)]))),128))]),a("div",Et,[(f(!0),I(V,null,B(n.pages,(m,_)=>(f(),I("img",{id:"scanned-page-"+(_+1).toString(),src:m,key:_},null,8,Ot))),128))]),a("div",Ut,[a("div",Nt,[a("div",{class:"p-prev",onClick:t[1]||(t[1]=m=>i.prevPage())},[d(r,{icon:"mdi:chevron-left",class:"text-xl"})]),a("div",Ft,k(n.currentPage)+"/"+k(n.pages.length),1),a("div",{class:"p-next",onClick:t[2]||(t[2]=m=>i.nextPage())},[d(r,{icon:"mdi:chevron-right",class:"text-xl"})])])]),a("div",Lt,[a("div",null,[a("div",Wt,[d(r,{icon:"mdi:chevron-down",class:"text-xl"}),N(" ตั้งค่าสแกน ")]),a("div",zt,[a("div",null,[jt,d(l,{classInput:"input_color"},{default:y(()=>[d(u,{class:"input_color border rounded",clearable:!1,options:n.scannerDevices,"model-value":n.selectedScanner,"onUpdate:modelValue":i.changeScannerDevice},null,8,["options","model-value","onUpdate:modelValue"])]),_:1})]),a("div",null,[Gt,(f(!0),I(V,null,B(n.displayMode,(m,_)=>(f(),I("div",{key:_},[d(g,{modelValue:n.selectedDisplayMode,"onUpdate:modelValue":t[3]||(t[3]=h=>n.selectedDisplayMode=h),label:m.name,value:m.value},null,8,["modelValue","label","value"])]))),128))]),a("div",null,[Jt,d(l,{classInput:"input_color"},{default:y(()=>[d(u,{class:"input_color border rounded",clearable:!1,options:n.allDPI,modelValue:n.selectedDPI,"onUpdate:modelValue":t[4]||(t[4]=m=>n.selectedDPI=m)},null,8,["options","modelValue"])]),_:1})]),a("div",null,[Kt,d(l,{classInput:"input_color"},{default:y(()=>[d(u,{class:"input_color border rounded",clearable:!1,options:n.allPaperTypes,modelValue:n.selectedPaperType,"onUpdate:modelValue":t[5]||(t[5]=m=>n.selectedPaperType=m)},null,8,["options","modelValue"])]),_:1})]),a("div",Ht,[d(x,{text:"สแกน","btn-class":"btn-primary w-32",onClick:t[6]||(t[6]=m=>i.eventScan())}),d(x,{"is-disabled":n.pages.length<1,text:"แทรก","btn-class":"btn-outline-dark w-32",onClick:t[7]||(t[7]=m=>i.eventInsert())},null,8,["is-disabled"])])])]),a("div",null,[a("div",Zt,[d(r,{icon:"mdi:chevron-down",class:"text-xl"}),N(" บันทึกเอกสาร ")]),a("div",Yt,[a("div",null,[Xt,d(w,{type:"text",classInput:"border border-gray-400 bg-gray-50",modelValue:n.docInfo.name,"onUpdate:modelValue":t[8]||(t[8]=m=>n.docInfo.name=m)},null,8,["modelValue"])]),a("div",null,[Qt,(f(!0),I(V,null,B(n.pdfModes,(m,_)=>(f(),I("div",{key:_},[d(g,{modelValue:n.selectedPdfMode,"onUpdate:modelValue":t[9]||(t[9]=h=>n.selectedPdfMode=h),label:m.name,value:m.value},null,8,["modelValue","label","value"])]))),128))]),a("div",$t,[d(x,{text:"บันทึก","is-disabled":!n.docInfo.name||n.pages.length<1,"btn-class":"btn-primary w-32",onClick:i.eventSave},null,8,["is-disabled","onClick"]),d(x,{text:"ยกเลิก","btn-class":"btn-outline-dark w-32",onClick:i.eventClose},null,8,["onClick"])])])])])])]),_:1},8,["active-modal","onEvent:closeModal"])):q("",!0)}const _n=G(wt,[["render",en],["__scopeId","data-v-e483df41"]]),pn="/esarabun.github.io/assets/garudaLogo1-b31ec60c.png";export{hn as E,fn as M,_n as S,pn as _,vn as a};
