import{C as z}from"./index-263882d1.js";import{I as j}from"./index-72ee420c.js";import{B as V}from"./index-441935dc.js";import{E as I}from"./index-1c6333b5.js";import{D as N}from"./index-090a8953.js";import{C as Y,B as H,A as q,a as G,b as J,R as K}from"./RouteDetail-b3469ae3.js";import{M as Q}from"./index-7dc8252b.js";import{M as U}from"./index-b0f16bcd.js";import{M as W}from"./index-1b218db3.js";import{A as X}from"./AttachedFileStamp-b7cdd757.js";import{_ as Z,t as w,g as $,a as p,F as ee}from"./index-e058a960.js";import{d as te}from"./dayjs.min-72c81edc.js";import{M as se}from"./index-2a7f4259.js";import{T as ie}from"./ThreeForm-c76850ac.js";import{o as _,m,bj as f,n as l,x as a,aF as r,as as n,p as o,aT as g,w as oe}from"./preload-helper-9e0646ca.js";import"./iconify-4e42c13d.js";import"./dom-891ac6c3.js";import"./focus-management-e6c5d1fd.js";import"./open-closed-486d85f0.js";import"./use-resolve-button-type-38f1f99a.js";import"./use-outside-click-a758fdce.js";import"./index-cc7a2b4b.js";import"./Modal-19eb68c4.js";import"./transition-39b574f4.js";import"./hidden-11a9ab9d.js";import"./micro-task-89dcd6af.js";import"./index-3069c0b6.js";import"./vee-validate.esm-0c282d04.js";import"./array-e684e252.js";import"./TextValid-100be459.js";import"./index-ce9a51c5.js";import"./index-31d1a8ca.js";import"./vue-cleave.min-9e1201c2.js";import"./index-3e810d59.js";import"./tabs-aa384b53.js";import"./VueSelect-4c8519b3.js";import"./index-86a58ede.js";import"./index-8994827d.js";import"./ck-white-7280cd79.js";import"./index-96a9bfa7.js";import"./vue3-tree-vue.esm-b89ac387.js";import"./index-2d8ae848.js";const re={name:"ReceiveView",components:{Card:z,Icon:j,Button:V,Expansion:I,Dropdown:N,CoverSheet:Y,BookDetail:H,AttachedFile:q,BookReference:G,Activity:J,RouteDetail:K,AttachedFileStamp:X,ModalSuccess:Q,ModalError:se,ModalSigned:U,Modal:W,ThreeForm:ie},data(){return{isOpen:!1,pdfPath:"",checkPermission:!1,userList:[],organizeList:[],customList:[],urlSarabun:w,item:null,isSuccess:!1,isError:!1,errorMessage:"",isSigned:!1}},created(){this.fetchData()},computed:{isMobile(){return $().isMobile}},methods:{async pdfHistory(){const{data:s,status:t}=await p("documentStore","PDFHistory",{payload:this.$route.params.id});t==200&&(console.log("data pdf",s.result),this.pdfPath=s.result,this.isOpen=!0)},async handleSigned(){this.isSigned=!0},async signedSubmit(s){s.id=this.$route.params.id;const t=await p("signedStore","store",{payload:s});console.log("data",t),t.status===200?(this.isOrder=!1,setTimeout(()=>{this.isSuccess=!0,ee().clearSignature},10)):(this.isError=!0,this.errorMessage=t.data.message)},refresh(){this.isSuccess=!1,location.reload()},closeModal(){this.isSuccess=!1,this.isSigned=!1,this.isShowModalReturn=!1},async fetchData(){var h,y,e,i,v,d;console.log("fetchData");const{data:s,status:t}=await p("signedStore","showReceive",{payload:this.$route.params.id});if(t===200){this.item=s.result,this.checkPermission=s.result.permission.sign;const c=await p("signedStore","getMaster");c.status==200&&(console.log("res",c),this.organizeList=(y=(h=c.data)==null?void 0:h.message)==null?void 0:y.organization_list,this.userList=(i=(e=c.data)==null?void 0:e.message)==null?void 0:i.user_list,this.customList=(d=(v=c.data)==null?void 0:v.message)==null?void 0:d.custom_groups)}},convertDate(s){return s?te(s).locale("th").add(543,"year").format("DD/MM/YYYY"):"-"},async handleReceiveBook(){console.log("handleReceiveBook");const{data:s,status:t}=await p("documentStore","acceptDocument",{payload:this.$route.params.id});t===200&&(this.isSuccess=!0,this.fetchData())},async submit(s){console.log("payload",s);const{data:t,status:h}=await p("signedStore","senTo",{payload:s});h==200&&this.$router.push("/app/receive-list/receive-book")},onPrinter(){console.log("onPrinter")},downloadFileDocument(s){console.log(s)},downloadFile(s){const t=w+s;window.open(t,"_blank")}}},ne={key:0,class:"flex items-center gap-3"},le=o("div",null,"กลับไปหน้ารายการ",-1),ae={key:1,class:"pt-4"},ce={class:"md:text-2xl text-[16px] font-medium my-6"},me={key:8,class:"pt-4"},ue={class:"h-[250px] flex items-center justify-center"},de={class:"text-center flex flex-row flex-wrap justify-center"},pe={class:"basis-full flex justify-center mb-5"},fe=o("div",null,[o("h4",{class:"text-lg text-slate-900"},[oe(" ลงนามเอกสารอิเล็กทรอนิกส์ "),o("span",{class:"text-green-500"},"สำเร็จ")])],-1),he=o("hr",null,null,-1),ve={class:"flex justify-center mt-4"},_e={class:"text-lg text-slate-900"},ge=["src"];function ye(s,t,h,y,e,i){const v=r("Icon"),d=r("Button"),c=r("Card"),D=r("CoverSheet"),E=r("BookDetail"),B=r("AttachedFileStamp"),F=r("AttachedFile"),L=r("BookReference"),T=r("Activity"),P=r("RouteDetail"),R=r("ThreeForm"),A=r("ModalSigned"),b=r("Modal"),O=r("ModalError");return n(),_("div",null,[e.item?(n(),m(c,{key:0},{default:f(()=>{var u,k,x,S,M,C;return[i.isMobile?l("",!0):(n(),_("div",ne,[o("div",{onClick:t[0]||(t[0]=be=>s.$router.back()),class:"flex items-center text-primary-600 cursor-pointer"},[a(v,{icon:"mdi:chevron-left",class:"text-xl"}),le])])),((u=e.item)==null?void 0:u.status)=="รอลงนาม"&&e.checkPermission?(n(),_("div",ae,[a(c,{bodyClass:"bg-gray-100 h-[95px] flex items-center space-y-10 py-6"},{default:f(()=>[o("div",null,[a(d,{onClick:i.handleSigned,icon:"mdi:certificate",text:"ลงนามเอกสารอิเล็กทรอนิกส์"},null,8,["onClick"])])]),_:1})])):l("",!0),o("div",ce," วันที่ "+g(i.convertDate((k=e.item)==null?void 0:k.document_date))+" "+g((x=e.item)==null?void 0:x.subject)+" พ.ศ. "+g((S=e.item)==null?void 0:S.year),1),i.isMobile?l("",!0):(n(),m(D,{key:2,activeTab:e.checkPermission,item:e.item},null,8,["activeTab","item"])),a(E,{activeTab:e.checkPermission&&i.isMobile,item:e.item},null,8,["activeTab","item"]),a(B,{item:e.item},null,8,["item"]),i.isMobile?l("",!0):(n(),m(F,{key:3,item:e.item},null,8,["item"])),i.isMobile?l("",!0):(n(),m(L,{key:4,item:e.item},null,8,["item"])),i.isMobile?l("",!0):(n(),m(T,{key:5,item:e.item,"onEvent:onClick":i.pdfHistory},null,8,["item","onEvent:onClick"])),i.isMobile?l("",!0):(n(),m(P,{key:6,item:e.item},null,8,["item"])),e.checkPermission?l("",!0):(n(),m(R,{key:7,activeTab:((M=s.$route.query)==null?void 0:M.type)=="signed",organizeList:e.organizeList,userList:e.userList,customList:e.customList,item:e.item,"onEvent:submit":i.submit},null,8,["activeTab","organizeList","userList","customList","item","onEvent:submit"])),((C=e.item)==null?void 0:C.status)=="รอลงนาม"&&e.checkPermission?(n(),_("div",me,[a(c,{bodyClass:"bg-gray-100 h-[95px] flex items-center space-y-10 py-6"},{default:f(()=>[o("div",null,[a(d,{onClick:i.handleSigned,icon:"mdi:certificate",text:"ลงนามเอกสารอิเล็กทรอนิกส์"},null,8,["onClick"])])]),_:1})])):l("",!0)]}),_:1})):l("",!0),a(A,{isOpen:e.isSigned,"onEvent:close":t[1]||(t[1]=u=>e.isSigned=!1),"onEvent:submit":i.signedSubmit},null,8,["isOpen","onEvent:submit"]),e.isSuccess?(n(),m(b,{key:1,title:"",activeModal:e.isSuccess,"onEvent:closeModal":t[4]||(t[4]=u=>e.isSuccess=!1),label:"",labelClass:"btn-outline-dark",sizeClass:"w-full max-w-[700px]",centered:""},{default:f(()=>[o("div",null,[o("div",ue,[o("div",de,[o("div",pe,[a(v,{icon:"icon-park-solid:protect",class:"text-6xl text-green-500"})]),fe])]),he,o("div",ve,[a(d,{text:"ปิด",btnClass:"btn-primary w-32 mx-2",onClick:t[2]||(t[2]=u=>i.refresh())}),a(d,{text:"ไปหน้ารายการ",btnClass:"btn-outline-dark w-32 mx-2",onClick:t[3]||(t[3]=u=>s.$router.push("/app/issue/signed"))})])])]),_:1},8,["activeModal"])):l("",!0),a(O,{title:"",isOpen:e.isError,"onEvent:closeModal":t[5]||(t[5]=u=>e.isError=!1)},{default:f(()=>[o("div",_e,g(e.errorMessage),1)]),_:1},8,["isOpen"]),e.isOpen?(n(),m(b,{key:2,title:"ดูรายละเอียดเอกสาร",labelClass:"btn-outline-dark",sizeClass:"w-3/4",label:"",centered:"",activeModal:e.isOpen,"onEvent:closeModal":t[6]||(t[6]=u=>e.isOpen=!1)},{default:f(()=>[o("div",null,[o("iframe",{class:"w-full h-[1000px] mt-4",src:"data:application/pdf;base64, "+e.pdfPath,frameborder:"0"},null,8,ge)])]),_:1},8,["activeModal"])):l("",!0)])}const ct=Z(re,[["render",ye]]);export{ct as default};
