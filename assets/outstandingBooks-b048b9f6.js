import{C as J}from"./index-263882d1.js";import{I as Z}from"./index-72ee420c.js";import{B as q}from"./index-441935dc.js";import{V as H,C as K}from"./VueSelect-4c8519b3.js";import{D as Q}from"./index-090a8953.js";import{I as X}from"./index-a60d9262.js";import{P as $}from"./index-bb139ada.js";import{_ as ee,a as T,b as te,t as D}from"./index-e058a960.js";import{A as oe}from"./AdvancedSearch-891403e6.js";import{d as ne}from"./dayjs.min-72c81edc.js";import{a as U,b as Y}from"./global-funcs-ef1510cf.js";import{E as I}from"./exceljs.min-46343030.js";import{A as G}from"./AdvancedSearchStatus-9cb2c24d.js";import{o as u,x as m,bj as x,aF as _,as as p,p as c,w as S,aT as f,n as R}from"./preload-helper-9e0646ca.js";import"./iconify-4e42c13d.js";import"./dom-891ac6c3.js";import"./focus-management-e6c5d1fd.js";import"./open-closed-486d85f0.js";import"./use-resolve-button-type-38f1f99a.js";import"./use-outside-click-a758fdce.js";import"./vue-cleave.min-9e1201c2.js";import"./index-7e9b1d19.js";import"./index-8994827d.js";import"./ck-white-7280cd79.js";import"./index-31d1a8ca.js";import"./select-option-b2a02578.js";import"./index-2d8ae848.js";import"./index-e3f12ad9.js";import"./index-6c8c0d73.js";const ae={computed:{},components:{AdvancedSearchStatus:G,AdvancdSearchStatus:G,Pagination:$,InputGroup:X,VueSelect:H,Dropdown:Q,vSelect:K,Button:q,Card:J,Icon:Z,AdvancedSearch:oe},data(){return{isShowModalAS:!1,exportLists:[{id:1,label:"Microsoft Word",icon:"ant-design:file-word-filled"},{id:2,label:"Microsoft Excel",icon:"ant-design:file-excel-filled"},{id:3,label:"PDF",icon:"ant-design:file-pdf-filled"}],filter:{keyword:"",agency:""},activityList:[],columns:[{label:"หนังสือ",field:"book",width:"60px",tdClass:"text_left",thClass:"text_left"},{label:"เลขที่หนังสือ/เรื่อง",field:"document_number",width:"200px",tdClass:"text_left",thClass:"text_left"},{label:"วันที่ลง",field:"document_date",width:"80px",tdClass:"text_left",thClass:"text_left"},{label:"จาก",field:"from_id",width:"150px",tdClass:"text_left",thClass:"text_left"},{label:"ถึง",field:"to_id",width:"150px",tdClass:"text_left",thClass:"text_left"},{label:"สถานะ",field:"status",width:"60px",tdClass:"text_left",thClass:"text_left"},{label:"วันเวลารับ/ผู้รับ",field:"signed",width:"100px",tdClass:"text_left",thClass:"text_left"}],paginate:{total:0,current_page:1,perpage:10,pageRange:5},advancedTable:[],common:[]}},watch:{},async created(){await this.getData(1)},methods:{async onDelete(t){},async onFilter(t){t.document_type=t.document_type?JSON.parse(t.document_type):[],t.book_type=t.book_type?JSON.parse(t.book_type):[],this.getData(1,t)},async getData(t,o=[]){var n,d,l,a,h,g,b,w,y,v,k,s;let r={page:t??1,...this.filter,filter:o};const i=await T("reportFixStore","outstanding",{payload:r}),e=await T("reportDashboardStore","getCommonData");(d=(n=i.data)==null?void 0:n.result)!=null&&d.data&&(this.advancedTable=U(e.data.result.user_list,e.data.result.inside_organization,e.data.result.outside_organization,(a=(l=i.data)==null?void 0:l.result)==null?void 0:a.data),this.activityList=[{id:0,organization_name:"ทั้งหมด",parent_id:null,level:0,enabled:!0,abbreviation:"",organization_code:"",have_sub_organization:!0,display_order:1,created_at:"2023-10-26T08:06:47.054Z",updated_at:"2023-10-26T08:06:47.054Z",deleted_at:null},...e.data.result.dropdown],console.debug(this.activityList),this.common={user_list:e.data.result.user_list,inside_organization:e.data.result.inside_organization,outside_organization:e.data.result.outside_organization},Y(e.data.result.user_list,this.advancedTable,"signed_by"),this.paginate.total=((g=(h=i.data)==null?void 0:h.result)==null?void 0:g.total_page)*((w=(b=i.data)==null?void 0:b.result)==null?void 0:w.per_page),this.paginate.current_page=(v=(y=i.data)==null?void 0:y.result)==null?void 0:v.current_page,this.paginate.perpage=(s=(k=i.data)==null?void 0:k.result)==null?void 0:s.per_page)},convertDate(t,o="DD/MM/YYYY"){return t==null?"-":ne(t).locale("th").add(543,"year").format(o)},convertThaiNo(t){return t=t.replace(/1/g,"๑"),t=t.replace(/2/g,"๒"),t=t.replace(/3/g,"๓"),t=t.replace(/4/g,"๔"),t=t.replace(/5/g,"๕"),t=t.replace(/6/g,"๖"),t=t.replace(/7/g,"๗"),t=t.replace(/8/g,"๘"),t=t.replace(/9/g,"๙"),t=t.replace(/0/g,"๐"),t},async handleExport(t){var d,l;let o={page:1,...this.filter,pageSize:this.paginate.total};const r=await T("reportFixStore","outstanding",{payload:o}),i=U(this.common.user_list,this.common.inside_organization,this.common.outside_organization,(l=(d=r.data)==null?void 0:d.result)==null?void 0:l.data);Y(this.common.user_list,i,"signed_by");const e=i.map(a=>{var h,g,b,w;return{book:a.document_type,document_number:a.document_number+" / "+a.subject,document_date:this.convertThaiNo(this.convertDate(a.document_date)),from_id:((h=a.from_user)==null?void 0:h.organization_name)??((g=a.from_user)==null?void 0:g.name)??"-",to_id:((b=a.to_user)==null?void 0:b.full_name)??"-",status:a.status,signed:this.convertThaiNo(this.convertDate(a.signed_at))+" / "+(((w=a==null?void 0:a.user)==null?void 0:w.full_name)??"")}});let n=["หนังสือ","เลขที่หนังสือ/เรื่อง","วันที่ลง","จาก","ถึง","สถานะ","วันเวลารับ/ผู้รับ"];t.id==1?this.exportToWord(e,null,n):t.id==2?this.exportToExcel(e,null,n):t.id==3&&this.exportToPdf(e,null,n)},async saveToArchive(t){return await window.ApexCharts.getChartByID(t).dataURI()},async sendToServer(t,o,r){try{const i=new FormData;i.append("excelFile",t,"downloaded-file.xlsx"),o&&i.append("base64Image",o);const e=await te.post(D+"/fix/convert-to-"+r,i);r==="pdf"?window.open(`${D}/public/tempFile/${e.data.result.data.fileName}.${r}`,"_blank"):window.open(`${D}/public/tempFile/${e.data.result.data.fileName}.${r}`,"_parent","download")}catch(i){console.error("Error sending file to server:",i)}},async exportToExcel(t,o,r){const i=new I.Workbook,e=i.addWorksheet("Sheet1");if(o){const n=i.addImage({base64:o,extension:"png"});e.addImage(n,{tl:{col:0,row:0},ext:{width:1600,height:380}})}e.getRow(o?20:1).values=r;for(const n of t)e.addRow([n.book,n.document_number,n.document_date,n.from_id,n.to_id,n.status,n.signed]);this.adjustColumnWidth(e),this.setTextCenter(e),i.xlsx.writeBuffer().then(n=>{const d=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),l="exported_data.xlsx",a=document.createElement("a");a.href=URL.createObjectURL(d),a.download=l,document.body.appendChild(a),a.click(),document.body.removeChild(a)})},async exportToWord(t,o,r){const i=new I.Workbook,e=i.addWorksheet("Sheet1");if(o){const l=i.addImage({base64:o,extension:"png"});e.addImage(l,{tl:{col:0,row:0},ext:{width:1600,height:380}})}e.getRow(o?20:1).values=r;for(const l of t)e.addRow([l.book,l.document_number,l.document_date,l.from_id,l.to_id,l.status,l.signed]);this.adjustColumnWidth(e),this.setTextCenter(e);const n=await i.xlsx.writeBuffer(),d=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});await this.sendToServer(d,o,"docx")},async exportToPdf(t,o,r){const i=new I.Workbook,e=i.addWorksheet("Sheet1");if(e.pageSetup={orientation:"landscape"},o){const a=i.addImage({base64:o,extension:"png"});e.addImage(a,{tl:{col:0,row:0},ext:{width:600,height:300}})}e.getRow(o?18:1).values=r;for(const a of t)e.addRow([a.book,a.document_number,a.document_date,a.from_id,a.to_id,a.status,a.signed]);const n=this.adjustColumnWidth(e);this.setTextCenter(e,!0,n);const d=await i.xlsx.writeBuffer(),l=new Blob([d],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});await this.sendToServer(l,o,"pdf")},adjustColumnWidth(t){let o=[];return t.columns.forEach(r=>{const i=r.values.map(n=>n.toString().length),e=Math.max(...i.filter(n=>typeof n=="number"));o.push(e),r.width=e<20?e*.7:20}),Math.max(...o.filter(r=>typeof r=="number"))},setTextCenter(t,o=!1,r=20){const n=t.lastRow.number;for(let d=0;d<=n;d++){const l=t.getRow(d);l.height=r/20*12,l.eachCell({includeEmpty:!0},a=>{o&&(a.font={size:10}),a.alignment={wrapText:!0},a.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}})}}}},se={class:"report-management"},ie={class:"p-6"},le={class:"md:flex justify-between pb-6 md:space-y-0 space-y-3 items-center"},re={class:"flex flex-wrap sm:flex-nowrap gap-3 basis-full"},de={class:"flex basis-2/5"},ce={class:"flex gap-3"},me={class:"flex items-center"},ue=c("span",{class:"px-2"},"Export",-1),pe={class:"flex gap-5 basis-3/5"},_e={class:"basis-full"},fe={class:"basis-full"},he=c("div",{class:"text-center"},[c("div",{class:"text-gray-400"},"ไม่พบข้อมูล")],-1),ge={key:0},be=c("br",null,null,-1),we={key:1},xe={class:"flex space-x-1"},ye={class:"shrink w-[30px]"},ve={key:0},ke={key:1},Ce={key:2},Se={key:2},Te={key:3},De={key:4},Ie=c("br",null,null,-1),Re={key:5},Ee={key:6},Ne={class:"py-4 px-3"};function ze(t,o,r,i,e,n){const d=_("Icon"),l=_("Button"),a=_("Dropdown"),h=_("vSelect"),g=_("VueSelect"),b=_("InputGroup"),w=_("AdvancedSearchStatus"),y=_("Pagination"),v=_("vue-good-table"),k=_("Card");return p(),u("div",se,[m(k,{noborder:"",bodyClass:"p-0"},{default:x(()=>[c("div",ie,[c("div",le,[c("div",re,[c("div",de,[c("div",ce,[m(a,{classMenuItems:"left-0  w-[220px] top-[110%]",items:e.exportLists,onOnClickItem:n.handleExport},{default:x(()=>[m(l,{btnClass:"btn-primary text-slate-50",div:"",iconClass:"text-lg"},{default:x(()=>[c("div",me,[m(d,{icon:"ic:baseline-cloud-download",class:"handle text-[20px]"}),ue])]),_:1})]),_:1},8,["items","onOnClickItem"])])]),c("div",pe,[c("div",_e,[m(g,{classInput:"input_color"},{default:x(()=>[m(h,{modelValue:e.filter.agency,"onUpdate:modelValue":o[0]||(o[0]=s=>e.filter.agency=s),label:"organization_name",class:"input_color border rounded",reduce:s=>s.id,options:e.activityList,"onOption:selected":o[1]||(o[1]=s=>n.getData(1))},null,8,["modelValue","reduce","options"])]),_:1})]),c("div",fe,[m(b,{modelValue:e.filter.keyword,"onUpdate:modelValue":o[2]||(o[2]=s=>e.filter.keyword=s),placeholder:"Search",type:"text",prependIcon:"heroicons-outline:search",merged:"",inputEnter:!0,"onEvent:inputEnter":o[3]||(o[3]=s=>n.getData(1))},null,8,["modelValue"])]),m(l,{icon:"mdi:filter",text:"ค้นหาขั้นสูง",btnClass:"btn-primary rounded-md",onClick:o[4]||(o[4]=s=>e.isShowModalAS=!e.isShowModalAS)})])])])]),m(w,{isOpen:e.isShowModalAS,"dis-init-number":!0,"onEvent:close":o[5]||(o[5]=s=>e.isShowModalAS=!1),"onEvent:submit":n.onFilter},null,8,["isOpen","onEvent:submit"]),m(v,{columns:e.columns,styleClass:" vgt-table bordered lesspadding2",rows:e.advancedTable,"pagination-options":{enabled:!0,perPage:e.paginate.perpage},"sort-options":{enabled:!1}},{emptystate:x(()=>[he]),"table-row":x(s=>{var C,E,N,z,A,B,V,W,j,M,P,F,L,O;return[s.column.field=="document_number"?(p(),u("span",ge,[S(f(((C=s.row)==null?void 0:C.document_number)??"-")+" ",1),be,S(" "+f(((E=s.row)==null?void 0:E.subject)??"-"),1)])):s.column.field=="book"?(p(),u("span",we,[c("div",xe,[c("div",ye,[s.row.document_type=="เอกสารทั่วไป (ส่งฉบับจริง)"?(p(),u("div",ve,[m(d,{icon:"emojione-monotone:letter-p",class:"handle text-[25px] text-yellow-500"})])):R("",!0),s.row.document_type=="เอกสารอิเล็กทรอนิกส์"?(p(),u("div",ke,[m(d,{icon:"emojione-monotone:letter-e",class:"handle text-[25px] text-blue-700"})])):R("",!0),s.row.document_type=="หนังสือรับจากอีเมล"?(p(),u("div",Ce,[m(d,{icon:"mdi:email",class:"handle text-[25px] text-orange-500"})])):R("",!0)])])])):s.column.field=="from_id"?(p(),u("span",Se,f(((z=(N=s.row)==null?void 0:N.from_user)==null?void 0:z.organization_name)??((B=(A=s.row)==null?void 0:A.from_user)==null?void 0:B.name)??"-"),1)):s.column.field=="to_id"?(p(),u("span",Te,f(((W=(V=s.row)==null?void 0:V.to_user)==null?void 0:W.full_name)??"-"),1)):s.column.field=="signed"?(p(),u("span",De,[S(f((j=s.row)!=null&&j.signed_at?n.convertThaiNo(n.convertDate((M=s.row)==null?void 0:M.signed_at)):"-")+" ",1),Ie,S(" "+f(((F=(P=s.row)==null?void 0:P.user)==null?void 0:F.full_name)??"-"),1)])):s.column.field=="document_date"?(p(),u("span",Re,f((L=s.row)!=null&&L.document_date?n.convertThaiNo(n.convertDate((O=s.row)==null?void 0:O.document_date)):"-"),1)):(p(),u("span",Ee,f(s.row[s.column.field]),1))]}),"pagination-bottom":x(s=>[c("div",Ne,[m(y,{total:e.paginate.total,current:e.paginate.current_page,"per-page":e.paginate.perpage,pageRange:e.paginate.pageRange,onPageChanged:o[6]||(o[6]=C=>n.getData(C)),pageChanged:s.pageChanged,perPageChanged:s.perPageChanged,textAfterInput:"ไปที่หน้า",enableSearch:"",enableInput:""},null,8,["total","current","per-page","pageRange","pageChanged","perPageChanged"])])]),_:1},8,["columns","rows","pagination-options"])]),_:1})])}const rt=ee(ae,[["render",ze]]);export{rt as default};
