import{C as R}from"./index-263882d1.js";import{I as j}from"./index-72ee420c.js";import{B as O}from"./index-441935dc.js";import{V as P,C as B}from"./VueSelect-4c8519b3.js";import{M as z}from"./Modal-19eb68c4.js";import{M as N}from"./index-7dc8252b.js";import{R as L}from"./index-3069c0b6.js";import{D as U}from"./index-e3f12ad9.js";import{D as Y}from"./index-090a8953.js";import{M as A}from"./index-ffc068ae.js";import{_ as J,c as X,a as M}from"./index-e058a960.js";import{C as W}from"./index-3f3a6812.js";import q from"./colors-b45e2c1c.js";import{C as H}from"./index-2d8ae848.js";import{C as K}from"./index-multiple-c69d7878.js";import{o as b,x as l,bj as w,aF as p,as as y,p as s,aT as V,m as I,n as C,F as G,aD as Q,w as k}from"./preload-helper-9e0646ca.js";import"./iconify-4e42c13d.js";import"./transition-39b574f4.js";import"./dom-891ac6c3.js";import"./hidden-11a9ab9d.js";import"./focus-management-e6c5d1fd.js";import"./micro-task-89dcd6af.js";import"./open-closed-486d85f0.js";import"./use-outside-click-a758fdce.js";import"./index-1b218db3.js";import"./index-6c8c0d73.js";import"./use-resolve-button-type-38f1f99a.js";import"./index-31d1a8ca.js";import"./vue-cleave.min-9e1201c2.js";const E="/assets/chart-add-933983c7.svg";const Z={components:{CFlatPickrMulti:K,CFlatPickr:H,ConfirmDelete:W,ModalGraph:A,Dropdown:Y,DatePickerRange:U,Radio:L,Icon:j,Button:O,Card:R,VueSelect:P,vSelect:B,Modal:z,ModalSuccess:N},data(){var t;return{adminCheck:(t=X().userInfo)==null?void 0:t.admin_flag,filter:{dateType:"วันที่สร้าง",dateStart:"",dateEnd:"",agency:null},dateMulti:[],items:[],masterData:{},isOpen:!1,item:{},agencyItem:[],isShowModalDelete:!1,modalId:null,errorMessage:""}},watch:{dateMulti:{handler:function(t){typeof t=="object"&&this.onFilter()},deep:!0}},async created(){await this.getData(1)},methods:{goCreate(){this.$router.push({name:"dynamic-report-create",params:{master:this.$router.currentRoute.value.params.master}})},goEdit(t){this.$router.push({name:"dynamic-report-edit",params:{master:this.$router.currentRoute.value.params.master,id:t}})},openModalDelete(t){this.isShowModalDelete=!0,this.modalId=t},async onDelete(t){this.isShowModalDelete=!1,(await M("reportDashboardStore","delete",{payload:t})).status===200&&await this.getData(1)},async onFilter(){var a,n,u,e,o,h,i,c,d,f,_,m;let t={page:1,date_start:null,date_end:null,date_type:this.filter.dateType,agency:null,master:this.$router.currentRoute.value.params.master};if(this.dateMulti.length>0&&(t.date_start=this.dateMulti[0],t.date_end=this.dateMulti[1]),this.filter.agency&&(t.agency=this.filter.agency),this.dateMulti.length>0||t.agency){const g=await M("reportDashboardStore","get",{payload:t});(n=(a=g.data)==null?void 0:a.result)!=null&&n.masterData&&(this.masterData=(e=(u=g.data)==null?void 0:u.result)==null?void 0:e.masterData),(h=(o=g.data)==null?void 0:o.result)!=null&&h.dropdown&&(this.agencyItem=(c=(i=g.data)==null?void 0:i.result)==null?void 0:c.dropdown),(f=(d=g.data)==null?void 0:d.result)!=null&&f.dataGraph&&(this.items=[],(m=(_=g.data)==null?void 0:_.result)==null||m.dataGraph.forEach((D,S)=>{this.items.push(this.generateGraph(D))}))}},openModalGraph(t){this.isOpen=!0,this.item=this.items[t]},async getData(t){var u,e,o,h,i,c,d,f;let a={page:t,date:null,agency:null,master:this.$router.currentRoute.value.params.master};const n=await M("reportDashboardStore","get",{payload:a});(e=(u=n.data)==null?void 0:u.result)!=null&&e.masterData&&(this.masterData=(h=(o=n.data)==null?void 0:o.result)==null?void 0:h.masterData),(c=(i=n.data)==null?void 0:i.result)!=null&&c.dropdown&&(this.agencyItem=n.data.result.dropdown),(f=(d=n.data)==null?void 0:d.result)!=null&&f.dataGraph&&(this.items=[],n.data.result.dataGraph.forEach((_,m)=>{this.items.push(this.generateGraph(_,m))}))},generateGraph(t,a){const n=t.id,u=t.name,e=t.chartType;let o;t.chartType==="donut"?o=t.data:o=[{data:t.data}];const h={chart:{id:"custom_chart_"+a,toolbar:{show:!1}},dataLabels:{enabled:t.showLabel},stroke:{curve:"straight"},labels:t.dataLabel,legend:{itemMargin:{vertical:5},width:200,offsetX:10,offsetY:60,formatter:function(i,c){let d=parseFloat(c.w.globals.series[c.seriesIndex]/c.w.globals.series.reduce((f,_)=>f+_,0)*100).toFixed(2)+"%";return i+" "+d}},yaxis:[{}],plotOptions:{pie:{donut:{labels:{show:!0,name:{show:!1},value:{show:!0,fontSize:"40px",offsetY:15,formatter:function(i){return i}},total:{show:!0,label:"",color:"#373d3f",formatter:function(i){return i.globals.series.reduce((c,d)=>c+d,0)}}}}}},noData:{text:"No data",align:"center",verticalAlign:"middle",offsetX:0,offsetY:0,style:{fontSize:"40px"}}};return e!=="donut"&&(h.markers={size:t.markers?4:0,colors:"#fff",strokeColors:q.primary,strokeWidth:2,shape:"circle",radius:2,hover:{sizeOffset:1}}),{id:n,name:u,series:o,options:h,chartType:e}},clearModal(){this.isShowModalDelete=!1},async downloadSVG(t="custom_chart_0",a){const u=await window.Apex._chartInstances.find(o=>o.id===t).chart.dataURI(),e=document.createElement("a");e.href=u.imgURI,e.download="image."+a,document.body.appendChild(e),e.click(),document.body.removeChild(e)}}},$={class:"report-management"},ee={class:"md:flex justify-between pb-6 md:space-y-0 space-y-3 items-center"},te={class:"basis-5/5"},se={class:"flex flex-row-reverse"},oe={class:"basis-1/5 ml-5"},ae={class:"basis-1/12 ml-5 flex items-center"},re={class:"basis-1/12 ml-5 flex items-center"},le={class:"basis-1/5 ml-5"},ne={class:"main-layout flex flex-wrap justify-between"},ie={class:"w-[49%] flex flex-wrap border-layout mt-5"},ce={class:"w-full pt-2 pl-7 flex"},de={class:"basis-3/12"},me={class:"basis-9/12 flex justify-end pr-7"},pe={class:"border rounded-md flex align-items-center px-2 max-h-10"},ue={class:"w-full"},he=["onClick"],fe=["onClick"],_e=["onClick"],ge=["onClick"],ye={class:"p-2 flex items-center hover:bg-gray-50 cursor-pointer text-red-500"},ve={class:"basis-1/1 px-3 w-full"},xe=s("img",{src:E,alt:"graph-plus",class:"w-50 h-50"},null,-1),be=s("div",{class:"absolute bottom-[35%] text-grey"},"สร้างกราฟ",-1),we=[xe,be],Ce=s("img",{src:E,alt:"graph-plus",class:"w-50 h-50"},null,-1),ke=s("div",{class:"absolute bottom-[35%] text-grey"},"สร้างกราฟ",-1),De=[Ce,ke];function Me(t,a,n,u,e,o){const h=p("Button"),i=p("vSelect"),c=p("VueSelect"),d=p("Radio"),f=p("CFlatPickr"),_=p("DatePickerRange"),m=p("Icon"),g=p("Dropdown"),D=p("apexchart"),S=p("Card"),T=p("modal-graph"),F=p("ConfirmDelete");return y(),b("div",$,[l(S,{noborder:""},{default:w(()=>[s("div",ee,[s("div",null,[s("span",null,V(e.masterData.name??"-"),1)]),s("div",te,[e.adminCheck?(y(),I(h,{key:0,icon:"ic:baseline-plus",text:"สร้างกราฟ",btnClass:"btn-primary rounded-md",onClick:o.goCreate},null,8,["onClick"])):C("",!0)])]),s("div",se,[s("div",oe,[l(c,{classInput:"input_color"},{default:w(()=>[l(i,{modelValue:e.filter.agency,"onUpdate:modelValue":a[0]||(a[0]=r=>e.filter.agency=r),placeholder:"หน่วยงานทั้งหมด",label:"organization_name",class:"input_color border rounded",reduce:r=>r.id,options:e.agencyItem,"onOption:selected":o.onFilter},null,8,["modelValue","reduce","options","onOption:selected"])]),_:1})]),s("div",ae,[l(d,{label:"วันที่ลงในหนังสือ",name:"dateTypeBook",value:"วันที่ลงในหนังสือ",modelValue:e.filter.dateType,"onUpdate:modelValue":a[1]||(a[1]=r=>e.filter.dateType=r)},null,8,["modelValue"])]),s("div",re,[l(d,{label:"วันที่สร้าง",name:"dateTypeCreate",value:"วันที่สร้าง",modelValue:e.filter.dateType,"onUpdate:modelValue":a[2]||(a[2]=r=>e.filter.dateType=r)},null,8,["modelValue"])]),s("div",le,[l(_,null,{default:w(()=>[l(f,{config:{mode:"range"},onOnChange:a[3]||(a[3]=r=>e.dateMulti=r)})]),_:1})])]),s("div",ne,[(y(!0),b(G,null,Q(e.items,(r,x)=>(y(),b(G,{key:x},[s("div",ie,[s("div",ce,[s("div",de,V(r.name),1),s("div",me,[s("div",pe,[l(m,{style:{fontSize:"24px"},class:"text-gray-500 cursor-pointer mr-2 hover:bg-gray-100 rounded-md",onClick:v=>o.openModalGraph(x),icon:"material-symbols:pan-zoom"},null,8,["onClick"]),e.adminCheck?(y(),I(m,{key:0,style:{fontSize:"24px"},class:"text-gray-900 cursor-pointer mr-1 hover:bg-gray-100 rounded-md",onClick:v=>o.goEdit(r.id),icon:"mdi-light:pencil"},null,8,["onClick"])):C("",!0),l(g,{classMenuItems:"right-full w-[220px] top-[110%]"},{menus:w(()=>[s("ul",ue,[s("li",null,[s("div",{class:"p-2 flex items-center hover:bg-gray-50 cursor-pointer",onClick:v=>o.downloadSVG("custom_chart_"+x,"png")},[l(m,{icon:"bxs:file-png",class:"text-xl mr-2 text-blue-500"}),k(" ดาวน์โหลด (.PNG) ")],8,he)]),s("li",null,[s("div",{class:"p-2 flex items-center hover:bg-gray-50 cursor-pointer",onClick:v=>o.downloadSVG("custom_chart_"+x,"jpg")},[l(m,{icon:"bxs:file-jpg",class:"text-xl mr-2 text-blue-500"}),k(" ดาวน์โหลด (.JPG) ")],8,fe)]),s("li",null,[s("div",{class:"p-2 flex items-center hover:bg-gray-50 cursor-pointer",onClick:v=>o.downloadSVG("custom_chart_"+x,"jpeg")},[l(m,{icon:"simple-icons:jpeg",class:"text-xl mr-2 text-blue-500"}),k(" ดาวน์โหลด (.JPEG) ")],8,_e)]),e.adminCheck?(y(),b("li",{key:0,onClick:v=>o.openModalDelete(r.id)},[s("div",ye,[l(m,{icon:"material-symbols:delete",class:"text-xl mr-2"}),k(" ลบ ")])],8,ge)):C("",!0)])]),default:w(()=>[l(m,{icon:"pepicons-pencil:dots-x",class:"text-gray-400 text-4xl"})]),_:2},1024)])])]),s("div",ve,[l(D,{type:r.chartType,height:"360",width:"100%",options:r.options,series:r.series},null,8,["type","options","series"])])]),x+1===e.items.length&&e.adminCheck?(y(),b("div",{key:0,class:"w-[49%] flex pointer border-layout items-center justify-center relative mt-5",onClick:a[4]||(a[4]=(...v)=>o.goCreate&&o.goCreate(...v))},we)):C("",!0)],64))),128)),e.items.length===0?(y(),b("div",{key:0,class:"w-[49%] flex pointer border-layout items-center justify-center relative mt-5",onClick:a[5]||(a[5]=(...r)=>o.goCreate&&o.goCreate(...r))},De)):C("",!0)])]),_:1}),l(T,{"is-open":e.isOpen,title:"",graph:e.item,"onEvent:close":a[6]||(a[6]=r=>e.isOpen=!1)},null,8,["is-open","graph"]),l(F,{title:"ยืนยันการลบข้อมูล",isOpen:e.isShowModalDelete,errorMessage:e.errorMessage,"modal-id":e.modalId,"onEvent:delete":o.onDelete,"onEvent:close":o.clearModal,"onEvent:success":o.clearModal},null,8,["isOpen","errorMessage","modal-id","onEvent:delete","onEvent:close","onEvent:success"])])}const st=J(Z,[["render",Me]]);export{st as default};
