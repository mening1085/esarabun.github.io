import{C as me}from"./index-cb5a08aa.js";import{T as ue}from"./index-3e8503e7.js";import{C as se}from"./index-325a54cb.js";import{P as _e}from"./index-5ddbaceb.js";import{B as fe}from"./index-c2d6eb9c.js";import{M as pe}from"./Modal-b54f1b5f.js";import{I as be}from"./index-aa210895.js";import{_ as xe,a as O,u as ve}from"./index-f91482a0.js";import{aA as i,al as ge,o as y,x as c,bj as g,m as d,n as T,aF as f,as as l,p as t,aT as P,F as ae,aD as te,ac as he,bo as ye,w as D}from"./preload-helper-f37a9bec.js";import{u as Ce,a as le}from"./vee-validate.esm-bf91438b.js";import{c as ke,a as oe}from"./array-6ac4c54d.js";import{I as we}from"./index-8d30ace7.js";import{M as Ve}from"./index-34f621d8.js";import{T as ze}from"./index-b52aeb81.js";import{e as Se}from"./vue3-tree-vue.esm-0dbd4492.js";import{I as Ee}from"./index-2198f2cf.js";import{R as Ie}from"./index-e163c14d.js";import{E as je}from"./index-360221be.js";import{E as Me}from"./index-12ff35eb.js";import{N as Ue}from"./index-f32159fc.js";import"./vue-cleave.min-df5c8cc9.js";import"./ck-white-3501111f.js";import"./index-a56f86b1.js";import"./transition-be7c09bc.js";import"./dom-b10fc197.js";import"./hidden-800255f5.js";import"./focus-management-94a631f4.js";import"./micro-task-89dcd6af.js";import"./open-closed-75edfb8a.js";import"./use-outside-click-156e41c1.js";import"./iconify-2baafea4.js";const Oe={name:"adduser-role",components:{Image:be,Card:me,Textinput:ue,Checkbox:se,Pagination:_e,Button:fe,Modal:pe,Icon:we,ModalOrganize:Ve,Tooltip:ze,tree:Se,InputGroup:Ee,Radio:Ie,Checkbox:se,Expansion:je,ExpansionTableRow:Me,NavigationPath:Ue},setup(){const b=ve(),s=i(!1),C=i(!1),e=i(!1),k=i([]),B=i(null),w=i([{label:"รายละเอียดบทบาท(ส่วนผู้ใช้งาน)"},{label:"หนังสือลับ",thClass:"w-[100px] text-center"},{label:"ภายใน",thClass:"w-[80px] text-center"},{label:"ภายนอก",thClass:"w-[80px] text-center"},{label:"แสดง",thClass:"w-[80px] text-center"},{label:"เพิ่ม",thClass:"w-[80px] text-center"},{label:"แก้ไข",thClass:"w-[80px] text-center"},{label:"ลบ",thClass:"w-[80px] text-center"},{label:"ส่งออก",thClass:"w-[80px] text-center"},{label:"ลงนาม",thClass:"w-[80px] text-center"}]),x=i([]),U=i([{label:"รายละเอียดบทบาท(ส่วนผู้ใช้งาน)"},{label:"แสดง",thClass:"w-[120px] text-center"},{label:"เพิ่ม",thClass:"w-[80px] text-center"},{label:"แก้ไข",thClass:"w-[80px] text-center"},{label:"ส่งออก",thClass:"w-[80px] text-center"}]),V=i([]),z=i(!1),r=i(!1),S=i(!1),E=i(!1),I=i(!1),j=i(!1),p=i([]),a=i([]),F=ke({organization_id:oe().nullable().required("กรุณาระบุว่าอยู่ภายใต้หน่วยงานใด"),role_name:oe().required("กรุณาระบุชื่อบทบาท")}),{handleSubmit:ne}=Ce({validationSchema:F});ge(async()=>{var m,u,_,h,A,L,q,G,H,J,K,Q,W,X,Y,Z,$,ee;if(b.currentRoute.value.params.id){const{data:o,status:R}=await O("roleSettingStore","edit",{payload:b.currentRoute.value.params.id});console.log("data",o.result),R===200&&(((m=o.result)==null?void 0:m.parent_organization_list.length)>0&&(k.value=(u=o.result)==null?void 0:u.parent_organization_list,k.value.forEach(v=>{v.expanded=!0})),x.value=(_=o.result)==null?void 0:_.menu_list_user,V.value=(h=o.result)==null?void 0:h.menu_list_admin,M.value=(A=o.result)==null?void 0:A.data.organization_id,N.value=(L=o.result)==null?void 0:L.data.name,z.value=(q=o.result)==null?void 0:q.data.can_attach_file,r.value=(G=o.result)==null?void 0:G.data.can_scan_file,S.value=(H=o.result)==null?void 0:H.data.can_finish_job,E.value=(J=o.result)==null?void 0:J.data.can_pull_back,I.value=(K=o.result)==null?void 0:K.data.can_return,j.value=(Q=o.result)==null?void 0:Q.data.can_cancel,(W=o.result)==null||W.menu_list_user.forEach(v=>{v.sub_menu&&v.sub_menu.length>0&&v.sub_menu.forEach(n=>{(n==null?void 0:n.sarabun_role_permissions.length)>0?p.value.push({id:n.sarabun_role_permissions[0].id,sub_menu_id:n.sarabun_role_permissions[0].sub_menu_id,secret:n.sarabun_role_permissions[0].secret,inside:n.sarabun_role_permissions[0].inside,outside:n.sarabun_role_permissions[0].outside,index:n.sarabun_role_permissions[0].index,store:n.sarabun_role_permissions[0].store,update:n.sarabun_role_permissions[0].update,destroy:n.sarabun_role_permissions[0].destroy,export:n.sarabun_role_permissions[0].export,sign:n.sarabun_role_permissions[0].sign}):p.value.push({sub_menu_id:n.id,secret:!1,inside:!1,outside:!1,index:!1,store:!1,update:!1,destroy:!1,export:!1,sign:!1})})}))}else{const{data:o,status:R}=await O("roleSettingStore","create");R===200&&(console.log("data",o),((X=o.result)==null?void 0:X.parent_organization_list.length)>0&&(k.value=(Y=o.result)==null?void 0:Y.parent_organization_list),x.value=(Z=o.result)==null?void 0:Z.menu_list_user,V.value=($=o.result)==null?void 0:$.menu_list_admin,(ee=o.result)==null||ee.menu_list_user.forEach(v=>{v.sub_menu&&v.sub_menu.length>0&&v.sub_menu.forEach(n=>{p.value.push({sub_menu_id:n.id,secret:!1,inside:!1,outside:!1,index:!1,store:!1,update:!1,destroy:!1,export:!1,sign:!1})})}))}});const{value:M,errorMessage:ie}=le("organization_id"),{value:N,errorMessage:re}=le("role_name"),de=()=>{M.value="",s.value=!1},ce=ne(async()=>{if(!p.value.some(_=>Object.values(_).includes(!0))){e.value=!0;return}let u={organization_id:+M.value,name:N.value,status:!0,can_attach_file:z.value,can_scan_file:r.value,can_finish_job:S.value,can_pull_back:E.value,can_return:I.value,can_cancel:j.value,sarabun_role_permissions:p.value};console.log("submit",u),b.currentRoute.value.params.id?(await O("roleSettingStore","update",{payload:{id:b.currentRoute.value.params.id,data:u}})).status===200&&(C.value=!0):(await O("roleSettingStore","store",{payload:u})).status===200&&(C.value=!0)});return{isShowDialogOrganize:s,organizeList:k,checkedItem:B,column_user:w,column_admin:U,menu_list_admin:V,menu_list_user:x,organization_id:M,organizetionIdError:ie,role_name:N,roleNameError:re,is_attach_file:z,is_scan_file:r,is_close_job:S,is_pull_back:E,is_return_story:I,is_cancle_book:j,userPayload:p,adminPayload:a,selectOrganize:()=>{s.value=!0},onAcceptSelectOrganize:()=>{s.value=!1},onSelectedItem:m=>{console.log("organization_id",m),m.have_sub_organization&&(M.value=m.id)},onSubmit:ce,onClosemodal:de,onCheckedUser:(m,u,_)=>{console.log("onCheckedUser",m,u,_),p.value.forEach(h=>{h.sub_menu_id===m.id&&(h[u]=_)})},onCheckedAdmin:(m,u,_)=>{console.log("onCheckedAdmin",m,u,_),a.value.forEach(h=>{h.sub_menu_id===m.id&&(h[u]=_)})},isShowDialogSuccess:C,onCloseSuccess:()=>{C.value=!1,b.push("/app/user-role/role-management")},isShowDialogFail:e,onCloseFail:()=>{e.value=!1}}}},Te={class:"flex-1 pb-8"},De={class:"block text-xl text-slate-900 font-medium dark:text-[#eee]"},Fe={class:"bg-gray-100 py-3 px-3 sm:px-0"},Ne={class:"flex flex-wrap"},Re=t("div",{class:"sm:basis-1/3 basis-full pt-2 pr-4 flex sm:justify-end justify-start mb-1 sm:mb-0"},[D(" อยู่ภายใต้หน่วยงาน "),t("span",{class:"text-red-500 pl-1"}," *")],-1),Pe={class:"sm:basis-2/3 basis-full"},Be={class:"flex items-center"},Ae=t("span",null,"เลือกหน่วยงาน",-1),Le={class:"px-2 mt-3 flex"},qe=t("div",{class:"shrink-0"},"หน่วยงานที่เลือก:",-1),Ge={class:"text-left pl-3"},He={key:0,class:"text-danger-500 block text-sm"},Je={class:"py-5 px-3 sm:px-0"},Ke={class:"flex flex-wrap"},Qe=t("div",{class:"sm:basis-1/3 basis-full pt-2 pr-4 flex sm:justify-end justify-start mb-1 sm:mb-0"},[D(" ชื่อบทบาท "),t("span",{class:"text-red-500 pl-1"},"*")],-1),We={class:"sm:basis-1/3 basis-full"},Xe={class:"bg-gray-100 py-5 px-3 sm:px-0"},Ye={class:"flex flex-wrap"},Ze=t("div",{class:"sm:basis-1/3 basis-full pr-4 flex sm:justify-end justify-start mb-1 sm:mb-0"}," การใช้งาน ",-1),$e={class:"sm:basis-1/3 basis-full"},es={class:"mb-2"},ss={class:"mb-2"},as={class:"mb-2"},ts={class:"mb-2"},ls={class:"mb-2"},os={class:"mb-2"},ns={class:"mt-6"},is={class:"table_expand"},rs={class:"text-center mt-10 flex justify-center mb-16"},ds={class:"h-36 flex items-center justify-center"},cs={class:"text-center flex flex-row flex-wrap justify-center"},ms={class:"basis-full flex justify-center mb-5"},us={key:0,class:"text-lg text-slate-900"},_s=t("span",{class:"text-green-500"},"สำเร็จ",-1),fs={key:1,class:"text-lg text-slate-900"},ps=t("span",{class:"text-green-500"},"สำเร็จ",-1),bs={class:"flex justify-center w-full"},xs={class:"h-36 flex items-center justify-center"},vs={class:"text-center flex flex-row flex-wrap justify-center"},gs={class:"basis-full flex justify-center mb-5"},hs=t("h4",{class:"text-lg text-slate-900"}," กรุณากรอกรายละเอียด ",-1),ys={class:"flex justify-center w-full"};function Cs(b,s,C,e,k,B){const w=f("Icon"),x=f("Button"),U=f("NavigationPath"),V=f("Tooltip"),z=f("Textinput"),r=f("Checkbox"),S=f("ExpansionTableRow"),E=f("Expansion"),I=f("Card"),j=f("ModalOrganize"),p=f("Modal");return l(),y("div",null,[c(I,null,{default:g(()=>[t("div",Te,[t("span",De,P(b.$route.params.id?"แบบฟอร์มแก้ไขบทบาทผู้ใช้งาน":"แบบฟอร์มเพิ่มบทบาทผู้ใช้งาน"),1)]),t("form",{onSubmit:s[14]||(s[14]=ye((...a)=>e.onSubmit&&e.onSubmit(...a),["prevent"])),class:"px-0 sm:px-12 text-gray-900"},[t("div",Fe,[t("div",Ne,[Re,t("div",Pe,[c(x,{btnClass:"btn-primary w-32 font-medium mx-2",onOnClick:s[0]||(s[0]=a=>e.selectOrganize())},{default:g(()=>[t("div",Be,[c(w,{icon:"ic:baseline-plus",class:"text-white text-xl mr-2"}),Ae])]),_:1}),t("div",Le,[qe,e.organization_id?(l(),d(V,{key:0,placement:"top",arrow:"",theme:"light"},{base:g(()=>[t("div",Ge,[c(U,{arrayItems:e.organizeList,targetId:e.organization_id,targetName:"organization_name",typePath:"organization"},null,8,["arrayItems","targetId"])])]),default:g(()=>[c(U,{arrayItems:e.organizeList,targetId:e.organization_id,targetName:"organization_name",typePath:"organization"},null,8,["arrayItems","targetId"])]),_:1})):T("",!0)]),e.organizetionIdError?(l(),y("span",He,P(e.organizetionIdError),1)):T("",!0)])])]),t("div",Je,[t("div",Ke,[Qe,t("div",We,[c(z,{classInput:"border border-gray-400 h-[50px]",modelValue:e.role_name,error:e.roleNameError,"onUpdate:modelValue":s[1]||(s[1]=a=>e.role_name=a)},null,8,["modelValue","error"])])])]),t("div",Xe,[t("div",Ye,[Ze,t("div",$e,[t("div",es,[e.is_attach_file?(l(),d(r,{key:0,label:"เลือกไฟล์",activeClass:"bg-primary-500",modelValue:e.is_attach_file,"onUpdate:modelValue":s[2]||(s[2]=a=>e.is_attach_file=a),checked:""},null,8,["modelValue"])):(l(),d(r,{key:1,label:"เลือกไฟล์",activeClass:"bg-primary-500",modelValue:e.is_attach_file,"onUpdate:modelValue":s[3]||(s[3]=a=>e.is_attach_file=a)},null,8,["modelValue"]))]),t("div",ss,[e.is_scan_file?(l(),d(r,{key:0,label:"สแกนไฟล์",activeClass:"bg-primary-500",modelValue:e.is_scan_file,"onUpdate:modelValue":s[4]||(s[4]=a=>e.is_scan_file=a),checked:""},null,8,["modelValue"])):(l(),d(r,{key:1,label:"สแกนไฟล์",activeClass:"bg-primary-500",modelValue:e.is_scan_file,"onUpdate:modelValue":s[5]||(s[5]=a=>e.is_scan_file=a)},null,8,["modelValue"]))]),t("div",as,[e.is_close_job?(l(),d(r,{key:0,label:"ปิดงาน",activeClass:"bg-primary-500",modelValue:e.is_close_job,"onUpdate:modelValue":s[6]||(s[6]=a=>e.is_close_job=a),checked:""},null,8,["modelValue"])):(l(),d(r,{key:1,label:"ปิดงาน",activeClass:"bg-primary-500",modelValue:e.is_close_job,"onUpdate:modelValue":s[7]||(s[7]=a=>e.is_close_job=a)},null,8,["modelValue"]))]),t("div",ts,[e.is_pull_back?(l(),d(r,{key:0,label:"ดึงกลับ",activeClass:"bg-primary-500",modelValue:e.is_pull_back,"onUpdate:modelValue":s[8]||(s[8]=a=>e.is_pull_back=a),checked:""},null,8,["modelValue"])):(l(),d(r,{key:1,label:"ดึงกลับ",activeClass:"bg-primary-500",modelValue:e.is_pull_back,"onUpdate:modelValue":s[9]||(s[9]=a=>e.is_pull_back=a)},null,8,["modelValue"]))]),t("div",ls,[e.is_return_story?(l(),d(r,{key:0,label:"คืนเรื่อง",activeClass:"bg-primary-500",modelValue:e.is_return_story,"onUpdate:modelValue":s[10]||(s[10]=a=>e.is_return_story=a),checked:""},null,8,["modelValue"])):(l(),d(r,{key:1,label:"คืนเรื่อง",activeClass:"bg-primary-500",modelValue:e.is_return_story,"onUpdate:modelValue":s[11]||(s[11]=a=>e.is_return_story=a)},null,8,["modelValue"]))]),t("div",os,[e.is_cancle_book?(l(),d(r,{key:0,label:"ยกเลิกหนังสือ",activeClass:"bg-primary-500",modelValue:e.is_cancle_book,"onUpdate:modelValue":s[12]||(s[12]=a=>e.is_cancle_book=a),checked:""},null,8,["modelValue"])):(l(),d(r,{key:1,label:"ยกเลิกหนังสือ",activeClass:"bg-primary-500",modelValue:e.is_cancle_book,"onUpdate:modelValue":s[13]||(s[13]=a=>e.is_cancle_book=a)},null,8,["modelValue"]))])])])]),t("div",ns,[c(E,{activeItem:!0,parentClass:"space-y-5",title:"รายละเอียดบทบาท (ส่วนผู้ใช้งาน)"},{default:g(()=>[t("div",is,[t("table",null,[t("tr",null,[(l(!0),y(ae,null,te(e.column_user,(a,F)=>(l(),y("th",{key:F,class:he(a.thClass)},P(a.label),3))),128))]),(l(!0),y(ae,null,te(e.menu_list_user,a=>(l(),d(S,{key:a.id,showColumns:["secret","inside","outside","index","store","update","destroy","export","sign"],item:a,onChecked:e.onCheckedUser},null,8,["item","onChecked"]))),128))])])]),_:1})]),t("div",rs,[c(x,{type:"submit",text:b.$route.params.id?"บันทึกการแก้ไข":"บันทึก",btnClass:"btn-primary w-32 font-medium mx-2"},null,8,["text"]),c(x,{text:"ยกเลิก",btnClass:"btn-outline-dark w-32 mx-2",link:"/app/user-role/role-management"})])],32)]),_:1}),c(j,{isShowDialogOrganize:e.isShowDialogOrganize,items:e.organizeList,value:e.organization_id,"onEvent:closeModal":s[15]||(s[15]=a=>e.onClosemodal()),"onEvent:acceptSelectOrganize":s[16]||(s[16]=a=>e.onAcceptSelectOrganize()),"onEvent:onSelectedItem":s[17]||(s[17]=a=>e.onSelectedItem(a))},null,8,["isShowDialogOrganize","items","value"]),e.isShowDialogSuccess?(l(),d(p,{key:0,title:"บันทึกบทบาทสำเร็จ",label:"",labelClass:"btn-outline-dark",ref:"modalDialog",centered:"",activeModal:e.isShowDialogSuccess,"onEvent:closeModal":s[19]||(s[19]=a=>e.onCloseSuccess())},{footer:g(()=>[t("div",bs,[c(x,{text:"ปิด",btnClass:"btn-primary w-36",onClick:s[18]||(s[18]=a=>e.onCloseSuccess())})])]),default:g(()=>[t("div",ds,[t("div",cs,[t("div",ms,[c(w,{icon:"icon-park-solid:protect",class:"text-5xl text-green-500"})]),b.$route.params.id?(l(),y("h4",us,[D(" บันทึกการแก้ไขบทบาท "),_s])):(l(),y("h4",fs,[D(" บันทึกบทบาท "),ps]))])])]),_:1},8,["activeModal"])):T("",!0),e.isShowDialogFail?(l(),d(p,{key:1,title:"",label:"",labelClass:"btn-outline-dark",ref:"modalDialog",centered:"",activeModal:e.isShowDialogFail,"onEvent:closeModal":s[21]||(s[21]=a=>e.onCloseFail())},{footer:g(()=>[t("div",ys,[c(x,{text:"ปิด",btnClass:"btn-primary w-36",onClick:s[20]||(s[20]=a=>e.onCloseFail())})])]),default:g(()=>[t("div",xs,[t("div",vs,[t("div",gs,[c(w,{icon:"bxs:error",class:"text-5xl text-red-500"})]),hs])])]),_:1},8,["activeModal"])):T("",!0)])}const ia=xe(Oe,[["render",Cs]]);export{ia as default};
