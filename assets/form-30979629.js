import{C as ve}from"./index-cb5a08aa.js";import{B as me}from"./index-c2d6eb9c.js";import{T as be}from"./index-78f015fc.js";import{T as xe}from"./index-3e8503e7.js";import{R as pe}from"./index-e163c14d.js";import{V as fe,C as he}from"./VueSelect-403231fd.js";import{I as ye}from"./index-8d30ace7.js";import{aA as _,k as ge,al as ke,be as le,o as b,x as a,bj as V,m as Ve,n as U,aF as d,as as m,p as e,ac as we,F as ie,aD as ne,bo as Te,aT as y}from"./preload-helper-f37a9bec.js";import{_ as Se,a as A,c as Ce,u as De}from"./index-f91482a0.js";import{u as Ie,a as w}from"./vee-validate.esm-bf91438b.js";import{T as ze}from"./TextValid-d1c607fc.js";import{M as Me}from"./index-b704274e.js";import{d as de}from"./dayjs.min-472eb357.js";import{c as Ae,a as E,d as Ee}from"./array-6ac4c54d.js";import{C as Ne}from"./index-8ecfca6d.js";import"./vue-cleave.min-df5c8cc9.js";import"./iconify-2baafea4.js";import"./transition-be7c09bc.js";import"./dom-b10fc197.js";import"./hidden-800255f5.js";import"./focus-management-94a631f4.js";import"./micro-task-89dcd6af.js";import"./open-closed-75edfb8a.js";import"./use-outside-click-156e41c1.js";const Be={components:{CFlatPickr:Ne,Card:ve,Button:me,Textarea:be,Textinput:xe,Radio:pe,VueSelect:fe,vSelect:he,Icon:ye,TextValid:ze,Modal:Me},setup(){const T=_([]),o=_(!1),S=ge(()=>Ce().userInfo),t=_(""),C=_(""),x=De(),p=_([]),v=_([]),f=_([]),g=_(""),N=_([{id:"inside",label:"หนังสือภายใน"},{id:"outside",label:"หนังสือส่งภายนอก"}]),D=_([{id:1,label:"ปกติ"},{id:2,label:"ลับ"}]),I=Ae({organizeID:E().nullable().required("กรุณาเลือกหน่วยงาน"),reserve_date:E().nullable().required("กรุณากรอกวันที่"),amount_reserve:Ee().typeError("กรุณากรอกแต่ตัวเลข").nullable().required("กรุณากรอกจำนวนที่การจอง"),secret:E().nullable().required("กรุณาเลือกชั้นความลับ"),bookType:E().nullable().required("กรุณาเลือกประเภทหนังสือ")}),{handleSubmit:B}=Ie({validationSchema:I}),{value:c,errorMessage:R}=w("organizeID"),{value:k,errorMessage:F}=w("reserve_date"),{value:s,errorMessage:u}=w("bookType"),{value:i,errorMessage:z}=w("secret"),{value:h,errorMessage:M}=w("amount_reserve");ke(async()=>{var r,n,j,q,P,O,G,H,J,K,Q,W,X,Z,$,ee,te,se,oe,ae,re;if(x.currentRoute.value.params.id){const{data:l,status:L}=await A("reserveNumberStore","edit",{payload:x.currentRoute.value.params.id});L==200&&(console.log((q=l.result)==null?void 0:q.data),f.value=(P=l.result)==null?void 0:P.running_number_list,p.value=(O=l.result)==null?void 0:O.organization_list,c.value=(H=(G=l.result)==null?void 0:G.data)==null?void 0:H.organization_id,v.value=(J=l.result)==null?void 0:J.user_list,g.value=(Q=(K=l.result)==null?void 0:K.data)==null?void 0:Q.reserved_by,s.value=(X=(W=l.result)==null?void 0:W.data)==null?void 0:X.book_type,i.value=($=(Z=l.result)==null?void 0:Z.data)==null?void 0:$.secrecy_level,C.value=(te=(ee=l.result)==null?void 0:ee.data)==null?void 0:te.note,h.value=(oe=(se=l.result)==null?void 0:se.data)==null?void 0:oe.initial_number,k.value=de((re=(ae=l.result)==null?void 0:ae.data)==null?void 0:re.reserve_date).format("YYYY-MM-DD"))}else{const{data:l,status:L}=await A("reserveNumberStore","create");L==200&&(p.value=(r=l.result)==null?void 0:r.organization_list,c.value=S.value.organization_id,v.value=(n=l.result)==null?void 0:n.user_list,g.value=S.value.id,f.value=(j=l.result)==null?void 0:j.running_number_list)}}),le(s,(r,n)=>{Y()}),le(i,(r,n)=>{Y()});const Y=()=>{if(c.value&&i.value&&s.value){const r=f.value.find(n=>{if(c.value==n.organization_id&&i.value==n.secrecy_level&&s.value==n.book_type)return n});console.log(r),r?t.value=r.current_number:t.value="0"}},ce=()=>{o.value=!1},ue=r=>r?de(r).locale("th").add(543,"year").format("DD/MM/YYYY"):"-",_e=B(async()=>{let r={organization_id:c.value,reserve_date:k.value,book_type:s.value,secrecy_level:i.value,initial_number:Number(h.value),note:C.value};if(console.log("payload",r),x.currentRoute.value.params.id)r.id=x.currentRoute.value.params.id,(await A("reserveNumberStore","update",{payload:r})).status===200?x.push("/app/central/reserve-book-number"):alert("error");else{const n=await A("reserveNumberStore","store",{payload:r});n.status===200?(T.value=n.data.result[0],console.log("detailArray.value",T.value),o.value=!0):alert("error")}});return{bookType:s,bookTypeError:u,secret:i,secretError:z,bookTypeList:N,secretList:D,orgList:p,userInfo:S,organizeID:c,organizeIDError:R,reserve_date:k,reserve_dateError:F,userList:v,userID:g,note:C,amount_reserve:h,amount_reserveError:M,current_number:t,onSubmit:_e,isShowDialog:o,detailArray:T,onAccept:ce,formatDate:ue,convertArrayToString:r=>r.join(", ")}}},Re={class:"list list-odd"},Fe={class:"flex space-x-3 items-center h-20"},Le=e("div",{class:"basis-1/3 text-end"},"หน่วยงาน",-1),Ue={class:"basis-2/3 text-start"},Ye={class:"basis-full"},je={class:"flex space-x-3 items-center h-20"},qe=e("div",{class:"basis-1/3 text-end"},"วันที่จอง",-1),Pe={class:"basis-2/3 text-start"},Oe={class:"basis-full"},Ge={class:"shrink w-[20px]"},He={class:"flex space-x-3 items-center h-20"},Je=e("div",{class:"basis-1/3 text-end"},"ประเภทหนังสือ",-1),Ke={class:"basis-2/3 text-start flex space-x-7"},Qe={key:0,class:"basis-full"},We={class:"flex space-x-3 items-center h-20"},Xe=e("div",{class:"basis-1/3 text-end"},"ลำดับชั้นความลับ",-1),Ze={class:"basis-2/3 text-start flex space-x-20"},$e={key:0,class:"basis-full"},et={class:"flex space-x-3 items-center h-20"},tt=e("div",{class:"basis-1/3 text-end"},"เลขที่ส่งล่าสุด",-1),st={class:"basis-2/3 text-start"},ot={class:"flex space-x-3 items-center h-20"},at=e("div",{class:"basis-1/3 text-end"},"จำนวนที่ต้องการจอง",-1),rt={class:"basis-2/3 text-start"},lt={class:"flex space-x-3 items-center h-20"},it=e("div",{class:"basis-1/3 text-end"},"ชื่อผู้จอง",-1),nt={class:"basis-2/3 text-start"},dt={class:"flex space-x-3 mt-7"},ct=e("div",{class:"basis-1/3 text-end"},"หมายเหตุ",-1),ut={class:"basis-2/3 text-start"},_t={class:"flex justify-center border-t mt-8"},vt={class:"flex"},mt={class:"pt-5"},bt={class:"pt-5"},xt={class:"list list-odd"},pt={class:"flex space-x-3 items-center h-14"},ft=e("div",{class:"basis-1/3 text-end text-bold"},"หน่วยงาน",-1),ht={class:"basis-2/3 text-strat"},yt={class:"flex space-x-3 items-center h-14"},gt=e("div",{class:"basis-1/3 text-end text-bold"},"วันที่จอง",-1),kt={class:"basis-2/3 text-strat"},Vt={class:"flex space-x-3 items-center h-14"},wt=e("div",{class:"basis-1/3 text-end text-bold"},"ลำดับชั้นความลับ",-1),Tt={class:"basis-2/3 text-strat"},St={class:"flex space-x-3 items-center h-14"},Ct=e("div",{class:"basis-1/3 text-end text-bold"},"ชื่อผู้จอง",-1),Dt={class:"basis-2/3 text-strat"},It={class:"flex space-x-3 items-center h-14"},zt=e("div",{class:"basis-1/3 text-end text-bold"},"หมายเหตุ",-1),Mt={class:"basis-2/3 text-strat"},At={class:"flex space-x-3 items-center h-14"},Et=e("div",{class:"basis-1/3 text-end text-bold"},"เลขรับที่ได้",-1),Nt={class:"basis-2/3 text-strat"},Bt={class:"flex justify-center border-t"},Rt={class:"pt-5"};function Ft(T,o,S,t,C,x){const p=d("vSelect"),v=d("TextValid"),f=d("VueSelect"),g=d("CFlatPickr"),N=d("Icon"),D=d("Radio"),I=d("Textinput"),B=d("Textarea"),c=d("Button"),R=d("Card"),k=d("router-link"),F=d("Modal");return m(),b("div",null,[a(R,{title:"แบบฟอร์มจองเลขที่หนังสือ",className:"border-secondary-500  border-1",bodyClass:"p-5",noborder:""},{default:V(()=>[e("form",{onSubmit:o[9]||(o[9]=Te((...s)=>t.onSubmit&&t.onSubmit(...s),["prevent"])),class:"px-0 sm:px-12"},[e("div",Re,[e("div",Fe,[Le,e("div",Ue,[a(f,{classInput:"input_color"},{default:V(()=>[a(p,{disabled:"",modelValue:t.organizeID,"onUpdate:modelValue":o[0]||(o[0]=s=>t.organizeID=s),label:"organization_name",class:"input_color border rounded bg-gray w-[65%]",reduce:s=>s.id,options:t.orgList},null,8,["modelValue","reduce","options"]),e("div",Ye,[a(v,{valid:t.organizeIDError},null,8,["valid"])])]),_:1})])]),e("div",je,[qe,e("div",Pe,[e("div",{class:we(["flex items-center border bg-gray-50 rounded-md pr-2 w-[65%]",t.reserve_dateError?"border-red-500":"border-gray-400"])},[e("div",Oe,[a(g,{modelValue:t.reserve_date,"onUpdate:modelValue":o[1]||(o[1]=s=>t.reserve_date=s),onOnChange:o[2]||(o[2]=s=>t.reserve_date=s),class:"form-control border-0 focus:ring-0"},null,8,["modelValue"])]),e("div",Ge,[a(N,{class:"text-2xl",icon:"ant-design:calendar-outlined"})])],2),a(v,{valid:t.reserve_dateError},null,8,["valid"])])]),e("div",He,[Je,e("div",Ke,[(m(!0),b(ie,null,ne(t.bookTypeList,(s,u)=>(m(),b("div",{key:u},[a(D,{label:s.label,modelValue:t.bookType,"onUpdate:modelValue":o[3]||(o[3]=i=>t.bookType=i),value:s.id},null,8,["label","modelValue","value"]),u==0?(m(),b("div",Qe,[a(v,{valid:t.bookTypeError},null,8,["valid"])])):U("",!0)]))),128))])]),e("div",We,[Xe,e("div",Ze,[(m(!0),b(ie,null,ne(t.secretList,(s,u)=>(m(),b("div",{key:u},[a(D,{label:s.label,modelValue:t.secret,"onUpdate:modelValue":o[4]||(o[4]=i=>t.secret=i),value:s.label},null,8,["label","modelValue","value"]),u==0?(m(),b("div",$e,[a(v,{valid:t.secretError},null,8,["valid"])])):U("",!0)]))),128))])]),e("div",et,[tt,e("div",st,[a(I,{type:"text",classInput:"border border-gray-300 bg-white w-[65%]",placeholder:"",modelValue:t.current_number,"onUpdate:modelValue":o[5]||(o[5]=s=>t.current_number=s),isReadonly:""},null,8,["modelValue"])])]),e("div",ot,[at,e("div",rt,[a(I,{type:"text",classInput:"border border-gray-300 bg-white w-[65%]",placeholder:"",modelValue:t.amount_reserve,"onUpdate:modelValue":o[6]||(o[6]=s=>t.amount_reserve=s),error:t.amount_reserveError},null,8,["modelValue","error"])])]),e("div",lt,[it,e("div",nt,[a(f,{classInput:"input_color"},{default:V(()=>[a(p,{label:"full_name",class:"input_color border rounded bg-gray w-[65%]",reduce:s=>s.id,options:t.userList,modelValue:t.userID,"onUpdate:modelValue":o[7]||(o[7]=s=>t.userID=s),disabled:""},null,8,["reduce","options","modelValue"])]),_:1})])]),e("div",dt,[ct,e("div",ut,[e("div",null,[a(B,{placeholder:"",rows:7,modelValue:t.note,"onUpdate:modelValue":o[8]||(o[8]=s=>t.note=s),classInput:"border border-gray-400 text_area_bg w-[65%]"},null,8,["modelValue"])])])])]),e("div",_t,[e("div",vt,[e("div",mt,[a(c,{type:"submit",btnClass:"bg-blue-600  text-white border w-32 mx-2",text:"บันทึก"})]),e("div",bt,[a(c,{btnClass:"btn-outline-dark w-32 mx-2",text:"ยกเลิก",link:"/app/central/reserve-book-number"})])])])],32)]),_:1}),t.isShowDialog?(m(),Ve(F,{key:0,sizeClass:"w-full max-w-[700px]",title:"ข้อมูลการจองเลขที่หนังสือ",label:"",labelClass:"btn-outline-dark",centered:"",activeModal:t.isShowDialog,"onEvent:closeModal":o[10]||(o[10]=s=>t.onAccept())},{default:V(()=>{var s,u,i,z,h,M;return[e("div",xt,[e("div",pt,[ft,e("div",ht,y((u=(s=t.detailArray)==null?void 0:s.organization_data)==null?void 0:u.organization_name),1)]),e("div",yt,[gt,e("div",kt,y(t.formatDate(t.detailArray.reserve_date)),1)]),e("div",Vt,[wt,e("div",Tt,y(t.detailArray.secrecy_level),1)]),e("div",St,[Ct,e("div",Dt,y((z=(i=t.detailArray)==null?void 0:i.user_data)==null?void 0:z.full_name),1)]),e("div",It,[zt,e("div",Mt,y(t.detailArray.note?t.detailArray.note:""),1)]),e("div",At,[Et,e("div",Nt,y(((h=t.detailArray)==null?void 0:h.initial_number.length)>0?t.convertArrayToString((M=t.detailArray)==null?void 0:M.initial_number):""),1)])]),e("div",Bt,[e("div",Rt,[a(k,{to:"/app/central/reserve-book-number"},{default:V(()=>[a(c,{text:"กลับไปหน้ารายการ"})]),_:1})])])]}),_:1},8,["activeModal"])):U("",!0)])}const ds=Se(Be,[["render",Ft]]);export{ds as default};
