import{C as L}from"./index-cb5a08aa.js";import{I as O}from"./index-8d30ace7.js";import{B as V}from"./index-c2d6eb9c.js";import{V as U,C as Y}from"./VueSelect-403231fd.js";import{D as G}from"./index-976a2577.js";import{I as J}from"./index-2198f2cf.js";import{P as q}from"./index-5ddbaceb.js";import{_ as H,a as S,b as K,t as T}from"./index-f91482a0.js";import{A as Q}from"./AdvancedSearch-88f89aed.js";import{d as F,a as X}from"./global-funcs-ef1510cf.js";import{d as Z}from"./dayjs.min-472eb357.js";import{E as I}from"./exceljs.min-7d2227ea.js";import{A as $}from"./AdvancedSearchStatus-6a253dc1.js";import{o as f,x as p,bj as v,aF as _,as as h,p as c,aT as m,w as k}from"./preload-helper-f37a9bec.js";import"./iconify-2baafea4.js";import"./dom-b10fc197.js";import"./focus-management-94a631f4.js";import"./open-closed-75edfb8a.js";import"./use-resolve-button-type-d7bee841.js";import"./use-outside-click-156e41c1.js";import"./vue-cleave.min-df5c8cc9.js";import"./index-a56f86b1.js";import"./index-325a54cb.js";import"./ck-white-3501111f.js";import"./index-3e8503e7.js";import"./select-option-b2a02578.js";import"./index-8ecfca6d.js";import"./index-43a31f90.js";import"./index-f2da45ff.js";const ee={computed:{},components:{AdvancedSearchStatus:$,Pagination:q,InputGroup:J,VueSelect:U,Dropdown:G,vSelect:Y,Button:V,Card:L,Icon:O,AdvancedSearch:Q},data(){return{isShowModalAS:!1,exportLists:[{id:1,label:"Microsoft Word",icon:"ant-design:file-word-filled"},{id:2,label:"Microsoft Excel",icon:"ant-design:file-excel-filled"},{id:3,label:"PDF",icon:"ant-design:file-pdf-filled"}],filter:{keyword:""},activityList:[],columns:[{label:"เลขรับ/ส่ง",field:"id",width:"60px",tdClass:"text_left",thClass:"text_left"},{label:"เลขที่หนังสือ/เรื่อง",field:"document_number",width:"200px",tdClass:"text_left",thClass:"text_left"},{label:"จาก",field:"from_id",width:"150px",tdClass:"text_left",thClass:"text_left"},{label:"ถึง",field:"to_id",width:"150px",tdClass:"text_left",thClass:"text_left"},{label:"สถานะ",field:"status",width:"60px",tdClass:"text_left",thClass:"text_left"},{label:"สาเหตุคืนเรื่อง/ผู้คืน",field:"return",width:"100px",tdClass:"text_left",thClass:"text_left"}],paginate:{total:50,current_page:1,perpage:10,pageRange:5},advancedTable:[],common:[]}},watch:{},async created(){await this.getData(1)},methods:{findUser:F,displayInitialNumber(e){let o="";return e&&(e.doc_pickup_type==="หนังสือรับ"?(o+=this.convertThaiNo(e.initial_number_from??"-"),o+=" / "+(e.parent_document?this.convertThaiNo(e.parent_document.initial_number_from):"-")):o+="- / "+this.convertThaiNo(e.initial_number_from)),o},onFilter(e){e.document_type=e.document_type?JSON.parse(e.document_type):[],e.book_type=e.book_type?JSON.parse(e.book_type):[],this.getData(1,e)},async getData(e,o=[]){var a,d,i,n,u,g,b,w,x,r,y,C;let l={page:e,...this.filter,filter:o};const s=await S("reportFixStore","returnReport",{payload:l}),t=await S("reportDashboardStore","getCommonData");(d=(a=s==null?void 0:s.data)==null?void 0:a.result)!=null&&d.data&&(this.advancedTable=X(t.data.result.user_list,t.data.result.inside_organization,t.data.result.outside_organization,(n=(i=s.data)==null?void 0:i.result)==null?void 0:n.data),this.common={user_list:t.data.result.user_list,inside_organization:t.data.result.inside_organization,outside_organization:t.data.result.outside_organization},this.paginate.total=((g=(u=s.data)==null?void 0:u.result)==null?void 0:g.total_page)*((w=(b=s.data)==null?void 0:b.result)==null?void 0:w.per_page),this.paginate.current_page=(r=(x=s.data)==null?void 0:x.result)==null?void 0:r.current_page,this.paginate.perpage=(C=(y=s.data)==null?void 0:y.result)==null?void 0:C.per_page)},async handleExport(e){var d,i;let o={page:1,payload:this.filter,pageSize:this.paginate.total};const t=((i=(d=(await S("reportFixStore","returnReport",{payload:o})).data)==null?void 0:d.result)==null?void 0:i.data).map(n=>{var g,b,w,x;const u=F(this.common.user_list,n==null?void 0:n.return_history[0].user_id);return{initial_number_from:this.convertThaiNo(n==null?void 0:n.initial_number_from)+"/"+this.convertThaiNo((g=n==null?void 0:n.parent_document)==null?void 0:g.initial_number_from),document_number:this.convertThaiNo(n.document_number)+" / "+n.subject,from_id:((b=n.from_user)==null?void 0:b.organization_name)??((w=n.from_user)==null?void 0:w.name)??"-",to_id:((x=n.to_user)==null?void 0:x.full_name)??"-",status:n.status,return:(n==null?void 0:n.return_history[0].returned_reason)+" คืนเรื่องโดย : "+(u==null?void 0:u.full_name)}});let a=["เลขรับ/ส่ง","เลขที่หนังสือ/เรื่อง","จาก","ถึง","สถานะ","สาเหตุคืนเรื่อง/ผู้คืน"];e.id==1?this.exportToWord(t,null,a):e.id==2?this.exportToExcel(t,null,a):e.id==3&&this.exportToPdf(t,null,a)},async saveToArchive(e){return await window.ApexCharts.getChartByID(e).dataURI()},async sendToServer(e,o,l){try{const s=new FormData;s.append("excelFile",e,"downloaded-file.xlsx"),o&&s.append("base64Image",o);const t=await K.post(T+"/fix/convert-to-"+l,s);l==="pdf"?window.open(`${T}/public/tempFile/${t.data.result.data.fileName}.${l}`,"_blank"):window.open(`${T}/public/tempFile/${t.data.result.data.fileName}.${l}`,"_parent","download")}catch(s){console.error("Error sending file to server:",s)}},async exportToExcel(e,o,l){const s=new I.Workbook,t=s.addWorksheet("Sheet1");if(o){const a=s.addImage({base64:o,extension:"png"});t.addImage(a,{tl:{col:0,row:0},ext:{width:1600,height:380}})}t.getRow(o?20:1).values=l;for(const a of e)t.addRow([a.initial_number_from,a.document_number,a.from_id,a.to_id,a.status,a.return]);this.adjustColumnWidth(t),this.setTextCenter(t),s.xlsx.writeBuffer().then(a=>{const d=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),i="exported_data.xlsx",n=document.createElement("a");n.href=URL.createObjectURL(d),n.download=i,document.body.appendChild(n),n.click(),document.body.removeChild(n)})},async exportToWord(e,o,l){const s=new I.Workbook,t=s.addWorksheet("Sheet1");if(o){const i=s.addImage({base64:o,extension:"png"});t.addImage(i,{tl:{col:0,row:0},ext:{width:1600,height:380}})}t.getRow(o?20:1).values=l;for(const i of e)t.addRow([i.initial_number_from,i.document_number,i.from_id,i.to_id,i.status,i.return]);this.adjustColumnWidth(t),this.setTextCenter(t);const a=await s.xlsx.writeBuffer(),d=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});await this.sendToServer(d,o,"docx")},async exportToPdf(e,o,l){const s=new I.Workbook,t=s.addWorksheet("Sheet1");if(t.pageSetup={orientation:"landscape"},o){const n=s.addImage({base64:o,extension:"png"});t.addImage(n,{tl:{col:0,row:0},ext:{width:600,height:300}})}t.getRow(o?18:1).values=l;for(const n of e)t.addRow([n.initial_number_from,n.document_number,n.from_id,n.to_id,n.status,n.return]);const a=this.adjustColumnWidth(t);this.setTextCenter(t,!0,a);const d=await s.xlsx.writeBuffer(),i=new Blob([d],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});await this.sendToServer(i,o,"pdf")},adjustColumnWidth(e){let o=[];return e.columns.forEach(l=>{const s=l.values.map(a=>a.toString().length),t=Math.max(...s.filter(a=>typeof a=="number"));o.push(t),l.width=t<20?t*.7:20}),Math.max(...o.filter(l=>typeof l=="number"))},setTextCenter(e,o=!1,l=20){const a=e.lastRow.number;for(let d=0;d<=a;d++){const i=e.getRow(d);i.height=l/20*12,i.eachCell({includeEmpty:!0},n=>{o&&(n.font={size:10}),n.alignment={wrapText:!0},n.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}})}},convertDate(e,o="DD/MM/YYYY"){return e==null?"-":Z(e).locale("th").add(543,"year").format(o)},convertThaiNo(e){return e?(e=e.replace(/1/g,"๑"),e=e.replace(/2/g,"๒"),e=e.replace(/3/g,"๓"),e=e.replace(/4/g,"๔"),e=e.replace(/5/g,"๕"),e=e.replace(/6/g,"๖"),e=e.replace(/7/g,"๗"),e=e.replace(/8/g,"๘"),e=e.replace(/9/g,"๙"),e=e.replace(/0/g,"๐"),e):""}}},te={class:"report-management"},oe={class:"p-6"},ne={class:"md:flex justify-between pb-6 md:space-y-0 space-y-3 items-center"},ae={class:"flex flex-wrap sm:flex-nowrap gap-3 basis-full"},se={class:"flex basis-2/5"},re={class:"flex gap-3"},ie={class:"flex items-center"},le=c("span",{class:"px-2"},"Export",-1),de={class:"flex gap-5 basis-3/5 justify-end"},ce=c("div",{class:"text-center"},[c("div",{class:"text-gray-400"},"ไม่พบข้อมูล")],-1),pe={key:0},me={key:1},ue=c("br",null,null,-1),fe={key:2,class:"text-red-500"},_e={key:3},he={key:4},ge={key:5},be=c("br",null,null,-1),we={key:6},xe={class:"py-4 px-3"};function ye(e,o,l,s,t,a){const d=_("Icon"),i=_("Button"),n=_("Dropdown"),u=_("InputGroup"),g=_("AdvancedSearchStatus"),b=_("Pagination"),w=_("vue-good-table"),x=_("Card");return h(),f("div",te,[p(x,{noborder:"",bodyClass:"p-0"},{default:v(()=>[c("div",oe,[c("div",ne,[c("div",ae,[c("div",se,[c("div",re,[p(n,{classMenuItems:"left-0  w-[220px] top-[110%]",items:t.exportLists,onOnClickItem:a.handleExport},{default:v(()=>[p(i,{btnClass:"btn-primary text-slate-50",div:"",iconClass:"text-lg"},{default:v(()=>[c("div",ie,[p(d,{icon:"ic:baseline-cloud-download",class:"handle text-[20px]"}),le])]),_:1})]),_:1},8,["items","onOnClickItem"])])]),c("div",de,[p(u,{modelValue:t.filter.keyword,"onUpdate:modelValue":o[0]||(o[0]=r=>t.filter.keyword=r),placeholder:"Search",type:"text",prependIcon:"heroicons-outline:search",merged:"",inputEnter:!0,"onEvent:inputEnter":o[1]||(o[1]=r=>a.getData(1))},null,8,["modelValue"]),p(i,{icon:"mdi:filter",text:"ค้นหาขั้นสูง",btnClass:"btn-primary rounded-md",onClick:o[2]||(o[2]=r=>t.isShowModalAS=!t.isShowModalAS)})])])])]),p(g,{isOpen:t.isShowModalAS,"onEvent:close":o[3]||(o[3]=r=>t.isShowModalAS=!1),"onEvent:submit":a.onFilter},null,8,["isOpen","onEvent:submit"]),p(w,{columns:t.columns,styleClass:" vgt-table bordered lesspadding2",rows:t.advancedTable,"pagination-options":{enabled:!0,perPage:t.paginate.perpage},"sort-options":{enabled:!1}},{emptystate:v(()=>[ce]),"table-row":v(r=>{var y,C,N,R,D,E,A,B,P,W,M,j,z;return[r.column.field=="id"?(h(),f("span",pe,m(a.displayInitialNumber(r.row)),1)):r.column.field=="document_number"?(h(),f("span",me,[k(m((y=r.row)!=null&&y.document_number?a.convertThaiNo((C=r.row)==null?void 0:C.document_number):"-")+" ",1),ue,k(" "+m(((N=r.row)==null?void 0:N.subject)??"-"),1)])):r.column.field=="status"?(h(),f("span",fe,m((R=r.row)==null?void 0:R.status),1)):r.column.field=="from_id"?(h(),f("span",_e,m(((E=(D=r.row)==null?void 0:D.from_user)==null?void 0:E.organization_name)??((B=(A=r.row)==null?void 0:A.from_user)==null?void 0:B.name)??"-"),1)):r.column.field=="to_id"?(h(),f("span",he,m(((W=(P=r.row)==null?void 0:P.to_user)==null?void 0:W.full_name)??"-"),1)):r.column.field=="return"?(h(),f("span",ge,[k(m(((M=r.row)==null?void 0:M.return_history[0].returned_reason)??"-")+" ",1),be,k(" คืนเรื่องโดย: "+m(((z=a.findUser(this.common.user_list,(j=r.row)==null?void 0:j.return_history[0].user_id))==null?void 0:z.full_name)??"-"),1)])):(h(),f("span",we,m(r.row[r.column.field]),1))]}),"pagination-bottom":v(r=>[c("div",xe,[p(b,{total:t.paginate.total,current:t.paginate.current_page,"per-page":t.paginate.perpage,pageRange:t.paginate.pageRange,onPageChanged:o[4]||(o[4]=y=>e.changePage(y)),pageChanged:r.pageChanged,perPageChanged:r.perPageChanged,textAfterInput:"ไปที่หน้า",enableSearch:"",enableInput:""},null,8,["total","current","per-page","pageRange","pageChanged","perPageChanged"])])]),_:1},8,["columns","rows","pagination-options"])]),_:1})])}const Xe=H(ee,[["render",ye]]);export{Xe as default};
