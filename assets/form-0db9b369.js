import{C as Q}from"./index-263882d1.js";import{B as W}from"./index-441935dc.js";import{T as X}from"./index-31d1a8ca.js";import{u as Y,a as b}from"./vee-validate.esm-0c282d04.js";import{c as Z,a as C,d as $}from"./array-e684e252.js";import{V as ee,C as ae}from"./VueSelect-4c8519b3.js";import{C as te}from"./CustomVueSelect-201d6fec.js";import{R as oe}from"./index-3069c0b6.js";import{e as se}from"./vue3-tree-vue.esm-b89ac387.js";import{_ as re,a as j,u as ie}from"./index-e058a960.js";import{M as ne}from"./Modal-19eb68c4.js";import{I as le}from"./index-72ee420c.js";import{aA as x,al as de,o as I,x as r,bj as z,m as q,n as E,aF as l,as as p,p as e,aT as U,bo as ce,w as P}from"./preload-helper-9e0646ca.js";import{I as ue}from"./index-a60d9262.js";import{T as me}from"./index-9078ba5b.js";import{M as _e}from"./index-0fe0dceb.js";import{N as pe}from"./index-cc7a2b4b.js";import"./vue-cleave.min-9e1201c2.js";import"./transition-39b574f4.js";import"./dom-891ac6c3.js";import"./hidden-11a9ab9d.js";import"./focus-management-e6c5d1fd.js";import"./micro-task-89dcd6af.js";import"./open-closed-486d85f0.js";import"./use-outside-click-a758fdce.js";import"./iconify-4e42c13d.js";const ve={components:{Card:Q,Textinput:X,Button:W,VueSelect:ee,vSelect:ae,CustomVueSelect:te,Radio:oe,Modal:ne,Icon:le,tree:se,InputGroup:ue,Tooltip:me,ModalOrganize:_e,NavigationPath:pe},setup(){const i=ie(),t=x(!1),h=x(!1),a=x([]),y=x("");let S=[];const w=x(""),v=[],m=x(null),M=Z({parent_id:C().nullable().required("กรุณาระบุว่าอยู่ภายใต้หน่วยงานใด"),organization_name:C().required("กรุณาระบุชื่อหน่วยงาน"),abbreviation:C().required("กรุณาระบุอักษรย่อหน่วยงาน"),organization_code:C().required("กรุณาระบุรหัสหน่วยงาน"),have_sub_organization:C().required("กรุณาระบุว่ามีหน่วยงานย่อยหรือไม่"),display_order:$().required("กรุณาระบุลำดับที่แสดงผลหน่วยงาน").typeError("กรุณาระบุลำดับที่แสดงผลหน่วยงานเป็นตัวเลข")}),{handleSubmit:g}=Y({validationSchema:M});de(async()=>{var s,n,d,T,A,B,L;if(i.currentRoute.value.params.id){const{data:c,status:R}=await j("organizetionStore","edit",{payload:i.currentRoute.value.params.id});if(R===200){((s=c.result)==null?void 0:s.parent_organization_list.length)>0&&(a.value=(n=c.result)==null?void 0:n.parent_organization_list,S=(d=c.result)==null?void 0:d.parent_organization_list);const u=(T=c.result)==null?void 0:T.organization;_.value=u.parent_id.toString(),f.value=u.organization_name,o.value=u.abbreviation,O.value=u.organization_code,V.value=u.have_sub_organization?"1":"0",k.value=u.display_order.toString(),m.value=u.parent_organization,y.value=u.parent_id}}else{const{data:c,status:R}=await j("organizetionStore","create");R===200&&((A=c.result)==null?void 0:A.parent_organization_list.length)>0&&(a.value=(B=c.result)==null?void 0:B.parent_organization_list,S=(L=c.result)==null?void 0:L.parent_organization_list)}});const{value:_,errorMessage:D}=b("parent_id"),{value:f,errorMessage:N}=b("organization_name"),{value:o,errorMessage:F}=b("abbreviation"),{value:O,errorMessage:G}=b("organization_code"),{value:V,errorMessage:H}=b("have_sub_organization"),{value:k,errorMessage:J}=b("display_order"),K=g(async()=>{var n;let s={organization_name:f.value,parent_id:_.value,level:(n=m.value)==null?void 0:n.level,abbreviation:o.value,organization_code:O.value,have_sub_organization:V.value!="0",display_order:k.value};if(console.log("submit",s),i.currentRoute.value.params.id){const d=await j("organizetionStore","update",{payload:{id:i.currentRoute.value.params.id,data:s}});console.log("res",d),d.status===200?t.value=!0:alert("error")}else{const d=await j("organizetionStore","store",{payload:s});console.log(d),d.status===200?t.value=!0:alert("error")}});return{parent_id:_,parentIdError:D,organization_name:f,organizationNameError:N,abbreviation:o,abbreviationError:F,organization_code:O,organizationCodeError:G,have_sub_organization:V,haveSubOrganizationError:H,display_order:k,displayOrderError:J,isShowDialog:t,onSubmit:K,onAccept:()=>{t.value=!1,i.push("/app/user-role/organize-structure")},organizeList:a,selectOrganize:()=>{h.value=!0},isShowDialogOrganize:h,onAcceptSelectOrganize:()=>{h.value=!1},onCancelSelectOrganize:()=>{y.value=null,h.value=!1},searchOrganize:w,treeData:v,selectedItem:m,onSelectedItem:s=>{s.have_sub_organization&&(y.value=s.id,m.value=s,_.value=s.id.toString())},mockData:()=>{f.value="สำนักงานเศรษฐกิจการเกษตร",o.value="ส.ก.ก.",O.value="01",V.value="0",k.value="1"},expandRecursive:s=>(s.forEach(n=>{n.expanded=!0,n.children.length>0&&this.expandRecursive(n.children)}),s),onSearchOrganize:s=>{w.value=s,s?a.value=S[0].children.filter(n=>n.organization_name.toLowerCase().includes(s.toLowerCase())):a.value=S},organization_id:y}}},ge={class:"bg-gray-100 py-3 px-3 sm:px-0"},fe={class:"flex"},be=e("div",{class:"basis-1/3 pt-2 pr-4 flex justify-end"}," อยู่ภายใต้หน่วยงาน ",-1),xe={class:"basis-2/3"},ze={class:"flex items-center"},he=e("span",null,"เลือกหน่วยงาน",-1),ye={class:"px-2 mt-3 flex"},Se=e("div",{class:"shrink-0"},"หน่วยงานที่เลือก:",-1),we={class:"basis-full"},Ce={class:"text-left pl-3"},Ie={key:0,class:"text-danger-500 block text-sm"},Oe={class:"py-3 px-3 sm:px-0"},Ve={class:"flex justify-center"},ke={class:"flex-1"},je={class:"flex flex-wrap"},Ee=e("div",{class:"sm:basis-1/3 basis-full pt-2 pr-4 flex sm:justify-end justify-start mb-1 sm:mb-0"}," ชื่อหน่วยงาน ",-1),Me={class:"sm:basis-1/3 basis-full"},De={class:"bg-gray-100 py-3 px-3 sm:px-0"},Ne={class:"flex justify-center"},Re={class:"flex-1"},Te={class:"flex flex-wrap"},Ae=e("div",{class:"sm:basis-1/3 basis-full pt-2 pr-4 flex sm:justify-end justify-start mb-1 sm:mb-0"}," อักษรย่อหน่วยงาน ",-1),Be={class:"sm:basis-1/3 basis-full"},Le={class:"py-3 px-3 sm:px-0"},qe={class:"flex justify-center"},Ue={class:"flex-1"},Pe={class:"flex flex-wrap"},Fe=e("div",{class:"sm:basis-1/3 basis-full pt-2 pr-4 flex sm:justify-end justify-start mb-1 sm:mb-0"}," รหัสหน่วยงาน ",-1),Ge={class:"sm:basis-1/3 basis-full"},He={class:"bg-gray-100 py-5 px-3 sm:px-0"},Je={class:"flex justify-center"},Ke={class:"flex-1"},Qe={class:"flex flex-wrap"},We=e("div",{class:"sm:basis-1/3 basis-full pr-4 flex sm:justify-end justify-start mb-1 sm:mb-0"}," มีหน่วยงานย่อย ",-1),Xe={class:"sm:basis-1/3 basis-full flex items-center flex-wrap"},Ye={class:"mr-14"},Ze={key:0,class:"basis-full"},$e={class:"mt-2 text-danger-500 block text-sm"},ea={class:"py-3 px-3 sm:px-0"},aa={class:"flex justify-center"},ta={class:"flex-1"},oa={class:"flex flex-wrap"},sa=e("div",{class:"sm:basis-1/3 basis-full pt-2 pr-4 flex sm:justify-end justify-start mb-1 sm:mb-0"}," ลำดับที่แสดงผลหน่วยงาน (ตัวเลข) ",-1),ra={class:"sm:basis-1/3 basis-full"},ia=e("hr",{class:"mt-5 border"},null,-1),na={class:"text-center mt-10 flex justify-center mb-16"},la={class:"h-36 flex items-center justify-center"},da={class:"text-center flex flex-row flex-wrap justify-center"},ca={class:"basis-full flex justify-center mb-5"},ua={key:0,class:"text-lg text-slate-900"},ma=e("span",{class:"text-green-500"},"สำเร็จ",-1),_a={key:1,class:"text-lg text-slate-900"},pa=e("span",{class:"text-green-500"},"สำเร็จ",-1),va={class:"flex justify-center w-full"};function ga(i,t,h,a,y,S){const w=l("Icon"),v=l("Button"),m=l("NavigationPath"),M=l("Tooltip"),g=l("Textinput"),_=l("Radio"),D=l("Card"),f=l("Modal"),N=l("ModalOrganize");return p(),I("div",null,[r(D,{title:i.$route.params.id?"แบบฟอร์มแก้ไขหน่วยงาน":"แบบฟอร์มเพิ่มหน่วยงาน",className:"border-secondary-500 border-1",bodyClass:"p-3",noborder:""},{default:z(()=>[e("form",{onSubmit:t[8]||(t[8]=ce((...o)=>a.onSubmit&&a.onSubmit(...o),["prevent"])),class:"px-0 sm:px-12"},[e("div",ge,[e("div",fe,[be,e("div",xe,[r(v,{btnClass:"btn-primary w-32 font-medium mx-2",onOnClick:t[0]||(t[0]=o=>a.selectOrganize()),isDisabled:!!i.$route.params.id},{default:z(()=>[e("div",ze,[r(w,{icon:"ic:baseline-plus",class:"text-white text-xl mr-2"}),he])]),_:1},8,["isDisabled"]),e("div",ye,[Se,e("div",we,[a.organization_id?(p(),q(M,{key:0,placement:"top",arrow:"",theme:"light"},{base:z(()=>[e("div",Ce,[r(m,{arrayItems:a.organizeList,targetId:a.organization_id,targetName:"organization_name",typePath:"organization"},null,8,["arrayItems","targetId"])])]),default:z(()=>[r(m,{arrayItems:a.organizeList,targetId:a.organization_id,targetName:"organization_name",typePath:"organization"},null,8,["arrayItems","targetId"])]),_:1})):E("",!0)])]),a.parentIdError?(p(),I("span",Ie,U(a.parentIdError),1)):E("",!0)])])]),e("div",Oe,[e("div",Ve,[e("div",ke,[e("div",je,[Ee,e("div",Me,[r(g,{classInput:"border border-gray-400",modelValue:a.organization_name,error:a.organizationNameError,"onUpdate:modelValue":t[1]||(t[1]=o=>a.organization_name=o)},null,8,["modelValue","error"])])])])])]),e("div",De,[e("div",Ne,[e("div",Re,[e("div",Te,[Ae,e("div",Be,[r(g,{classInput:"border border-gray-400",modelValue:a.abbreviation,error:a.abbreviationError,"onUpdate:modelValue":t[2]||(t[2]=o=>a.abbreviation=o)},null,8,["modelValue","error"])])])])])]),e("div",Le,[e("div",qe,[e("div",Ue,[e("div",Pe,[Fe,e("div",Ge,[r(g,{classInput:"border border-gray-400",modelValue:a.organization_code,error:a.organizationCodeError,"onUpdate:modelValue":t[3]||(t[3]=o=>a.organization_code=o)},null,8,["modelValue","error"])])])])])]),e("div",He,[e("div",Je,[e("div",Ke,[e("div",Qe,[We,e("div",Xe,[e("div",Ye,[r(_,{label:"ได้",value:"1",modelValue:a.have_sub_organization,"onUpdate:modelValue":t[4]||(t[4]=o=>a.have_sub_organization=o)},null,8,["modelValue"])]),e("div",null,[r(_,{label:"ไม่ได้",value:"0",modelValue:a.have_sub_organization,"onUpdate:modelValue":t[5]||(t[5]=o=>a.have_sub_organization=o)},null,8,["modelValue"])]),a.haveSubOrganizationError?(p(),I("div",Ze,[e("span",$e,U(a.haveSubOrganizationError),1)])):E("",!0)])])])])]),e("div",ea,[e("div",aa,[e("div",ta,[e("div",oa,[sa,e("div",ra,[r(g,{classInput:"border border-gray-400",modelValue:a.display_order,error:a.displayOrderError,"onUpdate:modelValue":t[6]||(t[6]=o=>a.display_order=o)},null,8,["modelValue","error"])]),e("div",{class:"sm:basis-1/3 basis-full pt-3 pl-0 sm:pl-3 text-xs",onClick:t[7]||(t[7]=(...o)=>a.mockData&&a.mockData(...o))}," การแสดงผลจะแสดงลำดับจาก น้อย ไป มาก ")])])])]),ia,e("div",na,[r(v,{type:"submit",text:i.$route.params.id?"บันทึกการแก้ไข":"บันทึก",btnClass:"btn-primary w-32 font-medium mx-2"},null,8,["text"]),r(v,{text:"ยกเลิก",btnClass:"btn-outline-dark w-32 mx-2",link:"/app/user-role/organize-structure"})])],32)]),_:1},8,["title"]),a.isShowDialog?(p(),q(f,{key:0,title:i.$route.params.id?"บันทึกการแก้ไขหน่วยงาน":"บันทึกหน่วยงานสำเร็จ",label:"",labelClass:"btn-outline-dark",ref:"modalDialog",centered:"",activeModal:a.isShowDialog,"onEvent:closeModal":t[10]||(t[10]=o=>a.onAccept())},{footer:z(()=>[e("div",va,[r(v,{text:"ปิด",btnClass:"btn-primary w-36",onClick:t[9]||(t[9]=o=>a.onAccept())})])]),default:z(()=>[e("div",la,[e("div",da,[e("div",ca,[r(w,{icon:"icon-park-solid:protect",class:"text-5xl text-green-500"})]),i.$route.params.id?(p(),I("h4",ua,[P(" บันทึกการแก้ไขหน่วยงาน "),ma])):(p(),I("h4",_a,[P(" บันทึกหน่วยงาน "),pa]))])])]),_:1},8,["title","activeModal"])):E("",!0),r(N,{isShowDialogOrganize:a.isShowDialogOrganize,items:a.organizeList,value:a.organization_id,"onEvent:closeModal":t[11]||(t[11]=o=>a.onCancelSelectOrganize()),"onEvent:acceptSelectOrganize":t[12]||(t[12]=o=>a.onAcceptSelectOrganize()),"onEvent:onSelectedItem":t[13]||(t[13]=o=>a.onSelectedItem(o))},null,8,["isShowDialogOrganize","items","value"])])}const Ya=re(ve,[["render",ga]]);export{Ya as default};
