import{C as L}from"./index-263882d1.js";import{I as D}from"./index-72ee420c.js";import{B as M}from"./index-441935dc.js";import{V as z,C as F}from"./VueSelect-4c8519b3.js";import{M as W}from"./Modal-19eb68c4.js";import{M as E}from"./index-7dc8252b.js";import{R as N}from"./index-3069c0b6.js";import{D as U}from"./index-e3f12ad9.js";import{D as X}from"./index-090a8953.js";import{M as j}from"./index-ffc068ae.js";import{_ as A,a as v,b as O,t as g}from"./index-e058a960.js";import{c as V}from"./appex-chart-e4d84b07.js";import G from"./colors-b45e2c1c.js";import{I as P}from"./index-a60d9262.js";import{T as H}from"./index-31d1a8ca.js";import{C as Y}from"./index-8994827d.js";import{c as J}from"./global-funcs-ef1510cf.js";import{E as w}from"./exceljs.min-46343030.js";import{r as T,w as R}from"./xlsx-92a51129.js";import{C as q}from"./index-2d8ae848.js";import{o as b,x as p,bj as u,aF as m,as as h,p as f,F as K,aD as Q,m as Z,aT as y}from"./preload-helper-9e0646ca.js";import"./iconify-4e42c13d.js";import"./transition-39b574f4.js";import"./dom-891ac6c3.js";import"./hidden-11a9ab9d.js";import"./focus-management-e6c5d1fd.js";import"./micro-task-89dcd6af.js";import"./open-closed-486d85f0.js";import"./use-outside-click-a758fdce.js";import"./index-1b218db3.js";import"./index-6c8c0d73.js";import"./use-resolve-button-type-38f1f99a.js";import"./vue-cleave.min-9e1201c2.js";import"./ck-white-7280cd79.js";const $={computed:{columnChart(){return V}},components:{CFlatPickr:q,Checkbox:Y,Textinput:H,InputGroup:P,ModalGraph:j,Dropdown:X,DatePickerRange:U,Radio:N,Icon:D,Button:M,Card:L,VueSelect:z,vSelect:F,Modal:W,ModalSuccess:E},data(){return{exportLists:[{id:1,label:"Microsoft Word",icon:"ant-design:file-word-filled"},{id:2,label:"Microsoft Excel",icon:"ant-design:file-excel-filled"},{id:3,label:"PDF",icon:"ant-design:file-pdf-filled"},{id:4,label:"RTF",icon:"grommet-icons:document-rtf"},{id:5,label:"HTML",icon:"bxs:file-html"}],filter:{start_date:"",end_date:"",agency:null},datepicker:"",yearItem:[{year:2566}],agencyItem:[],dateMulti:[],item:{},dataTable:[],dataGraph:[],viewColumnName:[],columns:[{label:"ลำดับ",field:"id",width:"10%",tdClass:"text_left",thClass:"text_left"},{label:"หน่วยงาน",field:"organization_id",width:"50%",tdClass:"text_left",thClass:"text_left"},{label:"จำนวนไฟล์",field:"count",width:"20%",tdClass:"text_left",thClass:"text_left"},{label:"ขนาดไฟล์",field:"file_size",width:"20%",tdClass:"text_left",thClass:"text_left"}]}},watch:{datepicker:{handler:function(o,t){if(o&&o.length>10){let s=o.split(" to ");this.filter.start_date=s[0],this.filter.end_date=s[1],this.getData()}},deep:!0},dateMulti:{handler:function(o){typeof o=="object"&&this.getData()},deep:!0}},async created(){await this.getData()},methods:{onFilter(){this.getData()},async getData(){var s,a,e,n,l,r,i;this.dateMulti.length>0&&(this.filter.date_start=this.dateMulti[0],this.filter.date_end=this.dateMulti[1]);const o=await v("reportFixStore","fileRreport",{payload:this.filter}),t=await v("reportDashboardStore","getCommonData");this.dataGraph=[],(s=t==null?void 0:t.data.result)!=null&&s.dropdown&&(this.agencyItem=(a=t==null?void 0:t.data.result)==null?void 0:a.dropdown),(e=o.data)!=null&&e.result&&(this.dataTable=(l=(n=o.data)==null?void 0:n.result)==null?void 0:l.dataTable,this.dataGraph.push(this.generateGraph((i=(r=o.data)==null?void 0:r.result)==null?void 0:i.dataGraph,this.agencyItem)))},generateGraph(o,t){o.dataLabel=J(t,o.dataLabel);const s=o.id,a=o.name,e=o.chartType;let n;n=[{data:o.data}];const l={chart:{id:"custom_chart_0",type:o.chartType,toolbar:{show:!1}},dataLabels:{enabled:o.showLabel},stroke:{curve:"straight"},markers:{size:o.markers?4:0,colors:"#fff",strokeColors:G.primary,strokeWidth:2,shape:"circle",radius:2,hover:{sizeOffset:1}},labels:o.dataLabel,legend:{itemMargin:{vertical:5},width:200,offsetX:10,offsetY:60,formatter:function(r,i){let c=parseFloat(i.w.globals.series[i.seriesIndex]/i.w.globals.series.reduce((_,x)=>_+x,0)*100).toFixed(2)+"%";return r+" "+c}},yaxis:[{min:0,tickAmount:10}],plotOptions:{pie:{donut:{labels:{show:!0,name:{show:!1},value:{show:!0,fontSize:"40px",offsetY:15,formatter:function(r){return r}},total:{show:!0,label:"",color:"#373d3f",formatter:function(r){return r.globals.series.reduce((i,c)=>i+c,0)}}}}}},noData:{text:"No data",align:"center",verticalAlign:"middle",offsetX:0,offsetY:0,style:{fontSize:"40px"}}};return{id:s,name:a,series:n,options:l,chartType:e}},findOrganizationName(o){const t=this.agencyItem.find(s=>s.id===parseInt(o));return t?t.organization_name:"ไม่ทราบ"},async handleExport(o){let t=1;const s=this.dataTable.map(n=>{const l=this.findOrganizationName(n.organization_id);return{order:t++,name:l,count:n.count,file_size:n.file_size}}),a=await this.saveToArchive("custom_chart_0");let e=["ลำดับ","หน่วยงาน","จำนวนไฟล์","ขนาดไฟล์"];o.id==1?this.exportToWord(s,a.imgURI,e):o.id==2?this.exportToExcel(s,a.imgURI,e):o.id==3?this.exportToPdf(s,a.imgURI,e):o.id==4?this.exportToRtf(s,"",e):o.id==5&&this.exportToHtml(s,"",e)},async saveToArchive(o){return await window.ApexCharts.getChartByID(o).dataURI()},async sendToServer(o,t,s){try{const a=new FormData;a.append("excelFile",o,"downloaded-file.xlsx"),t&&a.append("base64Image",t);const e=await O.post(g+"/fix/convert-to-"+s,a);s==="pdf"?window.open(`${g}/public/tempFile/${e.data.result.data.fileName}.${s}`,"_blank"):window.open(`${g}/public/tempFile/${e.data.result.data.fileName}.${s}`,"_parent","download")}catch(a){console.error("Error sending file to server:",a)}},async exportToExcel(o,t,s){const a=new w.Workbook,e=a.addWorksheet("Sheet1");if(t){const n=a.addImage({base64:t,extension:"png"});e.addImage(n,{tl:{col:0,row:0},ext:{width:1600,height:380}})}e.getRow(t?20:1).values=s;for(const n of o)e.addRow([n.order,n.name,n.count,n.file_size]);this.adjustColumnWidth(e),this.setTextCenter(e),a.xlsx.writeBuffer().then(n=>{const l=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),r="exported_data.xlsx",i=document.createElement("a");i.href=URL.createObjectURL(l),i.download=r,document.body.appendChild(i),i.click(),document.body.removeChild(i)})},async exportToWord(o,t,s){const a=new w.Workbook,e=a.addWorksheet("Sheet1");if(t){const r=a.addImage({base64:t,extension:"png"});e.addImage(r,{tl:{col:0,row:0},ext:{width:1600,height:380}})}e.getRow(t?20:1).values=s;for(const r of o)e.addRow([r.order,r.name,r.count,r.file_size]);this.adjustColumnWidth(e),this.setTextCenter(e);const n=await a.xlsx.writeBuffer(),l=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});await this.sendToServer(l,t,"docx")},async exportToPdf(o,t,s){const a=new w.Workbook,e=a.addWorksheet("Sheet1");if(e.pageSetup={orientation:"landscape"},t){const r=a.addImage({base64:t,extension:"png"});e.addImage(r,{tl:{col:0,row:0},ext:{width:600,height:300}})}e.getRow(t?18:1).values=s;for(const r of o)e.addRow([r.order,r.name,r.count,r.file_size]);this.adjustColumnWidth(e),this.setTextCenter(e,!0);const n=await a.xlsx.writeBuffer(),l=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});await this.sendToServer(l,t,"pdf")},async convertXLSXToRTF(o){const t=new ArrayBuffer(o.length);new Uint8Array(t).set(o);const a=T(t);return R(a,{sheet:0,bookType:"rtf",type:"buffer"})},async convertXLSXToHTML(o){console.log("convertXLSXToHTML");const t=new ArrayBuffer(o.length);new Uint8Array(t).set(o);const a=T(t),e={sheet:0,bookType:"html",type:"buffer"};return console.log("convertXLSXToHTML end"),R(a,e)},async exportToRtf(o,t,s){const a=new w.Workbook,e=a.addWorksheet("Sheet1");if(e.pageSetup={orientation:"landscape"},t){const c=a.addImage({base64:t,extension:"png"});e.addImage(c,{tl:{col:0,row:0},ext:{width:600,height:300}})}e.getRow(t?12:1).values=s;for(const c of o)e.addRow([c.order,c.name,c.count,c.file_size]);this.adjustColumnWidth(e),this.setTextCenter(e,!0);const n=await a.xlsx.writeBuffer();let l=await this.convertXLSXToRTF(n);const r=new Blob([l],{type:"application/rtf"}),i=document.createElement("a");i.href=window.URL.createObjectURL(r),i.download="rtf_report.rtf",i.click()},async exportToHtml(o,t,s){const a=new w.Workbook,e=a.addWorksheet("Sheet1");if(e.pageSetup={orientation:"landscape"},t){const c=a.addImage({base64:t,extension:"png"});e.addImage(c,{tl:{col:0,row:0},ext:{width:600,height:300}})}e.getRow(t?12:1).values=s;for(const c of o)e.addRow([c.order,c.name,c.count,c.file_size]);this.adjustColumnWidth(e),this.setTextCenter(e,!0);const n=await a.xlsx.writeBuffer();let l=await this.convertXLSXToHTML(n);const r=new Blob([l],{type:"application/html"}),i=document.createElement("a");i.href=window.URL.createObjectURL(r),i.download="html_report.html",i.click()},adjustColumnWidth(o){o.columns.forEach(t=>{const s=t.values.map(e=>e.toString().length),a=Math.max(...s.filter(e=>typeof e=="number"));t.width=a*.7})},setTextCenter(o,t=!1){const e=o.lastRow.number;for(let n=0;n<=e;n++){const l=o.getRow(n);l.height=30,l.eachCell({includeEmpty:!0},r=>{t&&(r.font={size:10}),r.alignment={wrapText:!0},r.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}})}}}},ee={class:"report-management"},te=f("div",{class:"md:flex justify-between p-6 md:space-y-0 space-y-3 items-center border-b-2"},[f("div",null,[f("span",null,"รายงานการแนบไฟล์")])],-1),oe={class:"flex flex-row-between p-6"},ae={class:"flex basis-1/5"},se={class:"flex gap-3"},ne={class:"flex items-center"},re=f("span",{class:"px-2"},"Export",-1),ie={class:"flex basis-4/5 gap-3 justify-end"},le={class:"basis-1/5"},de={class:"my-5 px-6"},ce=f("div",{class:"text-center"},[f("div",{class:"text-gray-400"},"ไม่พบข้อมูล")],-1),fe={key:0},pe={key:1},me={key:2};function ue(o,t,s,a,e,n){const l=m("Icon"),r=m("Button"),i=m("Dropdown"),c=m("CFlatPickr"),_=m("DatePickerRange"),x=m("vSelect"),C=m("VueSelect"),I=m("apexchart"),k=m("Card"),S=m("vue-good-table");return h(),b("div",ee,[p(k,{noborder:"",bodyClass:"two-side-card"},{default:u(()=>[te,f("div",oe,[f("div",ae,[f("div",se,[p(i,{classMenuItems:"left-0  w-[220px] top-[110%]",items:e.exportLists,onOnClickItem:n.handleExport},{default:u(()=>[p(r,{btnClass:"btn-primary text-slate-50",div:"",iconClass:"text-lg"},{default:u(()=>[f("div",ne,[p(l,{icon:"ic:baseline-cloud-download",class:"handle text-[20px]"}),re])]),_:1})]),_:1},8,["items","onOnClickItem"])])]),f("div",ie,[p(_,null,{default:u(()=>[p(c,{modelValue:e.dateMulti,"onUpdate:modelValue":t[0]||(t[0]=d=>e.dateMulti=d),onOnChange:t[1]||(t[1]=d=>e.dateMulti=d),class:"form-control border-0 focus:ring-0 w-[200px]",config:{mode:"range"}},null,8,["modelValue"])]),_:1}),f("div",le,[p(C,{classInput:"input_color"},{default:u(()=>[p(x,{modelValue:e.filter.agency,"onUpdate:modelValue":t[2]||(t[2]=d=>e.filter.agency=d),placeholder:"หน่วยงานทั้งหมด",label:"organization_name",class:"input_color border rounded",reduce:d=>d.id,options:e.agencyItem,"onOption:selected":t[3]||(t[3]=d=>n.getData(1))},null,8,["modelValue","reduce","options"])]),_:1})])])]),f("div",de,[p(k,null,{default:u(()=>[(h(!0),b(K,null,Q(e.dataGraph,(d,B)=>(h(),Z(I,{key:B,type:d.chartType,height:"360",width:"100%",options:d.options,series:d.series},null,8,["type","options","series"]))),128))]),_:1})]),p(S,{columns:e.columns,styleClass:" vgt-table bordered mb-6",rows:e.dataTable,"pagination-options":{enabled:!1},"sort-options":{enabled:!1}},{emptystate:u(()=>[ce]),"table-row":u(d=>[d.column.field=="id"?(h(),b("div",fe,y(d.index+1),1)):d.column.field=="organization_id"?(h(),b("div",pe,y(n.findOrganizationName(d.row[d.column.field])),1)):(h(),b("div",me,y(d.row[d.column.field]),1))]),_:1},8,["columns","rows"])]),_:1})])}const qe=A($,[["render",ue]]);export{qe as default};
